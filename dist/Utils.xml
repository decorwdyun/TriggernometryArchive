<?xml version="1.0" encoding="utf-8"?>
<TriggernometryExport PluginVersion="2.0.3.1">
  <ExportedFolder Id="b608e8a2-adbf-4973-b08b-bda20d9e637b" Enabled="true" Name="[工具] 运行支持库 Utils.xml" RawEnvironmentVariables="w = 3">
    <Folders>
      <Folder Id="23887533-752e-42fd-b6b8-f66fdd20d61e" Enabled="true" Name="高级标点工具箱 AdvWm 旧版本 v2.x（仅兼容 即将移除）">
        <Folders>
          <Folder Id="fd9d8dab-a195-4b65-ab9c-db63bb9d8791" Enabled="true" Name="场地标点">
            <Folders>
              <Folder Id="f25a4b25-b4fe-4e9e-8d27-aa41d0667426" Enabled="false" Name="debug">
                <Triggers>
                  <Trigger Enabled="false" Id="722519c0-37fb-4ef8-a3d6-0d88fc5490ff" Name="测试循环标点     B：自己-B 线性    AC：自己-C 径向" RegularExpression="^.{15}\S+ 1C:Add:(?&lt;wmid&gt;\d+):.{8}:(?&lt;pn&gt;[^:]+):(?&lt;x&gt;[^:]+):(?&lt;y&gt;[^:]+):(?&lt;z&gt;[^:]+)">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Variable" VariableOp="SetNumeric" VariableName="1" VariableExpression="${v:1} + 1"/>
                      <Action OrderNumber="2" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="AdmWm_test_A" VariableExpression="${x}:${y}:${z}">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${wmid}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="NumericEqual"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="3" ActionType="LogMessage" Asynchronous="False" LogMessageText="AdvWm_linearConnect:start:${_me.x}:${_me.y}:${_me.z}:end:${x}:${y}:${z}:waymarkers:ABCD1234" LogProcess="True" VariableOp="SetString">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${wmid}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="NumericEqual"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="4" ActionType="LogMessage" Asynchronous="False" LogMessageText="AdvWm_polarConnect:center:${v:AdmWm_test_A}:start:${_me.x}:${_me.y}:${_me.z}:end:${x}:${y}:${z}:waymarkers:BCD1234" LogProcess="True" VariableOp="SetString">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${wmid}" ExpressionTypeL="String" ExpressionR="2" ExpressionTypeR="String" ConditionType="NumericEqual"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="5" ActionType="LogMessage" Asynchronous="False" LogMessageText="${_event}" LogProcess="True">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${wmid} = 1 || ${wmid} = 2" ExpressionTypeL="Numeric" ExpressionR="1" ExpressionTypeR="Numeric" ConditionType="NumericEqual"/>
                        </Condition>
                      </Action>
                    </Actions>
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${pn}" ExpressionTypeL="String" ExpressionR="${_me}" ExpressionTypeR="String" ConditionType="StringEqualNocase"/>
                    </Condition>
                  </Trigger>
                  <Trigger Enabled="false" Id="b9b3f60a-d740-4c47-8ff9-45f26395ffc2" Name="测试   A-B：线性   A-C：径向" RegularExpression="^.{15}\S+ 1C:Add:(?&lt;wmid&gt;\d+):.{8}:(?&lt;pn&gt;[^:]+):(?&lt;x&gt;[^:]+):(?&lt;y&gt;[^:]+):(?&lt;z&gt;[^:]+)">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="AdmWm_test_start" VariableExpression="start:${x}:${y}:${z}">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${wmid}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="NumericEqual"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="2" ActionType="LogMessage" Asynchronous="False" LogMessageText="AdvWm:linear:${v:AdmWm_test_start}:end:${x}:${y}:${z}:waymarkers:ABCD1234" LogProcess="True" VariableOp="SetString">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${wmid}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="NumericEqual"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="3" ActionType="LogMessage" Asynchronous="False" LogMessageText="AdvWm:polar:center:${_me.x}:${_me.y}:${v:AdmWm_test_start}:end:${x}:${y}:${z}:waymarkers:ABCD1234" LogProcess="True" VariableOp="SetString">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${wmid}" ExpressionTypeL="String" ExpressionR="2" ExpressionTypeR="String" ConditionType="NumericEqual"/>
                        </Condition>
                      </Action>
                    </Actions>
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${pn}" ExpressionTypeL="String" ExpressionR="${_me}" ExpressionTypeR="String" ConditionType="StringEqualNocase"/>
                    </Condition>
                  </Trigger>
                </Triggers>
              </Folder>
              <Folder Id="4537d87d-76bc-45eb-938e-89fa73b08b8f" Enabled="true" Name="恢复 / 清空标点">
                <Triggers>
                  <Trigger Enabled="true" Id="0ace1129-1f82-4630-9887-5382596b9595" Name="Load 队列" RegularExpression="^AdvWm_loadQueue:(?&lt;t&gt;.+)$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Placeholder" Description="本触发器会被所有标点指令打断" DescriptionOverride="True"/>
                      <Action OrderNumber="2" ActionType="NamedCallback" ExecutionDelayExpression="(${t}) * 1000" NamedCallbackName="place" NamedCallbackParam="load"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="f841d37a-cc68-4dba-9a3e-3bc4b5212c95" Name="Load" RegularExpression="^AdvWm_load$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="place" NamedCallbackParam="load"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="de1384f7-0865-46d3-9f64-bbfbc6b742a7" Name="Clear" RegularExpression="^AdvWm_clear$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="place" NamedCallbackParam="{&#13;&#10;  &quot;A&quot;:{}, &#13;&#10;  &quot;B&quot;:{}, &#13;&#10;  &quot;C&quot;:{}, &#13;&#10;  &quot;D&quot;:{}, &#13;&#10;  &quot;One&quot;:{}, &#13;&#10;  &quot;Two&quot;:{}, &#13;&#10;  &quot;Three&quot;:{}, &#13;&#10;  &quot;Four&quot;:{}&#13;&#10;}"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="917673a7-eb88-4fe7-8213-8ff2a31fee71" Name="Clear 队列" RegularExpression="^AdvWm_clearQueue:(?&lt;t&gt;.+)$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Placeholder" Description="本触发器会被所有标点指令打断" DescriptionOverride="True"/>
                      <Action OrderNumber="2" ActionType="NamedCallback" ExecutionDelayExpression="(${t}) * 1000" NamedCallbackName="place" NamedCallbackParam="{&#13;&#10;  &quot;A&quot;:{}, &#13;&#10;  &quot;B&quot;:{}, &#13;&#10;  &quot;C&quot;:{}, &#13;&#10;  &quot;D&quot;:{}, &#13;&#10;  &quot;One&quot;:{}, &#13;&#10;  &quot;Two&quot;:{}, &#13;&#10;  &quot;Three&quot;:{}, &#13;&#10;  &quot;Four&quot;:{}&#13;&#10;}"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="76e290c7-c036-4909-a3cf-21dc2f5226a5" Name="转发排队" RegularExpression="^AdvWm_(?&lt;type&gt;clear|load):(?&lt;t&gt;.+)$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Placeholder" Asynchronous="False" Description="用这个转发，以免同时执行一条标点和一条排队取消时，后者立刻被前者打断" DescriptionOverride="True"/>
                      <Action OrderNumber="2" ActionType="LogMessage" ExecutionDelayExpression="${t} &gt; 0.5 ? 0.5 : ${t}" Asynchronous="False" LogMessageText="AdvWm_${type}Queue:${n: max(0, ${t} - 0.5) }" LogProcess="True"/>
                    </Actions>
                  </Trigger>
                </Triggers>
              </Folder>
              <Folder Id="820ba11f-5b7f-482b-be1d-29c3981481fe" Enabled="true" Name="本地标点转为网络标点">
                <Triggers>
                  <Trigger Enabled="true" Id="204868c9-527a-4969-ae81-2227364439ca" Name="本地标点转为网络标点" RegularExpression="^AdvWm_public$" Sequential="True">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="command" NamedCallbackParam="/waymark save 30"/>
                      <Action OrderNumber="2" ActionType="NamedCallback" NamedCallbackName="command" NamedCallbackParam="/waymark preset 30"/>
                      <Action OrderNumber="3" ActionType="Placeholder" Asynchronous="False" Description="如果你无论如何一定想在 30 号位置存自己的标点，把上面两个 30 换成你不用的槽位。" DescriptionOverride="True"/>
                    </Actions>
                  </Trigger>
                </Triggers>
              </Folder>
            </Folders>
            <Triggers>
              <Trigger Enabled="true" Id="e9a3d6f5-6d2f-422d-95e2-4d90551216f9" Name="径向插值标点 polarConnect" RegularExpression="^AdvWm_polarConnect:[Cc]enter:(?&lt;xc&gt;[^:]+):(?&lt;yc&gt;[^:]+)(?::[^:]+)?:[Ss]tart:(?&lt;x0&gt;[^:]+):(?&lt;y0&gt;[^:]+):(?&lt;z0&gt;[^:]+):[Ee]nd:(?&lt;x1&gt;[^:]+):(?&lt;y1&gt;[^:]+):(?&lt;z1&gt;[^:]+):[Ww]aymarkers:(?&lt;wm&gt;[^:]+)">
                <Actions>
                  <Action OrderNumber="1" ActionType="Trigger" Asynchronous="False" TriggerOp="CancelTrigger" TriggerId="0ace1129-1f82-4630-9887-5382596b9595"/>
                  <Action OrderNumber="2" ActionType="Trigger" Asynchronous="False" TriggerOp="CancelTrigger" TriggerId="917673a7-eb88-4fe7-8213-8ff2a31fee71"/>
                  <Action OrderNumber="3" ActionType="Placeholder" Description="初始化" DescriptionOverride="True"/>
                  <Action OrderNumber="4" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_len" VariableExpression="${f:length:${wm}}"/>
                  <Action OrderNumber="5" ActionType="DictVariable" Asynchronous="False" DictVariableOp="Build" DictVariableTarget="AdvWm_WmMapping" DictVariableValue="=,A=A,B=B,C=C,D=D,1=One,2=Two,3=Three,4=Four" DictTargetPersist="True">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${pd:AdvWm_WmMapping.size}" ExpressionTypeL="String" ExpressionR="8" ExpressionTypeR="String" ConditionType="NumericNotEqual"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="6" ActionType="Placeholder" Description="极坐标转换（注：实际为不考虑高度的柱坐标系）" DescriptionOverride="True"/>
                  <Action OrderNumber="7" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_r0" VariableExpression="d(${xc}, ${yc}, ${x0}, ${y0})"/>
                  <Action OrderNumber="8" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_r1" VariableExpression="d(${xc}, ${yc}, ${x1}, ${y1})"/>
                  <Action OrderNumber="9" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_θ0" VariableExpression="θ(${xc}, ${yc}, ${x0}, ${y0})"/>
                  <Action OrderNumber="10" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_θ1" VariableExpression="θ(${xc}, ${yc}, ${x1}, ${y1})"/>
                  <Action OrderNumber="11" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_θ1" VariableExpression="relθ(${v:AdvWm_θ0}, ${v:AdvWm_θ1}) + ${v:AdvWm_θ0}"/>
                  <Action OrderNumber="12" ActionType="Placeholder" Description="wm 拆分为列表   转换为标点名" DescriptionOverride="True"/>
                  <Action OrderNumber="13" ActionType="ListVariable" Asynchronous="False" ListVariableOp="SetAll" ListVariableName="AdvWm_polar" ListVariableExpression="${pd:AdvWm_WmMapping[${f:slice(${n:${_idx}-1}):${wm}}]}" ListVariableIndex="${v:AdvWm_len}"/>
                  <Action OrderNumber="14" ActionType="Placeholder" Description="计算所有半径和角度" DescriptionOverride="True"/>
                  <Action OrderNumber="15" ActionType="ListVariable" Asynchronous="False" ListVariableOp="SetAll" ListVariableExpressionType="Numeric" ListVariableName="AdvWm_r" ListVariableExpression="((${v:AdvWm_len} - ${_idx}) * ${v:AdvWm_r0} + (${_idx} - 1) * ${v:AdvWm_r1}) / (${v:AdvWm_len} - 1)" ListVariableIndex="${v:AdvWm_len}"/>
                  <Action OrderNumber="16" ActionType="ListVariable" Asynchronous="False" ListVariableOp="SetAll" ListVariableExpressionType="Numeric" ListVariableName="AdvWm_θ" ListVariableExpression="((${v:AdvWm_len} - ${_idx}) * ${v:AdvWm_θ0} + (${_idx} - 1) * ${v:AdvWm_θ1}) / (${v:AdvWm_len} - 1)" ListVariableIndex="${v:AdvWm_len}"/>
                  <Action OrderNumber="17" ActionType="Placeholder" Description="加权计算坐标   转换为 JSON 格式" DescriptionOverride="True"/>
                  <Action OrderNumber="18" ActionType="ListVariable" Asynchronous="False" ListVariableOp="SetAll" ListVariableName="AdvWm_polar" ListVariableExpression="&quot;${_this}&quot;: {&#13;&#10;    &quot;X&quot;: ${n: ${xc} + ${l:AdvWm_r[${_idx}]} * sin(${l:AdvWm_θ[${_idx}]})}, &#13;&#10;    &quot;Z&quot;: ${n: ${yc} + ${l:AdvWm_r[${_idx}]} * cos(${l:AdvWm_θ[${_idx}]})}, &#13;&#10;    &quot;Y&quot;: ${n: ((${v:AdvWm_len} - ${_idx}) * ${z0} + (${_idx} - 1) * ${z1}) / (${v:AdvWm_len} - 1)}, &#13;&#10;    &quot;Active&quot;: true&#13;&#10;}"/>
                  <Action OrderNumber="19" ActionType="Placeholder" Description="输出" DescriptionOverride="True"/>
                  <Action OrderNumber="20" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="AdvWm_json" VariableExpression="{&#13;&#10;${l:AdvWm_polar.join(&quot;,⏎&quot;)}&#13;&#10;}"/>
                  <Action OrderNumber="21" Enabled="False" ActionType="Variable" Asynchronous="False" VariableOp="Clipboard" VariableName="AdvWm_json"/>
                  <Action OrderNumber="22" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="place" NamedCallbackParam="${v:AdvWm_json}" VariableOp="SetString"/>
                  <Action OrderNumber="23" ActionType="Variable" Asynchronous="False" VariableOp="UnsetRegexUniversal" VariableName="^AdvWm"/>
                </Actions>
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${wm}" ExpressionTypeL="String" ExpressionR="[A-D1-4]{2,8}" ExpressionTypeR="String" ConditionType="RegexMatch"/>
                </Condition>
              </Trigger>
              <Trigger Enabled="true" Id="4f274422-8784-450b-bfbe-bdad2445c347" Name="绝对坐标标点 abs" RegularExpression="^AdvWm_abs(?&lt;A&gt;:A:(?&lt;xa&gt;[^:]*):(?&lt;ya&gt;[^:]*):(?&lt;za&gt;[^:]*):(?&lt;aa&gt;[^:]*))?(?&lt;B&gt;:B:(?&lt;xb&gt;[^:]*):(?&lt;yb&gt;[^:]*):(?&lt;zb&gt;[^:]*):(?&lt;ab&gt;[^:]*))?(?&lt;C&gt;:C:(?&lt;xc&gt;[^:]*):(?&lt;yc&gt;[^:]*):(?&lt;zc&gt;[^:]*):(?&lt;ac&gt;[^:]*))?(?&lt;D&gt;:D:(?&lt;xd&gt;[^:]*):(?&lt;yd&gt;[^:]*):(?&lt;zd&gt;[^:]*):(?&lt;ad&gt;[^:]*))?(?&lt;One&gt;:One:(?&lt;x1&gt;[^:]*):(?&lt;y1&gt;[^:]*):(?&lt;z1&gt;[^:]*):(?&lt;a1&gt;[^:]*))?(?&lt;Two&gt;:Two:(?&lt;x2&gt;[^:]*):(?&lt;y2&gt;[^:]*):(?&lt;z2&gt;[^:]*):(?&lt;a2&gt;[^:]*))?(?&lt;Three&gt;:Three:(?&lt;x3&gt;[^:]*):(?&lt;y3&gt;[^:]*):(?&lt;z3&gt;[^:]*):(?&lt;a3&gt;[^:]*))?(?&lt;Four&gt;:Four:(?&lt;x4&gt;[^:]*):(?&lt;y4&gt;[^:]*):(?&lt;z4&gt;[^:]*):(?&lt;a4&gt;[^:]*))?$">
                <Actions>
                  <Action OrderNumber="1" ActionType="Trigger" Asynchronous="False" TriggerOp="CancelTrigger" TriggerId="0ace1129-1f82-4630-9887-5382596b9595"/>
                  <Action OrderNumber="2" ActionType="Trigger" Asynchronous="False" TriggerOp="CancelTrigger" TriggerId="917673a7-eb88-4fe7-8213-8ff2a31fee71"/>
                  <Action OrderNumber="3" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_A" VariableExpression="(${xa})"/>
                  <Action OrderNumber="4" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_A" VariableExpression="(${ya})"/>
                  <Action OrderNumber="5" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_A" VariableExpression="(${za})"/>
                  <Action OrderNumber="6" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_A" VariableExpression="(${aa})"/>
                  <Action OrderNumber="7" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_B" VariableExpression="(${xb})"/>
                  <Action OrderNumber="8" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_B" VariableExpression="(${yb})"/>
                  <Action OrderNumber="9" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_B" VariableExpression="(${zb})"/>
                  <Action OrderNumber="10" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_B" VariableExpression="(${ab})"/>
                  <Action OrderNumber="11" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_C" VariableExpression="(${xc})"/>
                  <Action OrderNumber="12" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_C" VariableExpression="(${yc})"/>
                  <Action OrderNumber="13" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_C" VariableExpression="(${zc})"/>
                  <Action OrderNumber="14" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_C" VariableExpression="(${ac})"/>
                  <Action OrderNumber="15" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_D" VariableExpression="(${xd})"/>
                  <Action OrderNumber="16" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_D" VariableExpression="(${yd})"/>
                  <Action OrderNumber="17" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_D" VariableExpression="(${zd})"/>
                  <Action OrderNumber="18" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_D" VariableExpression="(${ad})"/>
                  <Action OrderNumber="19" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_One" VariableExpression="(${x1})"/>
                  <Action OrderNumber="20" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_One" VariableExpression="(${y1})"/>
                  <Action OrderNumber="21" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_One" VariableExpression="(${z1})"/>
                  <Action OrderNumber="22" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_One" VariableExpression="(${a1})"/>
                  <Action OrderNumber="23" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_Two" VariableExpression="(${x2})"/>
                  <Action OrderNumber="24" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_Two" VariableExpression="(${y2})"/>
                  <Action OrderNumber="25" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_Two" VariableExpression="(${z2})"/>
                  <Action OrderNumber="26" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_Two" VariableExpression="(${a2})"/>
                  <Action OrderNumber="27" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_Three" VariableExpression="(${x3})"/>
                  <Action OrderNumber="28" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_Three" VariableExpression="(${y3})"/>
                  <Action OrderNumber="29" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_Three" VariableExpression="(${z3})"/>
                  <Action OrderNumber="30" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_Three" VariableExpression="(${a1})"/>
                  <Action OrderNumber="31" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_Four" VariableExpression="(${x4})"/>
                  <Action OrderNumber="32" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_Four" VariableExpression="(${y4})"/>
                  <Action OrderNumber="33" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_Four" VariableExpression="(${z4})"/>
                  <Action OrderNumber="34" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_Four" VariableExpression="(${a4})"/>
                  <Action OrderNumber="35" ActionType="Placeholder" Description="加权计算坐标   转换为 JSON 格式" DescriptionOverride="True"/>
                  <Action OrderNumber="36" ActionType="ListVariable" Asynchronous="False" ListVariableOp="Build" ListVariableExpression=",A,B,C,D,One,Two,Three,Four" ListVariableTarget="AdvWm_abs"/>
                  <Action OrderNumber="37" ActionType="ListVariable" Asynchronous="False" ListVariableOp="Filter" ListVariableExpressionType="Numeric" ListVariableName="AdvWm_abs" ListVariableExpression="${f:length:${${_this}}} != 0" ListVariableTarget="AdvWm_abs"/>
                  <Action OrderNumber="38" ActionType="ListVariable" Asynchronous="False" ListVariableOp="SetAll" ListVariableName="AdvWm_abs" ListVariableExpression="&quot;${_this}&quot;: {&#13;&#10;    &quot;X&quot;:${var:AdvWm_x_${_this}}, &#13;&#10;    &quot;Y&quot;:${var:AdvWm_z_${_this}}, &#13;&#10;    &quot;Z&quot;:${var:AdvWm_y_${_this}}, &#13;&#10;    &quot;Active&quot;:${var:AdvWm_a_${_this}}&#13;&#10;}"/>
                  <Action OrderNumber="39" ActionType="Placeholder" Description="输出" DescriptionOverride="True"/>
                  <Action OrderNumber="40" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="AdvWm_json" VariableExpression="{&#13;&#10;${l:AdvWm_abs.join(&quot;,⏎&quot;)}&#13;&#10;}"/>
                  <Action OrderNumber="41" Enabled="False" ActionType="Variable" Asynchronous="False" VariableOp="Clipboard" VariableName="AdvWm_json"/>
                  <Action OrderNumber="42" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="place" NamedCallbackParam="${v:AdvWm_json}" VariableOp="SetString"/>
                  <Action OrderNumber="43" ActionType="Variable" Asynchronous="False" VariableOp="UnsetRegexUniversal" VariableName="^AdvWm"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="87eed0fa-a213-41f4-8fcd-bf8aba728473" Name="线性插值标点 linearConnect" RegularExpression="^AdvWm_linearConnect:[Ss]tart:(?&lt;x0&gt;[^:]+):(?&lt;y0&gt;[^:]+):(?&lt;z0&gt;[^:]+):[Ee]nd:(?&lt;x1&gt;[^:]+):(?&lt;y1&gt;[^:]+):(?&lt;z1&gt;[^:]+):[Ww]aymarkers:(?&lt;wm&gt;[^:]+)">
                <Actions>
                  <Action OrderNumber="1" ActionType="Trigger" Asynchronous="False" TriggerOp="CancelTrigger" TriggerId="0ace1129-1f82-4630-9887-5382596b9595"/>
                  <Action OrderNumber="2" ActionType="Trigger" Asynchronous="False" TriggerOp="CancelTrigger" TriggerId="917673a7-eb88-4fe7-8213-8ff2a31fee71"/>
                  <Action OrderNumber="3" ActionType="Placeholder" Description="初始化" DescriptionOverride="True"/>
                  <Action OrderNumber="4" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_len" VariableExpression="${f:length:${wm}}"/>
                  <Action OrderNumber="5" ActionType="DictVariable" Asynchronous="False" DictVariableOp="Build" DictVariableTarget="AdvWm_WmMapping" DictVariableValue="=,A=A,B=B,C=C,D=D,1=One,2=Two,3=Three,4=Four" DictTargetPersist="True">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${pd:AdvWm_WmMapping.size}" ExpressionTypeL="String" ExpressionR="8" ExpressionTypeR="String" ConditionType="NumericNotEqual"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="6" ActionType="Placeholder" Description="wm 拆分为列表   转换为标点名" DescriptionOverride="True"/>
                  <Action OrderNumber="7" ActionType="ListVariable" Asynchronous="False" ListVariableOp="SetAll" ListVariableName="AdvWm_linear" ListVariableExpression="${pd:AdvWm_WmMapping[${f:slice(${n:${_idx}-1}):${wm}}]}" ListVariableIndex="${v:AdvWm_len}"/>
                  <Action OrderNumber="8" ActionType="Placeholder" Description="加权计算坐标   转换为 JSON 格式" DescriptionOverride="True"/>
                  <Action OrderNumber="9" ActionType="ListVariable" Asynchronous="False" ListVariableOp="SetAll" ListVariableName="AdvWm_linear" ListVariableExpression="&quot;${_this}&quot;: {&#13;&#10;    &quot;X&quot;: ${n: ((${v:AdvWm_len} - ${_idx}) * ${x0} + (${_idx} - 1) * ${x1}) / (${v:AdvWm_len} - 1)}, &#13;&#10;    &quot;Z&quot;: ${n: ((${v:AdvWm_len} - ${_idx}) * ${y0} + (${_idx} - 1) * ${y1}) / (${v:AdvWm_len} - 1)}, &#13;&#10;    &quot;Y&quot;: ${n: ((${v:AdvWm_len} - ${_idx}) * ${z0} + (${_idx} - 1) * ${z1}) / (${v:AdvWm_len} - 1)}, &#13;&#10;    &quot;Active&quot;: true&#13;&#10;}"/>
                  <Action OrderNumber="10" ActionType="Placeholder" Description="输出" DescriptionOverride="True"/>
                  <Action OrderNumber="11" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="AdvWm_json" VariableExpression="{&#13;&#10;${l:AdvWm_linear.join(&quot;,⏎&quot;)}&#13;&#10;}"/>
                  <Action OrderNumber="12" Enabled="False" ActionType="Variable" Asynchronous="False" VariableOp="Clipboard" VariableName="AdvWm_json"/>
                  <Action OrderNumber="13" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="place" NamedCallbackParam="${v:AdvWm_json}" VariableOp="SetString"/>
                  <Action OrderNumber="14" ActionType="Variable" Asynchronous="False" VariableOp="UnsetRegexUniversal" VariableName="^AdvWm"/>
                </Actions>
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${wm}" ExpressionTypeL="String" ExpressionR="[A-D1-4]{2,8}" ExpressionTypeR="String" ConditionType="RegexMatch"/>
                </Condition>
              </Trigger>
              <Trigger Enabled="true" Id="03a9f49e-4d66-46a0-b8fa-b20117d5bb14" Name="旋转矩阵标点 rotate" RegularExpression="^AdvWm_rotate(?::[Ss]cale:(?&lt;scale&gt;[^:]*))?(?::θ:(?&lt;theta&gt;[^:]*))?(?::[Cc]enter:(?&lt;x0&gt;[^:]*):(?&lt;y0&gt;[^:]*):(?&lt;z0&gt;[^:]*))?(?&lt;A&gt;:A:(?&lt;xa&gt;[^:]*):(?&lt;ya&gt;[^:]*):(?&lt;za&gt;[^:]*):(?&lt;aa&gt;[^:]*))?(?&lt;B&gt;:B:(?&lt;xb&gt;[^:]*):(?&lt;yb&gt;[^:]*):(?&lt;zb&gt;[^:]*):(?&lt;ab&gt;[^:]*))?(?&lt;C&gt;:C:(?&lt;xc&gt;[^:]*):(?&lt;yc&gt;[^:]*):(?&lt;zc&gt;[^:]*):(?&lt;ac&gt;[^:]*))?(?&lt;D&gt;:D:(?&lt;xd&gt;[^:]*):(?&lt;yd&gt;[^:]*):(?&lt;zd&gt;[^:]*):(?&lt;ad&gt;[^:]*))?(?&lt;One&gt;:One:(?&lt;x1&gt;[^:]*):(?&lt;y1&gt;[^:]*):(?&lt;z1&gt;[^:]*):(?&lt;a1&gt;[^:]*))?(?&lt;Two&gt;:Two:(?&lt;x2&gt;[^:]*):(?&lt;y2&gt;[^:]*):(?&lt;z2&gt;[^:]*):(?&lt;a2&gt;[^:]*))?(?&lt;Three&gt;:Three:(?&lt;x3&gt;[^:]*):(?&lt;y3&gt;[^:]*):(?&lt;z3&gt;[^:]*):(?&lt;a3&gt;[^:]*))?(?&lt;Four&gt;:Four:(?&lt;x4&gt;[^:]*):(?&lt;y4&gt;[^:]*):(?&lt;z4&gt;[^:]*):(?&lt;a4&gt;[^:]*))?$">
                <Actions>
                  <Action OrderNumber="1" ActionType="Trigger" Asynchronous="False" TriggerOp="CancelTrigger" TriggerId="0ace1129-1f82-4630-9887-5382596b9595"/>
                  <Action OrderNumber="2" ActionType="Trigger" Asynchronous="False" TriggerOp="CancelTrigger" TriggerId="917673a7-eb88-4fe7-8213-8ff2a31fee71"/>
                  <Action OrderNumber="3" ActionType="Placeholder" Description="本触发器为带有旋转角度的标点函数，以 给定的各组坐标偏移 与 给定角度对应的旋转矩阵 分别相乘得到各组实际坐标，并以计算结果调用鲶鱼精邮差场地标点。" DescriptionOverride="True"/>
                  <Action OrderNumber="4" ActionType="Placeholder" DescriptionOverride="True"/>
                  <Action OrderNumber="5" ActionType="Placeholder" Description="格式：AdvWm_rotate:θ:-3.14:Center:100:100:0:A:0:-10:0:1:B:10:0:0:1:C:...:D:...:One:...:Two:...:Three:...:Four:..." DescriptionOverride="True"/>
                  <Action OrderNumber="6" ActionType="Placeholder" DescriptionOverride="True"/>
                  <Action OrderNumber="7" ActionType="Placeholder" Description="θ: 作为相对北的参照物所处的坐标的 atan2(dx, dy) 值，即从绝对正北开始逆时针一周 -pi 至 pi" DescriptionOverride="True"/>
                  <Action OrderNumber="8" ActionType="Placeholder" Description="Center：场中心坐标，作为旋转中心。需要 (x0, y0, z0) 三个数值。" DescriptionOverride="True"/>
                  <Action OrderNumber="9" ActionType="Placeholder" Description="A/B/C/D/One/Two/Three/Four: 四个值：(dx, dy, dz, isActive)。其中坐标偏移以相对中心、相对方向为正北时的参考系计算。如以参照物为正北（正上）" DescriptionOverride="True"/>
                  <Action OrderNumber="10" ActionType="Placeholder" Description="如以参照物为正北（正上）时，位于场地中心左 5 下 2 的 A 点，可以记为 “A:-5:2:0:1”" DescriptionOverride="True"/>
                  <Action OrderNumber="11" ActionType="Placeholder" DescriptionOverride="True"/>
                  <Action OrderNumber="12" ActionType="Placeholder" Description="可以缺少整组数据（如 B:xB:yB:zB:isActiveB 整组省略），但剩余组要按顺序。" DescriptionOverride="True"/>
                  <Action OrderNumber="13" ActionType="Placeholder" Description="省略的θ、Center组将使用缺省值：-pi, (100, 100, 0), 省略某个标点组则不会修改该标点（与鲶鱼精邮差相同）。" DescriptionOverride="True"/>
                  <Action OrderNumber="14" ActionType="Placeholder" DescriptionOverride="True"/>
                  <Action OrderNumber="15" ActionType="Placeholder" Description="也可以缺少单个数据，但要保留冒号，如前文“A:-5:2:0:1”可以记做“A:-5:2::1”，场地中心的 3 点可记做“Three::::1”。" DescriptionOverride="True"/>
                  <Action OrderNumber="16" ActionType="Placeholder" Description="省略的参数将使用缺省值：x0 = 100, y0 = 100, z0 = 0, θ = -pi, 标点的四个参数均为 0" DescriptionOverride="True"/>
                  <Action OrderNumber="17" ActionType="Placeholder" DescriptionOverride="True"/>
                  <Action OrderNumber="18" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_θ" VariableExpression="${theta} ?? -pi"/>
                  <Action OrderNumber="19" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x0" VariableExpression="${x0} ?? 100"/>
                  <Action OrderNumber="20" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y0" VariableExpression="${y0} ?? 100"/>
                  <Action OrderNumber="21" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z0" VariableExpression="(${z0})"/>
                  <Action OrderNumber="22" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_A" VariableExpression="(${xa})"/>
                  <Action OrderNumber="23" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_A" VariableExpression="(${ya})"/>
                  <Action OrderNumber="24" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_A" VariableExpression="(${za})"/>
                  <Action OrderNumber="25" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_A" VariableExpression="(${aa})"/>
                  <Action OrderNumber="26" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_B" VariableExpression="(${xb})"/>
                  <Action OrderNumber="27" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_B" VariableExpression="(${yb})"/>
                  <Action OrderNumber="28" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_B" VariableExpression="(${zb})"/>
                  <Action OrderNumber="29" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_B" VariableExpression="(${ab})"/>
                  <Action OrderNumber="30" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_C" VariableExpression="(${xc})"/>
                  <Action OrderNumber="31" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_C" VariableExpression="(${yc})"/>
                  <Action OrderNumber="32" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_C" VariableExpression="(${zc})"/>
                  <Action OrderNumber="33" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_C" VariableExpression="(${ac})"/>
                  <Action OrderNumber="34" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_D" VariableExpression="(${xd})"/>
                  <Action OrderNumber="35" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_D" VariableExpression="(${yd})"/>
                  <Action OrderNumber="36" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_D" VariableExpression="(${zd})"/>
                  <Action OrderNumber="37" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_D" VariableExpression="(${ad})"/>
                  <Action OrderNumber="38" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_One" VariableExpression="(${x1})"/>
                  <Action OrderNumber="39" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_One" VariableExpression="(${y1})"/>
                  <Action OrderNumber="40" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_One" VariableExpression="(${z1})"/>
                  <Action OrderNumber="41" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_One" VariableExpression="(${a1})"/>
                  <Action OrderNumber="42" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_Two" VariableExpression="(${x2})"/>
                  <Action OrderNumber="43" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_Two" VariableExpression="(${y2})"/>
                  <Action OrderNumber="44" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_Two" VariableExpression="(${z2})"/>
                  <Action OrderNumber="45" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_Two" VariableExpression="(${a2})"/>
                  <Action OrderNumber="46" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_Three" VariableExpression="(${x3})"/>
                  <Action OrderNumber="47" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_Three" VariableExpression="(${y3})"/>
                  <Action OrderNumber="48" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_Three" VariableExpression="(${z3})"/>
                  <Action OrderNumber="49" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_Three" VariableExpression="(${a3})"/>
                  <Action OrderNumber="50" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x_Four" VariableExpression="(${x4})"/>
                  <Action OrderNumber="51" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y_Four" VariableExpression="(${y4})"/>
                  <Action OrderNumber="52" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_Four" VariableExpression="(${z4})"/>
                  <Action OrderNumber="53" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_Four" VariableExpression="(${a4})"/>
                  <Action OrderNumber="54" ActionType="Placeholder" Description="加权计算坐标   转换为 JSON 格式" DescriptionOverride="True"/>
                  <Action OrderNumber="55" ActionType="ListVariable" Asynchronous="False" ListVariableOp="Build" ListVariableExpression=",A,B,C,D,One,Two,Three,Four" ListVariableTarget="AdvWm_rotate"/>
                  <Action OrderNumber="56" ActionType="ListVariable" Asynchronous="False" ListVariableOp="Filter" ListVariableExpressionType="Numeric" ListVariableName="AdvWm_rotate" ListVariableExpression="${f:length:${${_this}}} != 0" ListVariableTarget="AdvWm_rotate"/>
                  <Action OrderNumber="57" ActionType="ListVariable" Asynchronous="False" ListVariableOp="SetAll" ListVariableName="AdvWm_rotate" ListVariableExpression="&quot;${_this}&quot;: {&#13;&#10;    &quot;X&quot;:${n: ${var:AdvWm_x0} + (${scale} ?? 1) * (- ${var:AdvWm_x_${_this}}*cos(${var:AdvWm_θ}) - ${var:AdvWm_y_${_this}}*sin(${var:AdvWm_θ}))}, &#13;&#10;    &quot;Y&quot;:${n: ${var:AdvWm_z0} + (${scale} ?? 1) * ${var:AdvWm_z_${_this}}}, &#13;&#10;    &quot;Z&quot;:${n: ${var:AdvWm_y0} + (${scale} ?? 1) * (+ ${var:AdvWm_x_${_this}}*sin(${var:AdvWm_θ}) - ${var:AdvWm_y_${_this}}*cos(${var:AdvWm_θ}))}, &#13;&#10;    &quot;Active&quot;:${var:AdvWm_a_${_this}}&#13;&#10;}"/>
                  <Action OrderNumber="58" ActionType="Placeholder" Description="输出" DescriptionOverride="True"/>
                  <Action OrderNumber="59" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="AdvWm_json" VariableExpression="{&#13;&#10;${l:AdvWm_rotate.join(&quot;,⏎&quot;)}&#13;&#10;}"/>
                  <Action OrderNumber="60" Enabled="False" ActionType="Variable" Asynchronous="False" VariableOp="Clipboard" VariableName="AdvWm_json"/>
                  <Action OrderNumber="61" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="place" NamedCallbackParam="${v:AdvWm_json}" VariableOp="SetString"/>
                  <Action OrderNumber="62" ActionType="Variable" Asynchronous="False" VariableOp="UnsetRegexUniversal" VariableName="^AdvWm"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="1ee1920e-ea5e-4075-bd68-0d994e91a213" Name="极坐标标点 polarDeg / polarRad" RegularExpression="^AdvWm_polar(?&lt;type&gt;Deg|Rad)(?::[Ss]cale:(?&lt;scale&gt;[^:]*))?(?::θ:(?&lt;theta&gt;[^:]*))?(?::[Cc]enter:(?&lt;x0&gt;[^:]*):(?&lt;y0&gt;[^:]*):(?&lt;z0&gt;[^:]*))?(?&lt;A&gt;:A:(?&lt;ra&gt;[^:]*):(?&lt;thetaa&gt;[^:]*):(?&lt;za&gt;[^:]*):(?&lt;aa&gt;[^:]*))?(?&lt;B&gt;:B:(?&lt;rb&gt;[^:]*):(?&lt;thetab&gt;[^:]*):(?&lt;zb&gt;[^:]*):(?&lt;ab&gt;[^:]*))?(?&lt;C&gt;:C:(?&lt;rc&gt;[^:]*):(?&lt;thetac&gt;[^:]*):(?&lt;zc&gt;[^:]*):(?&lt;ac&gt;[^:]*))?(?&lt;D&gt;:D:(?&lt;rd&gt;[^:]*):(?&lt;thetad&gt;[^:]*):(?&lt;zd&gt;[^:]*):(?&lt;ad&gt;[^:]*))?(?&lt;One&gt;:One:(?&lt;r1&gt;[^:]*):(?&lt;theta1&gt;[^:]*):(?&lt;z1&gt;[^:]*):(?&lt;a1&gt;[^:]*))?(?&lt;Two&gt;:Two:(?&lt;r2&gt;[^:]*):(?&lt;theta2&gt;[^:]*):(?&lt;z2&gt;[^:]*):(?&lt;a2&gt;[^:]*))?(?&lt;Three&gt;:Three:(?&lt;r3&gt;[^:]*):(?&lt;theta3&gt;[^:]*):(?&lt;z3&gt;[^:]*):(?&lt;a3&gt;[^:]*))?(?&lt;Four&gt;:Four:(?&lt;r4&gt;[^:]*):(?&lt;theta4&gt;[^:]*):(?&lt;z4&gt;[^:]*):(?&lt;a4&gt;[^:]*))?$">
                <Actions>
                  <Action OrderNumber="1" ActionType="Trigger" Asynchronous="False" TriggerOp="CancelTrigger" TriggerId="0ace1129-1f82-4630-9887-5382596b9595"/>
                  <Action OrderNumber="2" ActionType="Trigger" Asynchronous="False" TriggerOp="CancelTrigger" TriggerId="917673a7-eb88-4fe7-8213-8ff2a31fee71"/>
                  <Action OrderNumber="3" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_dθ" VariableExpression="(${theta} ?? -pi) + pi"/>
                  <Action OrderNumber="4" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_x0" VariableExpression="${x0} ?? 100"/>
                  <Action OrderNumber="5" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_y0" VariableExpression="${y0} ?? 100"/>
                  <Action OrderNumber="6" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z0" VariableExpression="(${z0})"/>
                  <Action OrderNumber="7" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_r_A" VariableExpression="(${ra})"/>
                  <Action OrderNumber="8" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_θ_A" VariableExpression="((${type} == Deg) ? pi/180 : 1) * (${thetaa})"/>
                  <Action OrderNumber="9" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_A" VariableExpression="(${za})"/>
                  <Action OrderNumber="10" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_A" VariableExpression="(${aa})"/>
                  <Action OrderNumber="11" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_r_B" VariableExpression="(${rb})"/>
                  <Action OrderNumber="12" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_θ_B" VariableExpression="((${type} == Deg) ? pi/180 : 1) * (${thetab})"/>
                  <Action OrderNumber="13" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_B" VariableExpression="(${zb})"/>
                  <Action OrderNumber="14" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_B" VariableExpression="(${ab})"/>
                  <Action OrderNumber="15" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_r_C" VariableExpression="(${rc})"/>
                  <Action OrderNumber="16" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_θ_C" VariableExpression="((${type} == Deg) ? pi/180 : 1) * (${thetac})"/>
                  <Action OrderNumber="17" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_C" VariableExpression="(${zc})"/>
                  <Action OrderNumber="18" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_C" VariableExpression="(${ac})"/>
                  <Action OrderNumber="19" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_r_D" VariableExpression="(${rd})"/>
                  <Action OrderNumber="20" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_θ_D" VariableExpression="((${type} == Deg) ? pi/180 : 1) * (${thetad})"/>
                  <Action OrderNumber="21" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_D" VariableExpression="(${zd})"/>
                  <Action OrderNumber="22" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_D" VariableExpression="(${ad})"/>
                  <Action OrderNumber="23" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_r_One" VariableExpression="(${r1})"/>
                  <Action OrderNumber="24" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_θ_One" VariableExpression="((${type} == Deg) ? pi/180 : 1) * (${theta1})"/>
                  <Action OrderNumber="25" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_One" VariableExpression="(${z1})"/>
                  <Action OrderNumber="26" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_One" VariableExpression="(${a1})"/>
                  <Action OrderNumber="27" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_r_Two" VariableExpression="(${r2})"/>
                  <Action OrderNumber="28" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_θ_Two" VariableExpression="((${type} == Deg) ? pi/180 : 1) * (${theta2})"/>
                  <Action OrderNumber="29" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_Two" VariableExpression="(${z2})"/>
                  <Action OrderNumber="30" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_Two" VariableExpression="(${a2})"/>
                  <Action OrderNumber="31" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_r_Three" VariableExpression="(${r3})"/>
                  <Action OrderNumber="32" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_θ_Three" VariableExpression="((${type} == Deg) ? pi/180 : 1) * (${theta3})"/>
                  <Action OrderNumber="33" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_Three" VariableExpression="(${z3})"/>
                  <Action OrderNumber="34" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_Three" VariableExpression="(${a3})"/>
                  <Action OrderNumber="35" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_r_Four" VariableExpression="(${r4})"/>
                  <Action OrderNumber="36" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_θ_Four" VariableExpression="((${type} == Deg) ? pi/180 : 1) * (${theta4})"/>
                  <Action OrderNumber="37" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_z_Four" VariableExpression="(${z4})"/>
                  <Action OrderNumber="38" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="AdvWm_a_Four" VariableExpression="(${a4})"/>
                  <Action OrderNumber="39" Enabled="False" ActionType="Placeholder" Description="加权计算坐标   转换为 JSON 格式" DescriptionOverride="True"/>
                  <Action OrderNumber="40" ActionType="ListVariable" Asynchronous="False" ListVariableOp="Build" ListVariableExpression=",A,B,C,D,One,Two,Three,Four" ListVariableTarget="AdvWm_polar"/>
                  <Action OrderNumber="41" ActionType="ListVariable" Asynchronous="False" ListVariableOp="Filter" ListVariableExpressionType="Numeric" ListVariableName="AdvWm_polar" ListVariableExpression="${f:length:${${_this}}} != 0" ListVariableTarget="AdvWm_polar"/>
                  <Action OrderNumber="42" ActionType="ListVariable" Asynchronous="False" ListVariableOp="SetAll" ListVariableName="AdvWm_polar" ListVariableExpression="&quot;${_this}&quot;: {&#13;&#10;    &quot;X&quot;: ${n: ${v:AdvWm_x0} + (${scale} ?? 1) * ${v:AdvWm_r_${_this}} * sin(${v:AdvWm_θ_${_this}} + ${v:AdvWm_dθ}) }, &#13;&#10;    &quot;Y&quot;: ${n: ${v:AdvWm_z0} + (${scale} ?? 1) * ${v:AdvWm_z_${_this}} }, &#13;&#10;    &quot;Z&quot;: ${n: ${v:AdvWm_y0} + (${scale} ?? 1) * ${v:AdvWm_r_${_this}} * cos(${v:AdvWm_θ_${_this}} + ${v:AdvWm_dθ}) }, &#13;&#10;    &quot;Active&quot;: ${v:AdvWm_a_${_this}}&#13;&#10;}"/>
                  <Action OrderNumber="43" Enabled="False" ActionType="Placeholder" Description="输出" DescriptionOverride="True"/>
                  <Action OrderNumber="44" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="AdvWm_json" VariableExpression="{&#13;&#10;${l:AdvWm_polar.join(&quot;,⏎&quot;)}&#13;&#10;}"/>
                  <Action OrderNumber="45" Enabled="False" ActionType="Variable" Asynchronous="False" VariableOp="Clipboard" VariableName="AdvWm_json"/>
                  <Action OrderNumber="46" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="place" NamedCallbackParam="${v:AdvWm_json}" VariableOp="SetString"/>
                  <Action OrderNumber="47" ActionType="Variable" Asynchronous="False" VariableOp="UnsetRegexUniversal" VariableName="^AdvWm"/>
                </Actions>
              </Trigger>
            </Triggers>
          </Folder>
          <Folder Id="a7821f6a-934b-4c0a-a8d7-3ee78191e3a5" Enabled="true" Name="实体标点">
            <Triggers>
              <Trigger Enabled="true" Id="8c8cd941-4bdb-430c-b067-4382c95502c1" Name="清空标点（网络） networkClear" RegularExpression="^AdvHm_networkClear:(?&lt;orders&gt;[1-8]+)">
                <Actions>
                  <Action OrderNumber="1" ActionType="ListVariable" Asynchronous="False" ListVariableOp="SetAll" ListVariableName="AdvHm_clearAll" ListVariableExpression="    { &quot;c&quot;: &quot;command&quot;, &quot;p&quot;: &quot;/mk clear &lt;${f:slice(${_idx}):0${orders}}&gt;&quot; }" ListVariableIndex="${f:length:${orders}}"/>
                  <Action OrderNumber="2" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="AdvHm_clearAll" VariableExpression="[&#13;&#10;${l:AdvHm_clearAll.join(&quot;,⏎&quot;)}&#13;&#10;]"/>
                  <Action OrderNumber="3" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="queue" NamedCallbackParam="${v:AdvHm_clearAll}"/>
                  <Action OrderNumber="4" ActionType="Variable" Asynchronous="False" VariableName="AdvHm_clearAll"/>
                  <Action OrderNumber="5" ActionType="ListVariable" Asynchronous="False" ListVariableName="AdvHm_clearAll"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="3c235e59-797c-4ecc-8b30-a45a3f4c513e" Name="清空标点（本地） localClear" RegularExpression="^AdvHm_localClear:(?!all$)(?&lt;listname&gt;[^:]+)">
                <Actions>
                  <Action OrderNumber="1" ActionType="ListVariable" Asynchronous="False" ListVariableOp="SetAll" ListVariableName="AdvHm_clearAll" ListVariableExpression="    {&#13;&#10;        &quot;c&quot;: &quot;mark&quot;,&#13;&#10;        &quot;p&quot;: &quot;{\&quot;Name\&quot;: \&quot;${l:${listname}[${_idx}]}\&quot;, \&quot;MarkType\&quot;: \&quot;0\&quot;, \&quot;LocalOnly\&quot;: 1}&quot;&#13;&#10;    }" ListVariableIndex="${l:${listname}.size}"/>
                  <Action OrderNumber="2" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="AdvHm_clearAll" VariableExpression="[&#13;&#10;${l:AdvHm_clearAll.join(&quot;,⏎&quot;)}&#13;&#10;]"/>
                  <Action OrderNumber="3" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="queue" NamedCallbackParam="${v:AdvHm_clearAll}"/>
                  <Action OrderNumber="4" ActionType="Variable" Asynchronous="False" VariableName="AdvHm_clearAll"/>
                  <Action OrderNumber="5" ActionType="ListVariable" Asynchronous="False" ListVariableName="AdvHm_clearAll"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="0d77bf8b-8133-4658-99ed-70c8bd92c9e1" Name="清空全部标点（本地） localClear:all" RegularExpression="^AdvHm_localClear:all(?::id:(?&lt;id&gt;.+))?$" Sequential="True">
                <Actions>
                  <Action OrderNumber="1" ActionType="Placeholder" Description="指定一个实体 ID，对其遍历执行所有标点后清除标点。ID 未提供时默认为自己。" DescriptionOverride="True"/>
                  <Action OrderNumber="2" ActionType="Variable" VariableOp="SetString" VariableName="tmp_id" VariableExpression="0x${_me.id}">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${id}" ExpressionTypeL="String" ExpressionR="[14]0.{6}" ExpressionTypeR="String" ConditionType="RegexNotMatch"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="3" ActionType="Variable" VariableOp="SetString" VariableName="tmp_id" VariableExpression="0x${id}">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${id}" ExpressionTypeL="String" ExpressionR="[14]0.{6}" ExpressionTypeR="String" ConditionType="RegexMatch"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="4" ActionType="Loop" LoopInitExpression="32" LoopIncrExpression="-1">
                    <LoopCondition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${_i}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="NumericGreaterEqual"/>
                    </LoopCondition>
                    <LoopActions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="mark" NamedCallbackParam="{&#13;&#10;    &quot;ActorID&quot;: ${v:tmp_id},&#13;&#10;    &quot;MarkType&quot;: ${_i},&#13;&#10;    &quot;LocalOnly&quot;: true&#13;&#10;}"/>
                    </LoopActions>
                  </Action>
                  <Action OrderNumber="5" ActionType="Variable" VariableName="tmp_id">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${id}" ExpressionTypeL="String" ExpressionR="[14]0.{6}" ExpressionTypeR="String" ConditionType="RegexMatch"/>
                    </Condition>
                  </Action>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="2d6e5c83-5c1e-454c-ad61-1d71ca705f76" Name="单个实体标点 mark" RegularExpression="^AdvHm_mark:(?&lt;entity&gt;[^:]+):(?&lt;marker&gt;[^:]+):(?&lt;isLocal&gt;[^:]+)">
                <Actions>
                  <Action OrderNumber="1" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="tmp_match" VariableExpression="1">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${entity}" ExpressionTypeL="String" ExpressionR="^[14]0[A-F0-9].{6}$" ExpressionTypeR="String" ConditionType="RegexMatch"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="2" ActionType="NamedCallback" NamedCallbackName="mark" NamedCallbackParam="{&#13;&#10;  &quot;ActorID&quot;: 0x${entity},&#13;&#10;  &quot;MarkType&quot;: &quot;${marker}&quot;,&#13;&#10;  &quot;LocalOnly&quot;: ${isLocal} &#13;&#10;}">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${v:tmp_match}" ExpressionTypeL="Numeric" ExpressionR="1" ExpressionTypeR="Numeric" ConditionType="NumericEqual"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="3" ActionType="NamedCallback" NamedCallbackName="mark" NamedCallbackParam="{&#13;&#10;  &quot;Name&quot;: &quot;${entity}&quot;,&#13;&#10;  &quot;MarkType&quot;: &quot;${marker}&quot;,&#13;&#10;  &quot;LocalOnly&quot;: ${isLocal} &#13;&#10;}">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${v:tmp_match}" ExpressionTypeL="Numeric" ExpressionR="0" ExpressionTypeR="Numeric" ConditionType="NumericEqual"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="4" ActionType="NamedCallback" NamedCallbackName="mark" NamedCallbackParam="{&#13;&#10;  ${f:ifmatch(${entity}, '&quot;ActorID&quot;: 0x${entity}', '&quot;Name&quot;: &quot;${entity}&quot;'):[14]0[0-9A-F]｛6｝},&#13;&#10;  &quot;MarkType&quot;: &quot;${marker}&quot;,&#13;&#10;  &quot;LocalOnly&quot;: ${isLocal} &#13;&#10;}"/>
                  <Action OrderNumber="5" ActionType="Variable" Asynchronous="False" VariableName="tmp_match"/>
                </Actions>
              </Trigger>
            </Triggers>
          </Folder>
        </Folders>
      </Folder>
      <Folder Id="a7e8b210-6676-4804-ac0a-ce23b6f1b5b6" Enabled="true" Name="调试工具 / 实用工具">
        <Folders>
          <Folder Id="cb3f4718-617e-486a-876b-cfa2d8a91895" Enabled="true" Name="查询实体信息">
            <Triggers>
              <Trigger Enabled="true" Id="5eeca562-22c5-4bde-9e09-d189fcddb3ec" Name="查询" RegularExpression="^EntityInfo:(.+)">
                <Actions>
                  <Action OrderNumber="1" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="command" NamedCallbackParam="/e 【—————查询实体信息—————】&#13;&#10;实体：${_ffxiventity[$1].name}（${_ffxiventity[$1].id}）&#13;&#10;BNpcID = ${_ffxiventity[$1].BNpcID}  BNpcNameID = ${_ffxiventity[$1].BNpcNameID}&#13;&#10;@ (${n:round(${_entity[$1].x}, 3)}, ${n:round(${_entity[$1].y}, 3)}), ${n:round(${_entity[$1].z}, 3)}&#13;&#10;→ ${n:round(${_entity[$1].heading}, 3)} = ${n:round(${_entity[$1].heading}/pi, 3)}π (${f:pick(${n: roundir(${_entity[$1].heading}, 8)}): 上北, 左上, 左西, 左下, 下南, 右下, 右东, 右上}）&#13;&#10;水平距离：${n: distance(${_entity[$1].xy}, ${_me.xy})} m&#13;&#10;HP：${_entity[$1].currenthp} / ${_ffxiventity[$1].maxhp}&#13;&#10;》${_entity[${_entity[$1].targetid}].name}（${_entity[$1].targetid}）"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="a7e377f7-5990-4719-821a-6e163b1aba98" Name="/e entity （未指定目标：查询自身/选中的目标）" RegularExpression="^.{15}\S+ 00:0038::(?i)en(?:tity)? ?$">
                <Actions>
                  <Action OrderNumber="1" ActionType="Placeholder" Description="选中正常目标时：查询目标信息" DescriptionOverride="True"/>
                  <Action OrderNumber="2" ActionType="LogMessage" LogMessageText="EntityInfo:${_me.targetid}" LogProcess="True">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${_me.targetid}" ExpressionTypeL="String" ExpressionR="^[14].{7}$" ExpressionTypeR="String" ConditionType="RegexMatch"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="3" ActionType="Placeholder" Description="选中 NPC 类目标时：报错" DescriptionOverride="True"/>
                  <Action OrderNumber="4" ActionType="NamedCallback" LogProcess="True" NamedCallbackName="command" NamedCallbackParam="/e 无法查询 NPC。（ID: ${_me.targetid}）">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${_me.targetid}" ExpressionTypeL="String" ExpressionR="^0.{7}$" ExpressionTypeR="String" ConditionType="RegexMatch"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="5" ActionType="Placeholder" Description="选中自身或未选中任何目标时：targetid 返回 0，查询自身信息" DescriptionOverride="True"/>
                  <Action OrderNumber="6" ActionType="LogMessage" LogMessageText="EntityInfo:${_me.id}" LogProcess="True">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="0x0${_me.targetid}" ExpressionTypeL="Numeric" ExpressionR="0" ExpressionTypeR="String" ConditionType="NumericEqual"/>
                    </Condition>
                  </Action>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="86869c6a-7ca4-4b8b-8b45-975678d56af5" Name="/e entity [name/id]" RegularExpression="^.{15}\S+ 00:0038::(?i)en(?:tity)? +(.*)$">
                <Actions>
                  <Action OrderNumber="1" ActionType="Placeholder" Description="指定的名字/id存在：查询目标信息" DescriptionOverride="True"/>
                  <Action OrderNumber="2" ActionType="LogMessage" LogMessageText="EntityInfo:$1" LogProcess="True">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${_ffxiventity[$1].id}" ExpressionTypeL="String" ExpressionR="" ExpressionTypeR="String" ConditionType="StringNotEqualNocase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="3" ActionType="Placeholder" Description="指定的名字/id不存在：报错" DescriptionOverride="True"/>
                  <Action OrderNumber="4" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="command" NamedCallbackParam="/e 指定查询的实体 [$1] 不存在。">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="0x0${_ffxiventity[$1].id}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                </Actions>
              </Trigger>
            </Triggers>
          </Folder>
        </Folders>
        <Triggers>
          <Trigger Enabled="true" Id="ad7808a6-022c-4e6c-93d1-976f3a112de6" Name="ACT Combat Log Filter" RegularExpression="^(.{15}\S+ 00:0038:: *)?(?i:filter) *$" Sequential="True">
            <Actions>
              <Action OrderNumber="1" ActionType="Placeholder" Description="by 阿洛 MnFeN" DescBgColor="def" DescriptionOverride="True"/>
              <Action OrderNumber="2" ActionType="Placeholder" Description="使用说明" DescBgColor="acf" DescriptionOverride="True"/>
              <Action OrderNumber="3" ActionType="Placeholder" Description="1. 在 ACT 战斗记录中复制所有战斗日志；" DescBgColor="def" DescriptionOverride="True"/>
              <Action OrderNumber="4" ActionType="Placeholder" Description="2. 在游戏内输入 &quot;/e filter&quot;，或在触发器测试输入界面输入 &quot;filter&quot; (Ctrl + T)" DescBgColor="def" DescriptionOverride="True"/>
              <Action OrderNumber="5" ActionType="Placeholder" Description="3. 过滤后的日志会写入剪贴板（移除垃圾日志）。" DescBgColor="def" DescriptionOverride="True"/>
              <Action OrderNumber="6" ActionType="Placeholder" Description="Instructions" DescBgColor="acf" DescriptionOverride="True"/>
              <Action OrderNumber="7" ActionType="Placeholder" Description="1. Copy all ACT loglines from ACT combat log; " DescBgColor="def" DescriptionOverride="True"/>
              <Action OrderNumber="8" ActionType="Placeholder" Description="2. Enter &quot;/e filter&quot; in game, or enter &quot;filter&quot; in Triggernometry Test Input (Ctrl + T)" DescBgColor="def" DescriptionOverride="True"/>
              <Action OrderNumber="9" ActionType="Placeholder" Description="3. The filtered logs would be set to the clipboard. (junk data removed)" DescBgColor="def" DescriptionOverride="True"/>
              <Action OrderNumber="10" ActionType="ExecuteScript" ExecScriptExpression="using System;&#13;&#10;using System.Text.RegularExpressions;&#13;&#10;using System.Windows.Forms;&#13;&#10;using System.Collections.Generic;&#13;&#10;using System.Linq;&#13;&#10;using System.Threading;&#13;&#10;using System.Globalization;&#13;&#10;using Triggernometry.Core;&#13;&#10;using Triggernometry.Core.Scripting;&#13;&#10;&#13;&#10;public static class LogFilter&#13;&#10;{&#13;&#10;    private static readonly HashSet&lt;string&gt; junkEntities = new HashSet&lt;string&gt;&#13;&#10;    {&#13;&#10;        // 召唤&#13;&#10;        &quot;宝石兽&quot;, &quot;Carbuncle&quot;, &quot;カーバンクル&quot;,&#13;&#10;        &quot;红宝石兽&quot;, &quot;Ruby Carbuncle&quot;, &quot;カーバンクル・ルビー&quot;,&#13;&#10;        &quot;黄宝石兽&quot;, &quot;Topaz Carbuncle&quot;, &quot;カーバンクル・トパーズ&quot;,&#13;&#10;        &quot;绿宝石兽&quot;, &quot;Emerald Carbuncle&quot;, &quot;カーバンクル・エメラルド&quot;,&#13;&#10;        &quot;伊弗利特之灵&quot;, &quot;Ifrit-Egi&quot;, &quot;イフリート・エギ&quot;,&#13;&#10;        &quot;泰坦之灵&quot;, &quot;Titan-Egi&quot;, &quot;タイタン・エギ&quot;,&#13;&#10;        &quot;迦楼罗之灵&quot;, &quot;Garuda-Egi&quot;, &quot;ガルーダ・エギ&quot;,&#13;&#10;        &quot;红宝石伊弗利特&quot;, &quot;Ruby Ifrit&quot;, &quot;イフリート・ルビー&quot;,&#13;&#10;        &quot;黄宝石泰坦&quot;, &quot;Topaz Titan&quot;, &quot;タイタン・トパーズ&quot;,&#13;&#10;        &quot;绿宝石迦楼罗&quot;, &quot;Emerald Garuda&quot;, &quot;ガルーダ・エメラルド&quot;,&#13;&#10;        &quot;亚灵神巴哈姆特&quot;, &quot;Demi-Bahamut&quot;, &quot;デミ・バハムート&quot;,&#13;&#10;        &quot;亚灵神不死鸟&quot;, &quot;Demi-Phoenix&quot;, &quot;デミ・フェニックス&quot;,&#13;&#10;        &quot;烈日巴哈姆特&quot;, &quot;Solar Bahamut&quot;, &quot;ソルバハムート&quot;, &#13;&#10;        // 黑骑&#13;&#10;        &quot;英雄的掠影&quot;, &quot;Esteem&quot;, &quot;英雄の影身&quot;, &#13;&#10;        // 机工&#13;&#10;        &quot;车式浮空炮塔&quot;, &quot;Rook Autoturret&quot;, &quot;オートタレット・ルーク&quot;,&#13;&#10;        &quot;后式自走人偶&quot;, &quot;Automaton Queen&quot;, &quot;オートマトン・クイーン&quot;, &#13;&#10;        // 占星&#13;&#10;        &quot;地星&quot;, &quot;Earthly Star&quot;, &quot;アーサリースター&quot;, &#13;&#10;        // 学者&#13;&#10;        &quot;朝日小仙女&quot;, &quot;Eos&quot;, &quot;フェアリー・エオス&quot;,&#13;&#10;        &quot;夕月小仙女&quot;, &quot;Selene&quot;, &quot;フェアリー・セレネ&quot;,&#13;&#10;        &quot;炽天使&quot;, &quot;Seraph&quot;, &quot;セラフィム&quot;,&#13;&#10;        // 白魔&#13;&#10;        &quot;礼仪之铃&quot;, &quot;Liturgy of the Bell&quot;, &quot;リタージー・オブ・ベル&quot;,&#13;&#10;        // 忍者&#13;&#10;        &quot;分身&quot;, &quot;Bunshin&quot;, /*&quot;分身&quot;*/&#13;&#10;    };&#13;&#10;&#13;&#10;    private static readonly List&lt;Regex&gt; junkPatterns = new List&lt;Regex&gt;&#13;&#10;    {&#13;&#10;        new Regex(@&quot;^.{15}\S+ (1[4-9]|2[67]|10[578]|105:[^:]+|1[AE]:[^:]*:[^:]*:[^:]*):1.{7}:&quot;, RegexOptions.Compiled), // 玩家导致的技能、状态、实体等变化&#13;&#10;        new Regex(@&quot;^.{15}\S+ 00:(?!0039|0044|0839)&quot;, RegexOptions.Compiled), // 无用的聊天文本和系统消息&#13;&#10;        new Regex(@&quot;^.{15}\S+ (1[8F]|2[45]|F[BE]|10E|105:Change):&quot;, RegexOptions.Compiled), // DoTHoT，量谱，LB，技能结果，Debug/Error，ActorMove，CombatantChange&#13;&#10;        new Regex(@&quot;^.{15}\S+ 26:.{50}.+$&quot;, RegexOptions.Compiled), // 过长的 StatusList（P12s 曾出现过可以预判翅膀的假实体 StatusList 日志，很短）&#13;&#10;        new Regex(@&quot;^.{15}\S+ 1[AE]:(94|2B|1A2):&quot;, RegexOptions.Compiled), // 复活，衰弱，生还&#13;&#10;        new Regex(@&quot;^.{15}\S+ 110:4.{7}:E0000000:0000:00&quot;, RegexOptions.Compiled), // 没有任何额外信息的“额外实体信息”行&#13;&#10;    };&#13;&#10;&#13;&#10;    public static void FilterLogs()&#13;&#10;    {&#13;&#10;        string clipboardData = Clipboard.GetText();&#13;&#10;&#13;&#10;        string junkEntitiesPattern = string.Join(&quot;|&quot;, junkEntities.Select(Regex.Escape));&#13;&#10;        Regex idPattern = new Regex($@&quot;:(40.{{6}}):({junkEntitiesPattern}):&quot;);&#13;&#10;        HashSet&lt;string&gt; idsToRemove = idPattern.Matches(clipboardData).Cast&lt;Match&gt;().Select(m =&gt; $&quot;:{m.Groups[1].Value}:&quot;).ToHashSet();&#13;&#10;&#13;&#10;        string[] lines = clipboardData.Split(new[] { &quot;\r\n&quot;, &quot;\r&quot;, &quot;\n&quot; }, StringSplitOptions.RemoveEmptyEntries);&#13;&#10;        var filteredLines = lines.Where(line =&gt;&#13;&#10;            !idsToRemove.Any(id =&gt; line.Contains(id)) &amp;&amp;&#13;&#10;            !junkPatterns.Any(pattern =&gt; pattern.IsMatch(line))&#13;&#10;        ).ToArray();&#13;&#10;        var result = string.Join(&quot;\r\n&quot;, filteredLines);&#13;&#10;        if (string.IsNullOrEmpty(result))&#13;&#10;        {&#13;&#10;            Clipboard.Clear();&#13;&#10;        }&#13;&#10;        else&#13;&#10;        {&#13;&#10;            Clipboard.SetText(result);&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    [STAThread]&#13;&#10;    public static void Main()&#13;&#10;    {&#13;&#10;        Thread thread = new Thread(() =&gt;&#13;&#10;        {&#13;&#10;            try&#13;&#10;            {&#13;&#10;                FilterLogs();&#13;&#10;                RealPlugin.Instance.TtsPlaybackHook(&quot;筛选完成&quot;);&#13;&#10;            }&#13;&#10;            catch (Exception ex)&#13;&#10;            {&#13;&#10;                MessageBox.Show($&quot;筛选结果失败：\n{ex}&quot;, &quot;Log Filter&quot;, MessageBoxButtons.OK, MessageBoxIcon.Error);&#13;&#10;                RealPlugin.Instance.TtsPlaybackHook(&quot;筛选失败&quot;);&#13;&#10;            }&#13;&#10;        });&#13;&#10;        thread.SetApartmentState(ApartmentState.STA);&#13;&#10;        thread.Start();&#13;&#10;        thread.Join();&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;RealPlugin.Instance.RegisterNamedCallback(&quot;LogFilter&quot;, new System.Action&lt;object, string&gt;((_, __) =&gt; LogFilter.Main()), &quot;阿洛&quot;);">
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${ecallback:LogFilter}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Action>
              <Action OrderNumber="11" ActionType="NamedCallback" NamedCallbackName="LogFilter"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="89f5faab-9673-4460-aa5d-0a7c4cacc806" Name="ACT Combat Log Anonymizer" RegularExpression="^(.{15}\S+ 00:0038:: *)?(?i:anonymizer|匿名|niming|nm) *$">
            <Actions>
              <Action OrderNumber="1" ActionType="Placeholder" Description="by 阿洛 MnFeN" DescBgColor="def" DescriptionOverride="True"/>
              <Action OrderNumber="2" ActionType="Placeholder" Description="使用说明" DescBgColor="acf" DescriptionOverride="True"/>
              <Action OrderNumber="3" ActionType="Placeholder" Description="用于配合触发器的调试日志生成器" DescBgColor="def" DescriptionOverride="True"/>
              <Action OrderNumber="4" ActionType="Placeholder" Description="1. 在 ACT 战斗记录中复制所需的战斗日志片段；" DescBgColor="def" DescriptionOverride="True"/>
              <Action OrderNumber="5" ActionType="Placeholder" Description="2. 在游戏内输入 &quot;/e anonymizer/匿名&quot;，或在触发器测试输入界面输入 &quot;anonymizer&quot; / &quot;匿名&quot; (Ctrl + T)" DescBgColor="def" DescriptionOverride="True"/>
              <Action OrderNumber="6" ActionType="Placeholder" Description="3. 所有队员的 id 和名称会转为占位符 &quot;${l:party[n]}:队员n&quot;，并写入剪贴板，这会在测试日志时自动填入当前的小队成员 id。" DescBgColor="def" DescriptionOverride="True"/>
              <Action OrderNumber="7" ActionType="ExecuteScript" Asynchronous="False" ExecScriptExpression="using System;&#13;&#10;using System.Collections.Generic;&#13;&#10;using System.Linq;&#13;&#10;using System.Text.RegularExpressions;&#13;&#10;using System.Threading;&#13;&#10;using System.Windows.Forms;&#13;&#10;using Triggernometry.Core;&#13;&#10;using Triggernometry.Core.Scripting;&#13;&#10;&#13;&#10;public static class LogAnonymizer&#13;&#10;{&#13;&#10;    private static Regex RegexId = new Regex(@&quot;(?&lt;=:)(?&lt;id&gt;10[0-9A-F]{6})(?=:|$)&quot;);&#13;&#10;    private static Regex RegexName = new Regex(@&quot;\G:(?&lt;name&gt;[A-Z][a-z'-]{1,14} [A-Z][a-z'-]{1,14}|[^a-z:\d][^A-Z:\d]{0,5})(?=:|$)&quot;);&#13;&#10;&#13;&#10;    public static void Anonymize()&#13;&#10;    {&#13;&#10;        string clipboardData = Clipboard.GetText();&#13;&#10;        var id2Name = new Dictionary&lt;string, string&gt;();&#13;&#10;&#13;&#10;        // 从当前复制的日志中提取所有 id，并尝试对应到后面的名字&#13;&#10;        foreach (Match match in RegexId.Matches(clipboardData))&#13;&#10;        {&#13;&#10;            if (!match.Success) continue; // 以防万一&#13;&#10;&#13;&#10;            string id = match.Groups[&quot;id&quot;].Value;&#13;&#10;            int searchStart = match.Index + match.Length;&#13;&#10;            // 正则 \G 用于确保仅从 searchStart 位置开始匹配紧随其后的名字&#13;&#10;            Match nameMatch = RegexName.Match(clipboardData, searchStart);&#13;&#10;&#13;&#10;            if (nameMatch.Success)&#13;&#10;            {&#13;&#10;                string name = nameMatch.Groups[&quot;name&quot;].Value;&#13;&#10;                if (!id2Name.TryGetValue(id, out string currentName) || currentName == &quot;&quot;)&#13;&#10;                {&#13;&#10;                    id2Name[id] = name;&#13;&#10;                }&#13;&#10;                else&#13;&#10;                {&#13;&#10;                    if (currentName != name)&#13;&#10;                    {&#13;&#10;                        MessageBox.Show($&quot;ID {id} name inconsistent: '{currentName}' vs '{name}'&quot;);&#13;&#10;                    }&#13;&#10;                }&#13;&#10;            }&#13;&#10;            else&#13;&#10;            {&#13;&#10;                if (!id2Name.ContainsKey(id))&#13;&#10;                {&#13;&#10;                    id2Name[id] = &quot;&quot;;&#13;&#10;                }&#13;&#10;            }&#13;&#10;        }&#13;&#10;&#13;&#10;        // 读取当前小队列表，如果记录的所有 id 均在小队列表中，则用小队列表的顺序替换&#13;&#10;        var party = ScriptHelper.GetListVariable(false, &quot;party&quot;)?.Values?.Select(v =&gt; v.ToString())?.ToList();&#13;&#10;        Dictionary&lt;string, int&gt; id2Idx;&#13;&#10;        if (party != null &amp;&amp; id2Name.Keys.All(id =&gt; party.Contains(id)))&#13;&#10;        {&#13;&#10;            id2Idx = id2Name.Keys.ToDictionary(id =&gt; id, id =&gt; party.IndexOf(id) + 1);&#13;&#10;        }&#13;&#10;        else&#13;&#10;        {&#13;&#10;            id2Idx = id2Name.Keys&#13;&#10;                .Select((id, idx) =&gt; (id, idx))&#13;&#10;                .ToDictionary(pair =&gt; pair.id, pair =&gt; pair.idx + 1);&#13;&#10;&#13;&#10;            // 试图修正自己的 idx&#13;&#10;            do&#13;&#10;            {&#13;&#10;                // 获取自己在当前小队列表的序号&#13;&#10;                var myId = Triggernometry.FFXIV.Entity.MyHexID;&#13;&#10;                var myIdx = party?.IndexOf(Triggernometry.FFXIV.Entity.MyHexID) ?? -1;&#13;&#10;                myIdx++;&#13;&#10;                RealPlugin.Instance.InvokeNamedCallback(&quot;command&quot;, $&quot;/e myIdx = {myIdx}&quot;);&#13;&#10;                if (myIdx &lt;= 0) break;&#13;&#10;&#13;&#10;                // 查找当前占用了自身 idx 的 id&#13;&#10;                var otherPair = id2Idx.FirstOrDefault(pair =&gt; pair.Value == myIdx);&#13;&#10;                if (!otherPair.Equals(default(KeyValuePair&lt;string, int&gt;))) // 有人占用了自身 idx&#13;&#10;                {&#13;&#10;                    if (id2Name.ContainsKey(myId)) // 日志包含自己：二人对换&#13;&#10;                    {&#13;&#10;                        id2Idx[otherPair.Key] = id2Idx[myId];&#13;&#10;                        id2Idx[myId] = myIdx;&#13;&#10;                    }&#13;&#10;                    else if (id2Idx.Count &lt;= party.Count) // 日志没包含自己，且日志不满小队人数&#13;&#10;                    {&#13;&#10;                        id2Idx[otherPair.Key] = id2Idx.Count + 1;&#13;&#10;                    }&#13;&#10;                }&#13;&#10;                else // 没有人占用了自身 idx&#13;&#10;                {&#13;&#10;                    if (id2Name.ContainsKey(myId)) // 日志包含自己&#13;&#10;                    {&#13;&#10;                        id2Idx[myId] = myIdx;&#13;&#10;                    }&#13;&#10;                }&#13;&#10;            } while (false);&#13;&#10;        }&#13;&#10;        // 替换小队 id 与名字&#13;&#10;        foreach (var pair in id2Idx)&#13;&#10;        {&#13;&#10;            string id = pair.Key;&#13;&#10;            int idx = pair.Value;&#13;&#10;            if (id2Name.TryGetValue(id, out string name) &amp;&amp; name != &quot;&quot;)&#13;&#10;            {&#13;&#10;                clipboardData = clipboardData.Replace($&quot;{id}:{name}&quot;, &quot;$&quot; + $&quot;{{l:party[{idx}]}}:队员&quot;);&#13;&#10;            }&#13;&#10;            clipboardData = clipboardData.Replace(id, &quot;$&quot; + $&quot;{{l:party[{idx}]}}&quot;);&#13;&#10;        }&#13;&#10;&#13;&#10;        // 输出&#13;&#10;        if (string.IsNullOrEmpty(clipboardData))&#13;&#10;            Clipboard.Clear();&#13;&#10;        else&#13;&#10;            Clipboard.SetText(clipboardData);&#13;&#10;    }&#13;&#10;&#13;&#10;    [STAThread]&#13;&#10;    public static void Main()&#13;&#10;    {&#13;&#10;        Thread thread = new Thread(() =&gt; {&#13;&#10;            try&#13;&#10;            {&#13;&#10;                Anonymize();&#13;&#10;            }&#13;&#10;            catch (Exception ex)&#13;&#10;            { &#13;&#10;                ScriptHelper.ErrorLog(ex.ToString());&#13;&#10;            }&#13;&#10;        });&#13;&#10;        thread.SetApartmentState(ApartmentState.STA);&#13;&#10;        thread.Start();&#13;&#10;        thread.Join();&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;RealPlugin.Instance.RegisterNamedCallback(nameof(LogAnonymizer), new System.Action&lt;object, string&gt;((_, __) =&gt; LogAnonymizer.Main()), &quot;MnFeN 阿洛&quot;);">
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${ecallback:LogAnonymizer}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Action>
              <Action OrderNumber="8" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="LogAnonymizer"/>
              <Action OrderNumber="9" ActionType="UseTTS" Asynchronous="False" UseTTSTextExpression="处理完成"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="26ae5a85-ed3d-4cdf-9648-2cbefc785abd" Name="查询表达式 /e 数学表达式 =?   /e 文本表达式 ==?" RegularExpression="^.{15}\S+ 00:0038::(?&lt;what&gt;.+?) *(?&lt;eq&gt;={1,2}) *[\?？] *$">
            <Actions>
              <Action OrderNumber="1" ActionType="NamedCallback" JsonEndpointExpression="http://127.0.0.1:2019/command" NamedCallbackName="command" NamedCallbackParam="/e == ${what}">
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${eq}" ExpressionTypeL="String" ExpressionR="==" ExpressionTypeR="String" ConditionType="StringEqualNocase"/>
                </Condition>
              </Action>
              <Action OrderNumber="2" ActionType="NamedCallback" JsonEndpointExpression="http://127.0.0.1:2019/command" NamedCallbackName="command" NamedCallbackParam="/e = ${n:${what}}">
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${eq}" ExpressionTypeL="String" ExpressionR="=" ExpressionTypeR="String" ConditionType="StringEqualNocase"/>
                </Condition>
              </Action>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="25557e02-d0e8-44ed-82f9-4336cd57242c" Name="内存检索/修改" RegularExpression="^.{15}\S+ 00:0038::(?&lt;type&gt;byte|u?short|u?int|u?long|float|double) (?&lt;offset&gt;[^=]+?)( *= *(?&lt;val&gt;.+))?$">
            <Actions>
              <Action OrderNumber="1" ActionType="Placeholder" Asynchronous="False" Description="查询或修改自己选中的实体（或没选中时：自己）的内存中某处的值" DescriptionOverride="True"/>
              <Action OrderNumber="2" ActionType="Placeholder" Asynchronous="False" Description="查询：/e float 0xc4 （查询自己实体后 0xC4 位置的 float 值）" DescriptionOverride="True"/>
              <Action OrderNumber="3" ActionType="Placeholder" Asynchronous="False" Description="写入：/e float 0xc4 = 2 （自己实体后 0xC4 位置的 float 值写为 2）" DescriptionOverride="True"/>
              <Action OrderNumber="4" ActionType="Placeholder" Asynchronous="False" Description="多级指针 如：/e float 0x100, 0x50 意为 Read&lt;IntPtr&gt;(entityAddress + 0x100) + 0x50" DescriptionOverride="True"/>
              <Action OrderNumber="5" ActionType="ExecuteScript" ExecScriptExpression="using System;&#13;&#10;using System.Linq;&#13;&#10;using Triggernometry.Core;&#13;&#10;using Triggernometry.Expressions.Maths;&#13;&#10;using Triggernometry.Utilities;&#13;&#10;&#13;&#10;static void Log(string msg) =&gt; RealPlugin.Instance.InvokeNamedCallback(&quot;command&quot;, &quot;/e \n&quot; + msg);&#13;&#10;&#13;&#10;string s = &quot;${_entity[${_me.targetid}].address}&quot;;&#13;&#10;var tgtaddress = s.Length &lt;= 1 ? ${_me.address} : 0${_entity[${_me.targetid}].address};&#13;&#10;var offsets = &quot;${offset}&quot;.Split(',').Select(str =&gt; (int)MathParser.Parse(str)).ToList();&#13;&#10;var address = (IntPtr)tgtaddress + offsets[0];&#13;&#10;&#13;&#10;for (int i = 1; i &lt; offsets.Count; i++)&#13;&#10;{&#13;&#10;    address = Memory.Read&lt;IntPtr&gt;(Memory.XivProcHandle, address) + offsets[i];&#13;&#10;}&#13;&#10;string tgtValueStr = &quot;${val}&quot;.Trim();&#13;&#10;var current = Memory.Read&lt;${type}&gt;(Memory.XivProcHandle, address);&#13;&#10;string msg = $&quot;{tgtaddress.ToString(&quot;X&quot;)} + {string.Join(&quot;, &quot;, offsets.Select(o =&gt; o.ToString(&quot;X&quot;)))} =&gt; {address.ToString(&quot;X&quot;)}:\n    Prev: (${type}){current}&quot;;&#13;&#10;&#13;&#10;if (&quot;${type}&quot; == &quot;byte&quot;)&#13;&#10;{&#13;&#10;    msg += $&quot; ({Convert.ToString((byte)current, 2).PadLeft(8, '0')})&quot;;&#13;&#10;}&#13;&#10;if (!string.IsNullOrEmpty(tgtValueStr))&#13;&#10;{&#13;&#10;    ${type} value = (${type})MathParser.Parse(tgtValueStr);&#13;&#10;    Memory.Write&lt;${type}&gt;(Memory.XivProcHandle, address, value);&#13;&#10;    msg += $&quot;\n    Set to: {value}&quot;;&#13;&#10;    if (&quot;${type}&quot; == &quot;byte&quot;)&#13;&#10;    {&#13;&#10;        msg += $&quot; ({Convert.ToString((byte)value, 2).PadLeft(8, '0')})&quot;;&#13;&#10;    }&#13;&#10;}&#13;&#10;Log(msg);"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="732d3092-f61c-44e6-ac5d-2e3dfa188812" Name="进制转换：10→16  /e 数学表达式 = 0x?" RegularExpression="^.{15}\S+ 00:0038::(?&lt;what&gt;.+?) *= *0x[?？] *$">
            <Actions>
              <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="command" NamedCallbackParam="/e $1 = 0x${f:dec2hex:$1}"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="4bb59e8b-a8d7-4374-994f-1cb0fc9e65eb" Name="模拟区域切换" RegularExpression="^.{15}\S+ 00:0038::(?i) *zone +(?&lt;zoneId&gt;.+)$" Sequential="True">
            <Actions>
              <Action OrderNumber="1" ActionType="Placeholder" Asynchronous="False" Description="e.g. /e zone 1238    /e zone 0x4D6" DescriptionOverride="True"/>
              <Action OrderNumber="2" ActionType="Placeholder" Asynchronous="False" Description="可以将触发器内部的当前区域 ID 设置为指定 ID，使限制区域 ID 的触发器临时可工作，用于调试触发器" DescriptionOverride="True"/>
              <Action OrderNumber="3" ActionType="Placeholder" Asynchronous="False" Description="目前只能换 id，同时建议不要用 name 限制以免适配多客户端带来不必要的麻烦" DescriptionOverride="True"/>
              <Action OrderNumber="4" ActionType="Placeholder" Asynchronous="False" Description="想重置时游戏内正常切换区域即可" DescriptionOverride="True"/>
              <Action OrderNumber="5" ActionType="ExecuteScript" ExecScriptExpression="Triggernometry.Core.RealPlugin.Instance.ZoneChangeDelegate(${n: ${zoneId}}, &quot;TestZone&quot;);"/>
              <Action OrderNumber="6" ActionType="NamedCallback" NamedCallbackName="command" NamedCallbackParam="/e Simulating Zone: ${_ffxivzoneid} (0x${f:dec2hex:${_ffxivzoneid}})"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="2bbe1d0f-61df-40dd-9c03-5a5f73b45268" Name="调用回调" RegularExpression="^.{15}\S+ 00:0038::(?i)cb +(?&lt;cbName&gt;[^ ]+)( +(?&lt;cbParam&gt;.*))?$">
            <Actions>
              <Action OrderNumber="1"/>
              <Action OrderNumber="2" ActionType="NamedCallback" JsonEndpointExpression="http://127.0.0.1:2019/command" NamedCallbackName="${cbName}" NamedCallbackParam="${cbParam}"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="f22d4a43-9d93-4b00-b3c8-3d7aec2a172c" Name="终止所有触发器、悬浮窗" RegularExpression="^.{15}\S+ 00:0038:: *break *$" Sequential="True">
            <Actions>
              <Action OrderNumber="1" ActionType="TextAura" TextAuraOp="DeactivateAllAura" TextAuraFontSize="9" TextAuraFontName="宋体" TriggerOp="CancelAllTrigger"/>
              <Action OrderNumber="2" ActionType="Aura" AuraOp="DeactivateAllAura" TextAuraOp="DeactivateAllAura" TriggerOp="CancelAllTrigger"/>
              <Action OrderNumber="3" ActionType="Trigger" TriggerOp="CancelAllTrigger"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="640c56c1-bfce-465c-bf63-df9efcaffe7a" Name="最大化 ACT Log 窗口" RegularExpression="^.{15}\S+ 00:0038::(?i)actlog">
            <Actions>
              <Action OrderNumber="1" ActionType="ExecuteScript" ExecScriptExpression="using System;&#13;&#10;using System.Diagnostics;&#13;&#10;using System.Runtime.InteropServices;&#13;&#10;using System.Text;&#13;&#10;&#13;&#10;const int SW_MAXIMIZE = 3;&#13;&#10;string targetTitleKeyword = &quot;Encounter Logs&quot;;&#13;&#10;&#13;&#10;[DllImport(&quot;user32.dll&quot;)]&#13;&#10;static extern bool IsWindowVisible(IntPtr hWnd);&#13;&#10;&#13;&#10;[DllImport(&quot;user32.dll&quot;, SetLastError = true)]&#13;&#10;static extern int GetWindowText(IntPtr hWnd, StringBuilder lpString, int nMaxCount);&#13;&#10;&#13;&#10;[DllImport(&quot;user32.dll&quot;)]&#13;&#10;static extern uint GetWindowThreadProcessId(IntPtr hWnd, out uint lpdwProcessId);&#13;&#10;&#13;&#10;[DllImport(&quot;user32.dll&quot;)]&#13;&#10;static extern bool EnumWindows(EnumWindowsProc lpEnumFunc, IntPtr lParam);&#13;&#10;&#13;&#10;[DllImport(&quot;user32.dll&quot;)]&#13;&#10;static extern bool ShowWindow(IntPtr hWnd, int nCmdShow);&#13;&#10;&#13;&#10;delegate bool EnumWindowsProc(IntPtr hWnd, IntPtr lParam);&#13;&#10;&#13;&#10;EnumWindows((hWnd, lParam) =&gt;&#13;&#10;{&#13;&#10;    if (!IsWindowVisible(hWnd))&#13;&#10;        return true;&#13;&#10;&#13;&#10;    GetWindowThreadProcessId(hWnd, out uint processId);&#13;&#10;    if (processId != (uint)Process.GetCurrentProcess().Id)&#13;&#10;        return true;&#13;&#10;&#13;&#10;    StringBuilder sb = new StringBuilder(256);&#13;&#10;    GetWindowText(hWnd, sb, sb.Capacity);&#13;&#10;    string title = sb.ToString();&#13;&#10;    if (!string.IsNullOrWhiteSpace(title) &amp;&amp; title.Contains(targetTitleKeyword))&#13;&#10;    {&#13;&#10;        ShowWindow(hWnd, SW_MAXIMIZE);&#13;&#10;    }&#13;&#10;    return true;&#13;&#10;}, IntPtr.Zero);&#13;&#10;"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="db8b8ee2-f9c1-44b4-be4f-5d058d202ab2" Name="FFLogs 日志拆分 v2.2   &quot;/e l o g&quot; 或测试输入 &quot;l o g&quot;" RegularExpression="(^.{15}\S+ 00:0038::(?i) *)?l +o +g *$">
            <Actions>
              <Action OrderNumber="1" ActionType="MessageBox" Asynchronous="False" MessageBoxIconType="Error" MessageBoxText="未开启读写文件权限，无法读写日志文件。&#13;&#10;· 触发器右上角 - 选项 - 编辑配置 - 安全；&#13;&#10;· 开启 System.IO 行后方的三个对勾">
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${_config[System.IO]} &amp; 0x5" ExpressionTypeL="Numeric" ExpressionR="0x5" ExpressionTypeR="Numeric" ConditionType="StringNotEqualCase"/>
                </Condition>
              </Action>
              <Action OrderNumber="2" ActionType="ExecuteScript" ExecScriptExpression="using System;&#13;&#10;using System.IO;&#13;&#10;using System.Collections.Generic;&#13;&#10;using System.Text.RegularExpressions;&#13;&#10;using System.Threading;&#13;&#10;using System.Windows.Forms;&#13;&#10;using System.Drawing;&#13;&#10;using System.Linq;&#13;&#10;&#13;&#10;public struct ProgramInfo&#13;&#10;{&#13;&#10;    public const string Name = &quot;FFLogs 日志拆分&quot;;&#13;&#10;    public const string Version = &quot;2.1&quot;;&#13;&#10;    public const string Author = &quot;阿洛&quot;;&#13;&#10;&#13;&#10;    public static readonly string Title = $&quot;{Name}  v{Version}  by {Author}&quot;;&#13;&#10;}&#13;&#10;&#13;&#10;/// &lt;summary&gt; 记录 &lt;/summary&gt;&#13;&#10;public class LogChunk&#13;&#10;{&#13;&#10;    /// &lt;summary&gt; 战斗地图区域名，用于 UI 界面显示。 &lt;/summary&gt;&#13;&#10;    public string ZoneName;&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 战斗所处区域的 01 日志行位置，即这段日志的上一个 01 行号。 &lt;/summary&gt;&#13;&#10;    public int Line01Idx;&#13;&#10;&#13;&#10;    /// &lt;summary&gt; &#13;&#10;    /// 战斗开始的行号。&lt;br /&gt;&#13;&#10;    /// 首场战斗为 01 行，&lt;br /&gt;&#13;&#10;    /// 其余战斗为团灭后 Director 40000011 的次行（这行代表清空了战斗的实体等资源）。 &#13;&#10;    /// &lt;/summary&gt;&#13;&#10;    public int StartLineIdx;&#13;&#10;&#13;&#10;    /// &lt;summary&gt; &#13;&#10;    /// 战斗结束的行号。&lt;br /&gt;&#13;&#10;    /// 团灭战斗为团灭后 Director 40000011 行（这行代表清空了战斗的实体等资源），&lt;br /&gt;&#13;&#10;    /// 胜利战斗为退本切换区域的 01 的前一行（不能使用 4000000[23]，因为此时实体尚未移除）。 &#13;&#10;    /// &lt;/summary&gt;&#13;&#10;    public int EndLineIdx;&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 战斗开始的时间（本地时区）。 &lt;/summary&gt;&#13;&#10;    public DateTime StartTime =&gt; StartTimeOverlay ?? StartTimeACT;&#13;&#10;    /// &lt;summary&gt; 战斗开始的时间（本地时区），以 Overlay 的战斗开始日志为准。 &lt;/summary&gt;&#13;&#10;    public DateTime? StartTimeOverlay;&#13;&#10;    /// &lt;summary&gt; 战斗开始的时间（本地时区），以首次对 Boss 使用技能开始计算，以防用户没有安装 OverlayPlugin。 &lt;/summary&gt;&#13;&#10;    public DateTime StartTimeACT;&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 战斗结束的时间（本地时区），以团灭/胜利时立刻产生的 Director 4000000[235] 计算。 &lt;/summary&gt;&#13;&#10;    public DateTime EndTime;&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 战斗是否胜利。 &lt;/summary&gt;&#13;&#10;    public bool Win;&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 是否为战斗记录（记录过战斗开始时间）。 &lt;/summary&gt;&#13;&#10;    public bool IsEncounter =&gt; StartTime != default;&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 是否为有效的战斗记录（战斗时长超过 20 秒）。 &lt;/summary&gt;&#13;&#10;    public bool IsLegalEncounter =&gt; IsEncounter &amp;&amp; Duration.TotalSeconds &gt;= 20;&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 对应 DataGridView 中的 checkbox cell，用于判断是否输出此战斗。 &lt;/summary&gt;&#13;&#10;    public DataGridViewCheckBoxCell CheckBox;&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 判断是否选中输出此战斗。 &lt;/summary&gt;&#13;&#10;    public bool IsSelected =&gt; CheckBox?.Value is bool b &amp;&amp; b;&#13;&#10;&#13;&#10;    public int SelfDeathCount { get; set; } = 0;&#13;&#10;    public int TotalDeathCount { get; set; } = 0;&#13;&#10;    public int SelfDmgDownCount { get; set; } = 0;&#13;&#10;    public int TotalDmgDownCount { get; set; } = 0;&#13;&#10;&#13;&#10;    public TimeSpan Duration =&gt; EndTime - StartTime;&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 获取战斗持续时间字符串，如 4'33.0'' &lt;/summary&gt;&#13;&#10;    public string DurationDesc&#13;&#10;    {&#13;&#10;        get &#13;&#10;        {&#13;&#10;            if (StartTime == DateTime.MinValue || EndTime == DateTime.MinValue)&#13;&#10;                return &quot;Error&quot;;&#13;&#10;            else&#13;&#10;            {&#13;&#10;                TimeSpan duration = Duration;&#13;&#10;                int totalMinutes = (int)duration.TotalMinutes;&#13;&#10;                double seconds = duration.TotalSeconds - totalMinutes * 60;&#13;&#10;                return $&quot;{totalMinutes:D} m {seconds:00.0} s&quot;;&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    public IEnumerable&lt;string&gt; ReadChunk(StreamReader reader)&#13;&#10;    {&#13;&#10;        for (int i = 0; i &lt;= EndLineIdx - StartLineIdx; i++)&#13;&#10;            yield return reader.ReadLine();&#13;&#10;    }&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;public class LogReader&#13;&#10;{&#13;&#10;    string LogPath;&#13;&#10;    bool _separateDoorBoss;&#13;&#10;    &#13;&#10;    public string ActVersionLine;&#13;&#10;    public Dictionary&lt;int, List&lt;LogChunk&gt;&gt; LogChunksDict = new Dictionary&lt;int, List&lt;LogChunk&gt;&gt;();&#13;&#10;    public IEnumerable&lt;LogChunk&gt; LogChunks =&gt; LogChunksDict.OrderBy(kvp =&gt; kvp.Key).SelectMany(kvp =&gt; kvp.Value);&#13;&#10;    public IEnumerable&lt;LogChunk&gt; LegalEncounters =&gt; LogChunks.Where(chunk =&gt; chunk.IsLegalEncounter);&#13;&#10;&#13;&#10;    static Regex reZone = new Regex(@&quot;^01\|.{34}[^|]*\|(?&lt;zoneName&gt;[^|]*)\|&quot;, RegexOptions.Compiled);&#13;&#10;    static Regex rePlayer = new Regex(@&quot;^02\|.{34}(?&lt;pID&gt;[^|]*)\|&quot;, RegexOptions.Compiled);&#13;&#10;    static Regex reDeath = new Regex(@&quot;^25\|.{34}(?&lt;pID&gt;.{8})\|&quot;, RegexOptions.Compiled);&#13;&#10;    // 由于伤害降低对应很多种 debuff，使用名称文本匹配&#13;&#10;    static Regex reDmgDown = new Regex(@&quot;^26\|.{34}[^|]*\|(伤害降低|Damage Down|ダメージ低下|Malus de dégâts|Schaden -)\|[^|]*\|[4E].{7}\|[^|]*\|(?&lt;pID&gt;1.{7})\|&quot;, RegexOptions.Compiled);&#13;&#10;    static Regex reDirector = new Regex(@&quot;^33\|.{34}.{8}\|(?&lt;type&gt;.{8})\|&quot;, RegexOptions.Compiled);&#13;&#10;    static Regex reAttackBoss = new Regex(@&quot;^2[12]\|.{34}1.{7}\|[^|]*\|[^|]*\|[^|]*\|4&quot;, RegexOptions.Compiled);&#13;&#10;    static Regex reStartCombat = new Regex(@&quot;^260\|.{34}.\|1\|.\|1&quot;, RegexOptions.Compiled);&#13;&#10;    static Regex reClearLB = new Regex(@&quot;^41\|.{34}.{8}\|B1C\|&quot;, RegexOptions.Compiled);&#13;&#10;&#13;&#10;    public LogReader(string path, bool separateDoorBoss)&#13;&#10;    {&#13;&#10;        LogPath = path;&#13;&#10;        _separateDoorBoss = separateDoorBoss;&#13;&#10;    }&#13;&#10;&#13;&#10;    public void SeparateLogChunks()&#13;&#10;    {&#13;&#10;        using (StreamReader reader = new StreamReader(LogPath))&#13;&#10;        {&#13;&#10;            int lineIdx = 0;&#13;&#10;            int line01Idx = 0;&#13;&#10;&#13;&#10;            // 跳过开头的空白行，找到首个非空的有效行，即 ACT 插件版本行。&#13;&#10;            // FFLogs 要求首行必须为此日志，否则上传的记录会标红报错版本不正确。&#13;&#10;            while ((ActVersionLine = reader.ReadLine()) != null)&#13;&#10;            {&#13;&#10;                lineIdx++;&#13;&#10;                if (!string.IsNullOrWhiteSpace(ActVersionLine)) break;&#13;&#10;            }&#13;&#10;            if (string.IsNullOrWhiteSpace(ActVersionLine))&#13;&#10;                MessageBox.Show(&quot;日志文件为空，请检查日志文件是否正确。&quot;, ProgramInfo.Name, MessageBoxButtons.OK, MessageBoxIcon.Warning);&#13;&#10;            if (!ActVersionLine.StartsWith(&quot;253|&quot;))&#13;&#10;                throw new Exception(&quot;日志首行不是 ACT 插件的版本记录，疑似日志不完整，无法拆分为有效的日志。&quot;);&#13;&#10;&#13;&#10;            // 将首个 01 之前的部分当做一个 chunk&#13;&#10;            LogChunk chunk = CreateLogChunk(&quot;Init&quot;, line01Idx, 0);&#13;&#10;&#13;&#10;            // 读取后续行并拆分为战斗记录&#13;&#10;            string line = null;&#13;&#10;            string prevLine = null;&#13;&#10;&#13;&#10;            bool bWin = false;&#13;&#10;            DateTime endTime = default;&#13;&#10;&#13;&#10;            string zoneName = null;&#13;&#10;            string selfId = null;&#13;&#10;&#13;&#10;            Match m;&#13;&#10;&#13;&#10;            while ((line = reader.ReadLine()) != null)&#13;&#10;            {&#13;&#10;                if (line.Length &lt; 3) &#13;&#10;                    throw new FormatException($&quot;日志行 #{lineIdx + 1} 过短：\n{line}&quot;);&#13;&#10;                string prefix = line.Substring(0, 3);&#13;&#10;&#13;&#10;                switch (prefix)&#13;&#10;                {&#13;&#10;                    case &quot;01|&quot;: // 切换区域&#13;&#10;                        zoneName = MatchedGroup(line, reZone, &quot;zoneName&quot;, lineIdx);&#13;&#10;                        line01Idx = lineIdx;&#13;&#10;                        SaveCurrentChunk(chunk, lineIdx - 1, ref bWin, ref endTime);&#13;&#10;                        chunk = CreateLogChunk(zoneName, line01Idx, lineIdx);&#13;&#10;                        break;&#13;&#10;&#13;&#10;                    case &quot;02|&quot;: // 获取当前玩家 ID&#13;&#10;                        var id = MatchedGroup(line, rePlayer, &quot;pID&quot;, lineIdx);&#13;&#10;                        if (id.StartsWith(&quot;10&quot;))&#13;&#10;                            selfId = id;&#13;&#10;                        break;&#13;&#10;&#13;&#10;                    case &quot;260&quot;: // Overlay 开始战斗&#13;&#10;                        if (chunk.StartTimeOverlay == default)&#13;&#10;                        {&#13;&#10;                            m = reStartCombat.Match(line);&#13;&#10;                            if (!m.Success) break;&#13;&#10;                            chunk.StartTimeOverlay = ParseTime(line);&#13;&#10;                        }&#13;&#10;                        break;&#13;&#10;                    case &quot;20|&quot;:&#13;&#10;                    case &quot;21|&quot;: // 首次对 Boss 使用技能（以防没有 Overlay）&#13;&#10;                        if (chunk.StartTimeACT == default)&#13;&#10;                        {&#13;&#10;                            m = reAttackBoss.Match(line);&#13;&#10;                            if (!m.Success) break;&#13;&#10;                            chunk.StartTimeACT = ParseTime(line);&#13;&#10;                        }&#13;&#10;                        break;&#13;&#10;&#13;&#10;                    case &quot;25|&quot;: // 死亡&#13;&#10;                        var deathId = MatchedGroup(line, reDeath, &quot;pID&quot;, lineIdx);&#13;&#10;                        if (!deathId.StartsWith(&quot;10&quot;)) break; // 不是玩家&#13;&#10;                        chunk.TotalDeathCount++;&#13;&#10;                        if (selfId == deathId) chunk.SelfDeathCount++;&#13;&#10;                        break;&#13;&#10;&#13;&#10;                    case &quot;26|&quot;: // 伤害降低&#13;&#10;                        m = reDmgDown.Match(line);&#13;&#10;                        if (!m.Success) break;&#13;&#10;                        var dmgDownId = m.Groups[&quot;pID&quot;].Value;&#13;&#10;                        chunk.TotalDmgDownCount++;&#13;&#10;                        if (selfId == dmgDownId) chunk.SelfDmgDownCount++;&#13;&#10;                        break;&#13;&#10;&#13;&#10;                    case &quot;33|&quot;: // Director&#13;&#10;                        string type = MatchedGroup(line, reDirector, &quot;type&quot;, lineIdx);&#13;&#10;                        switch (type)&#13;&#10;                        {&#13;&#10;                            case &quot;40000002&quot;: // 多变迷宫胜利&#13;&#10;                            case &quot;40000003&quot;: // 普通副本胜利&#13;&#10;                            case &quot;40000005&quot;: // 普通副本团灭  记录是否胜利、结束时间&#13;&#10;                                bWin = type != &quot;40000005&quot;;&#13;&#10;                                endTime = ParseTime(line);&#13;&#10;                                break;&#13;&#10;                            case &quot;40000011&quot;: // 团灭重置副本资源  保存并新建 chunk 【可以写一个兼容 6.2 以前的日志的选项（40000012）】&#13;&#10;                                SaveCurrentChunk(chunk, lineIdx, ref bWin, ref endTime);&#13;&#10;                                chunk = CreateLogChunk(zoneName, line01Idx, lineIdx + 1);&#13;&#10;                                break;&#13;&#10;                        }&#13;&#10;                        break;&#13;&#10;&#13;&#10;                    case &quot;41|&quot;: // 清 LB，检测门神转本体&#13;&#10;                        if (_separateDoorBoss)&#13;&#10;                        {&#13;&#10;                            m = reClearLB.Match(line);&#13;&#10;                            if (!m.Success) break;&#13;&#10;                            endTime = ParseTime(line);&#13;&#10;                            bWin = true;&#13;&#10;                            chunk.ZoneName += &quot; (P1)&quot;;&#13;&#10;                            SaveCurrentChunk(chunk, lineIdx, ref bWin, ref endTime);&#13;&#10;                            chunk = CreateLogChunk(zoneName, line01Idx, lineIdx + 1);&#13;&#10;                        }&#13;&#10;                        break;&#13;&#10;                }&#13;&#10;                lineIdx++;&#13;&#10;                prevLine = line;&#13;&#10;            }&#13;&#10;            // 如果没有在最后一行新建一个 chunk（如最后一行恰好是 40000011），则结束最后的 chunk&#13;&#10;            if (chunk.StartLineIdx &lt; lineIdx)&#13;&#10;            {&#13;&#10;                // 异常结束日志，如日志在战斗结束前截止，将终止时间视为结束时间&#13;&#10;                if (endTime == default)&#13;&#10;                    endTime = ParseTime(prevLine);&#13;&#10;                SaveCurrentChunk(chunk, lineIdx - 1, ref bWin, ref endTime);&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    public DateTime ParseTime(string line)&#13;&#10;    {&#13;&#10;        int sepPos = line.IndexOf('|');&#13;&#10;        return DateTime.Parse(line.Substring(sepPos + 1, 23)); // &quot;2025-07-24T21:00:35.905&quot;&#13;&#10;    }&#13;&#10;&#13;&#10;    string MatchedGroup(string line, Regex regex, string groupName, int lineIdx)&#13;&#10;    {&#13;&#10;        if (line == null) throw new ArgumentNullException(nameof(line));&#13;&#10;        var m = regex.Match(line);&#13;&#10;        if (!m.Success)&#13;&#10;            throw new FormatException($&quot;日志行 #{lineIdx + 1} 格式错误：\n{line}&quot;);&#13;&#10;        var group = m.Groups[groupName];&#13;&#10;        if (!group.Success)&#13;&#10;            throw new KeyNotFoundException($&quot;日志行 #{lineIdx + 1} 不包含分组 [{groupName}]：\n{line}&quot;);&#13;&#10;        return group.Value;&#13;&#10;    }&#13;&#10;&#13;&#10;    LogChunk CreateLogChunk(string zoneName, int line01Idx, int startLineIndex) =&gt; new LogChunk&#13;&#10;    {&#13;&#10;        ZoneName = zoneName,&#13;&#10;        Line01Idx = line01Idx,&#13;&#10;        StartLineIdx = startLineIndex,&#13;&#10;    };&#13;&#10;&#13;&#10;    void SaveCurrentChunk(LogChunk chunk, int endLineIndex, ref bool bWin, ref DateTime endTime)&#13;&#10;    {&#13;&#10;        chunk.Win = bWin;&#13;&#10;        chunk.EndLineIdx = endLineIndex;&#13;&#10;        chunk.EndTime = endTime;&#13;&#10;        if (!LogChunksDict.ContainsKey(chunk.Line01Idx))&#13;&#10;            LogChunksDict[chunk.Line01Idx] = new List&lt;LogChunk&gt;();&#13;&#10;        LogChunksDict[chunk.Line01Idx].Add(chunk);&#13;&#10;        bWin = false;&#13;&#10;        endTime = default;&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;public class LogSeparatorForm : Form&#13;&#10;{&#13;&#10;    private List&lt;LogChunk&gt; _encounters = new List&lt;LogChunk&gt;();&#13;&#10;    public List&lt;LogChunk&gt; Encounters =&gt; _encounters;&#13;&#10;    public LogReader LogReader;&#13;&#10;&#13;&#10;    void UpdateEncounters(IEnumerable&lt;LogChunk&gt; encounters)&#13;&#10;    {&#13;&#10;        _encounters = encounters.ToList();&#13;&#10;        if (!encounters.Any())&#13;&#10;        {&#13;&#10;            MessageBox.Show(&quot;日志中不包含任何 20 秒以上的战斗。&quot;, ProgramInfo.Name, MessageBoxButtons.OK, MessageBoxIcon.Warning);&#13;&#10;        }&#13;&#10;        // Fill Dgv&#13;&#10;        dgvEncounters.SuspendLayout();&#13;&#10;        try&#13;&#10;        {&#13;&#10;            dgvEncounters.Rows.Clear();&#13;&#10;&#13;&#10;            int height;&#13;&#10;            using (Graphics graphics = CreateGraphics())&#13;&#10;            {&#13;&#10;                height = (int)(graphics.MeasureString(&quot;啊&quot;, Font).Height * 1.05);&#13;&#10;            }&#13;&#10;&#13;&#10;            foreach (LogChunk encounter in Encounters)&#13;&#10;            {&#13;&#10;                int rowIndex = dgvEncounters.Rows.Add();&#13;&#10;                dgvEncounters.Rows[rowIndex].Height = height;&#13;&#10;                // 选项框&#13;&#10;                dgvEncounters.Rows[rowIndex].Cells[0].Value = false;&#13;&#10;                encounter.CheckBox = (DataGridViewCheckBoxCell)dgvEncounters.Rows[rowIndex].Cells[0];&#13;&#10;                // 序号&#13;&#10;                dgvEncounters.Rows[rowIndex].Cells[1].Value = rowIndex + 1;&#13;&#10;                // 时间&#13;&#10;                dgvEncounters.Rows[rowIndex].Cells[2].Value = encounter.StartTime.ToString(&quot;MM/dd HH:mm:ss&quot;);&#13;&#10;                dgvEncounters.Rows[rowIndex].Cells[3].Value = encounter.EndTime.ToString(&quot;HH:mm:ss&quot;);&#13;&#10;                dgvEncounters.Rows[rowIndex].Cells[4].Value = encounter.DurationDesc;&#13;&#10;                // 胜利或团灭颜色&#13;&#10;                Color color = encounter.Win&#13;&#10;                    ? Color.FromArgb(68, 204, 170)  // 浅绿&#13;&#10;                    : Color.FromArgb(221, 102, 85); // 浅红&#13;&#10;                for (int i = 1; i &lt;= 4; i++)&#13;&#10;                    dgvEncounters.Rows[rowIndex].Cells[i].Style.ForeColor = color;&#13;&#10;                // 区域&#13;&#10;                dgvEncounters.Rows[rowIndex].Cells[5].Value = encounter.ZoneName;&#13;&#10;                // 死亡/伤害降低计数&#13;&#10;                dgvEncounters.Rows[rowIndex].Cells[6].Value = $&quot;{encounter.SelfDeathCount}/{encounter.TotalDeathCount}&quot;;&#13;&#10;                dgvEncounters.Rows[rowIndex].Cells[7].Value = $&quot;{encounter.SelfDmgDownCount}/{encounter.TotalDmgDownCount}&quot;;&#13;&#10;                // 行号范围&#13;&#10;                dgvEncounters.Rows[rowIndex].Cells[8].Value = $&quot;{encounter.StartLineIdx + 1}-{encounter.EndLineIdx + 1}&quot;;&#13;&#10;            }&#13;&#10;            // 设置列宽&#13;&#10;            SetDgvColWidth(true);&#13;&#10;        }&#13;&#10;        finally { dgvEncounters.ResumeLayout(); }&#13;&#10;    }&#13;&#10;&#13;&#10;    private string _originalLogName;&#13;&#10;&#13;&#10;    private OpenFileDialog openFileDialog;&#13;&#10;    private SaveFileDialog saveFileDialog;&#13;&#10;&#13;&#10;    TableLayoutPanel table, tableBottom;&#13;&#10;    DataGridView dgvEncounters;&#13;&#10;    Button btnOpen, btnSave;&#13;&#10;    CheckBox chkSeparateDoorBoss, chkHideHeadMarkers, chkHideChatLog, chkHideOverlay;&#13;&#10;&#13;&#10;    List&lt;int&gt; dgvColumnBaseWidths;&#13;&#10;&#13;&#10;    public LogSeparatorForm()&#13;&#10;    {&#13;&#10;        Text = ProgramInfo.Title;&#13;&#10;        Font = new Font(SelectFont(&quot;微软雅黑&quot;, &quot;Microsoft YaHei&quot;, &quot;微軟正黑體&quot;, &quot;Microsoft JhengHei&quot;, &quot;Arial&quot;), 12);&#13;&#10;        AutoSize = false;&#13;&#10;        StartPosition = FormStartPosition.CenterScreen;&#13;&#10;        Width = Screen.PrimaryScreen.Bounds.Width * 3 / 5;&#13;&#10;        Height = Screen.PrimaryScreen.Bounds.Height * 3 / 4;&#13;&#10;        Resize += Form_Resize;&#13;&#10;&#13;&#10;        openFileDialog = new OpenFileDialog();&#13;&#10;        saveFileDialog = new SaveFileDialog();&#13;&#10;&#13;&#10;        SuspendLayout();&#13;&#10;&#13;&#10;        ToolTip tooltip = new ToolTip&#13;&#10;        {&#13;&#10;            AutoPopDelay = int.MaxValue,&#13;&#10;            InitialDelay = 500,&#13;&#10;            ReshowDelay = 100,&#13;&#10;            ShowAlways = true,&#13;&#10;        };&#13;&#10;&#13;&#10;        table = new TableLayoutPanel&#13;&#10;        {&#13;&#10;            RowCount = 3,&#13;&#10;            ColumnCount = 2,&#13;&#10;            AutoSize = true,&#13;&#10;            AutoSizeMode = AutoSizeMode.GrowAndShrink,&#13;&#10;            Dock = DockStyle.Fill&#13;&#10;        };&#13;&#10;&#13;&#10;        for (int i = 0; i &lt; 2; i++)&#13;&#10;            table.ColumnStyles.Add(new ColumnStyle(SizeType.Percent, 100f / 2));&#13;&#10;        table.RowStyles.Add(new RowStyle(SizeType.AutoSize));&#13;&#10;        table.RowStyles.Add(new RowStyle(SizeType.Percent, 100f));&#13;&#10;        table.RowStyles.Add(new RowStyle(SizeType.AutoSize));&#13;&#10;        Controls.Add(table);&#13;&#10;&#13;&#10;        btnOpen = new Button&#13;&#10;        {&#13;&#10;            Text = &quot;打开日志&quot;,&#13;&#10;            AutoSize = true,&#13;&#10;            Margin = new Padding(20),&#13;&#10;            Padding = new Padding(5),&#13;&#10;            Anchor = AnchorStyles.None&#13;&#10;        };&#13;&#10;        btnOpen.Click += btnOpen_Click;&#13;&#10;&#13;&#10;        btnSave = new Button&#13;&#10;        {&#13;&#10;            Text = &quot;保存日志&quot;,&#13;&#10;            AutoSize = true,&#13;&#10;            Margin = new Padding(20),&#13;&#10;            Padding = new Padding(5),&#13;&#10;            Anchor = AnchorStyles.None&#13;&#10;        };&#13;&#10;        btnSave.Click += btnSave_Click;&#13;&#10;&#13;&#10;        table.Controls.Add(btnOpen, 0, 0);&#13;&#10;        table.Controls.Add(btnSave, 1, 0);&#13;&#10;&#13;&#10;        dgvEncounters = new DataGridView&#13;&#10;        {&#13;&#10;            Dock = DockStyle.Fill,&#13;&#10;            Margin = new Padding(20, 0, 20, 0),&#13;&#10;            RowHeadersVisible = false,&#13;&#10;            SelectionMode = DataGridViewSelectionMode.FullRowSelect,&#13;&#10;            AllowUserToResizeRows = false,&#13;&#10;            AllowUserToResizeColumns = false,&#13;&#10;            AllowUserToAddRows = false,&#13;&#10;            AllowUserToDeleteRows = false,&#13;&#10;            AllowUserToOrderColumns = false,&#13;&#10;            ScrollBars = ScrollBars.Vertical,&#13;&#10;            ColumnHeadersHeightSizeMode = DataGridViewColumnHeadersHeightSizeMode.DisableResizing,&#13;&#10;            // “透明”表单&#13;&#10;            BackgroundColor = this.BackColor,&#13;&#10;            GridColor = this.BackColor,&#13;&#10;            CellBorderStyle = DataGridViewCellBorderStyle.None,&#13;&#10;        };&#13;&#10;        dgvEncounters.DefaultCellStyle.BackColor = this.BackColor;&#13;&#10;        dgvEncounters.ColumnHeadersDefaultCellStyle.BackColor = this.BackColor;&#13;&#10;&#13;&#10;        dgvEncounters.SelectionChanged += (obj, e) =&gt; dgvEncounters.ClearSelection();&#13;&#10;&#13;&#10;        // 选中行时着色&#13;&#10;        Color SelectedColor = MixColor(BackColor, Color.DodgerBlue, 0.1);&#13;&#10;        dgvEncounters.CellFormatting += (s, e) =&gt;&#13;&#10;        {&#13;&#10;            if (e.RowIndex &gt;= 0 &amp;&amp; dgvEncounters.Rows[e.RowIndex].Cells[0] is DataGridViewCheckBoxCell cell)&#13;&#10;            {&#13;&#10;                bool isSelected = cell.Value is bool b &amp;&amp; b;&#13;&#10;                DataGridViewRow row = dgvEncounters.Rows[e.RowIndex];&#13;&#10;                row.DefaultCellStyle.BackColor = isSelected ? SelectedColor : this.BackColor;&#13;&#10;            }&#13;&#10;        };&#13;&#10;        // 立刻提交 checkbox 的修改，使该行颜色立刻刷新&#13;&#10;        dgvEncounters.CurrentCellDirtyStateChanged += (s, e) =&gt; &#13;&#10;        {&#13;&#10;            if (dgvEncounters.CurrentCell is DataGridViewCheckBoxCell)&#13;&#10;            {&#13;&#10;                dgvEncounters.CommitEdit(DataGridViewDataErrorContexts.Commit);&#13;&#10;                dgvEncounters.InvalidateRow(dgvEncounters.CurrentCell.RowIndex);&#13;&#10;            }&#13;&#10;        };&#13;&#10;        &#13;&#10;        dgvEncounters.CellMouseClick += (s, e) =&gt;&#13;&#10;        {&#13;&#10;            // 表头的“全选”&#13;&#10;            if (e.RowIndex == -1 &amp;&amp; e.ColumnIndex == 0)&#13;&#10;            {&#13;&#10;                bool allSelected = dgvEncounters.Rows.Cast&lt;DataGridViewRow&gt;()&#13;&#10;                    .All(row =&gt; row.Cells[0] is DataGridViewCheckBoxCell cell &amp;&amp; cell.Value is bool b &amp;&amp; b);&#13;&#10;&#13;&#10;                foreach (DataGridViewRow row in dgvEncounters.Rows)&#13;&#10;                {&#13;&#10;                    if (row.Cells[0] is DataGridViewCheckBoxCell cell)&#13;&#10;                    {&#13;&#10;                        cell.Value = !allSelected; // 已经全选时全清，否则全选&#13;&#10;                    }&#13;&#10;                }&#13;&#10;                dgvEncounters.RefreshEdit();&#13;&#10;            }&#13;&#10;            // 第一列选项框的有效区域扩大到整格&#13;&#10;            if (e.RowIndex &gt;= 0 &amp;&amp; (e.ColumnIndex == 0 || e.ColumnIndex == 1))&#13;&#10;            {&#13;&#10;                var cell = dgvEncounters.Rows[e.RowIndex].Cells[0] as DataGridViewCheckBoxCell;&#13;&#10;                bool current = cell?.Value is bool b &amp;&amp; b;&#13;&#10;                cell.Value = !current;&#13;&#10;                dgvEncounters.CommitEdit(DataGridViewDataErrorContexts.Commit);&#13;&#10;                dgvEncounters.RefreshEdit();&#13;&#10;            }&#13;&#10;        };&#13;&#10;&#13;&#10;        using (Graphics graphics = CreateGraphics())&#13;&#10;        {&#13;&#10;            dgvEncounters.ColumnHeadersHeight = (int)(graphics.MeasureString(&quot;啊&quot;, Font).Height * 1.2);&#13;&#10;        }&#13;&#10;&#13;&#10;        dgvEncounters.Columns.Add(new DataGridViewCheckBoxColumn { HeaderText = &quot;全选&quot; });&#13;&#10;        dgvEncounters.Columns.Add(new DataGridViewTextBoxColumn { HeaderText = &quot;#&quot; });&#13;&#10;        dgvEncounters.Columns.Add(new DataGridViewTextBoxColumn { HeaderText = &quot;开始&quot; });&#13;&#10;        dgvEncounters.Columns.Add(new DataGridViewTextBoxColumn { HeaderText = &quot;结束&quot; });&#13;&#10;        dgvEncounters.Columns.Add(new DataGridViewTextBoxColumn { HeaderText = &quot;时长&quot; });&#13;&#10;        dgvEncounters.Columns.Add(new DataGridViewTextBoxColumn { HeaderText = &quot;副本名&quot; });&#13;&#10;        dgvEncounters.Columns.Add(new DataGridViewTextBoxColumn { HeaderText = &quot;死亡&quot; });&#13;&#10;        dgvEncounters.Columns.Add(new DataGridViewTextBoxColumn { HeaderText = &quot;伤降&quot; });&#13;&#10;        dgvEncounters.Columns.Add(new DataGridViewTextBoxColumn { HeaderText = &quot;行号&quot; });&#13;&#10;&#13;&#10;        for (int i = 0; i &lt; dgvEncounters.Columns.Count; i++)&#13;&#10;        {&#13;&#10;            dgvEncounters.Columns[i].ReadOnly = (i != 0);&#13;&#10;            dgvEncounters.Columns[i].DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;&#13;&#10;            dgvEncounters.Columns[i].HeaderCell.Style.Alignment = DataGridViewContentAlignment.MiddleCenter;&#13;&#10;        }&#13;&#10;&#13;&#10;        table.Controls.Add(dgvEncounters, 0, 1);&#13;&#10;        table.SetColumnSpan(dgvEncounters, 2);&#13;&#10;&#13;&#10;        chkSeparateDoorBoss = new CheckBox&#13;&#10;        {&#13;&#10;            Text = &quot;以 LB 清空日志拆分门神&quot;,&#13;&#10;            Checked = false,&#13;&#10;            AutoSize = true,&#13;&#10;            Anchor = AnchorStyles.None,&#13;&#10;            Margin = new Padding(20),&#13;&#10;            Cursor = Cursors.Help,&#13;&#10;        };&#13;&#10;        chkHideHeadMarkers = new CheckBox&#13;&#10;        {&#13;&#10;            Text = &quot;隐藏实体标点&quot;,&#13;&#10;            Checked = true,&#13;&#10;            AutoSize = true,&#13;&#10;            Anchor = AnchorStyles.None,&#13;&#10;            Margin = new Padding(20),&#13;&#10;            Cursor = Cursors.Help,&#13;&#10;        };&#13;&#10;        chkHideChatLog = new CheckBox&#13;&#10;        {&#13;&#10;            Text = &quot;隐藏聊天记录&quot;,&#13;&#10;            Checked = true,&#13;&#10;            AutoSize = true,&#13;&#10;            Anchor = AnchorStyles.None,&#13;&#10;            Margin = new Padding(20),&#13;&#10;            Cursor = Cursors.Help,&#13;&#10;        };&#13;&#10;        chkHideOverlay = new CheckBox&#13;&#10;        {&#13;&#10;            Text = &quot;隐藏 Overlay 日志&quot;,&#13;&#10;            Checked = false,&#13;&#10;            AutoSize = true,&#13;&#10;            Anchor = AnchorStyles.None,&#13;&#10;            Margin = new Padding(20),&#13;&#10;            Cursor = Cursors.Help,&#13;&#10;        };&#13;&#10;        tooltip.SetToolTip(chkSeparateDoorBoss, &quot;测试功能：\n如果想在有存档点但中途没跳的战斗中拆分两阶段，可尝试开启此选项。\n否则请保持关闭。&quot;);&#13;&#10;        tooltip.SetToolTip(chkHideHeadMarkers, &quot;隐藏实体标点的相关日志，如攻击、锁链、禁止等。&quot;);&#13;&#10;        tooltip.SetToolTip(chkHideChatLog, &quot;隐藏聊天栏中的大多数系统日志（含聊天记录）。\nFFLogs 不需要这些日志，隐藏后可减小文件体积。&quot;);&#13;&#10;        tooltip.SetToolTip(chkHideOverlay, &quot;隐藏 OverlayPlugin 产生的大多数日志（除战斗状态、战斗倒计时）。\nFFLogs 不需要这些日志，隐藏后可减小文件体积。\n但这里包含很多有用的信息，如果你要分享日志，请勿开启此选项。&quot;);&#13;&#10;&#13;&#10;        chkSeparateDoorBoss.CheckedChanged += chkSeparateDoorBoss_CheckedChanged;&#13;&#10;        var chkCount = 4;&#13;&#10;        tableBottom = new TableLayoutPanel&#13;&#10;        {&#13;&#10;            RowCount = 1,&#13;&#10;            ColumnCount = chkCount,&#13;&#10;            AutoSize = true,&#13;&#10;            AutoSizeMode = AutoSizeMode.GrowAndShrink,&#13;&#10;            Dock = DockStyle.Fill&#13;&#10;        };&#13;&#10;        for (int i = 0; i &lt; chkCount; i++)&#13;&#10;            tableBottom.ColumnStyles.Add(new ColumnStyle(SizeType.Percent, 100f / chkCount));&#13;&#10;        tableBottom.Controls.Add(chkSeparateDoorBoss, 0, 0);&#13;&#10;        tableBottom.Controls.Add(chkHideHeadMarkers, 1, 0);&#13;&#10;        tableBottom.Controls.Add(chkHideChatLog, 2, 0);&#13;&#10;        tableBottom.Controls.Add(chkHideOverlay, 3, 0);&#13;&#10;        table.Controls.Add(tableBottom, 0, 2);&#13;&#10;        table.SetColumnSpan(tableBottom, 2);&#13;&#10;&#13;&#10;        ResumeLayout();&#13;&#10;        SetDgvColWidth(true);&#13;&#10;    }&#13;&#10;&#13;&#10;    string SelectFont(params string[] fontNames)&#13;&#10;    {&#13;&#10;        foreach (string name in fontNames)&#13;&#10;        {&#13;&#10;            try&#13;&#10;            {&#13;&#10;                using (var testFont = new Font(name, 12)) // 避免 GDI fallback 字体&#13;&#10;                {&#13;&#10;                    if (testFont.Name == name) return name;&#13;&#10;                }&#13;&#10;            }&#13;&#10;            catch { }&#13;&#10;        }&#13;&#10;        return SystemFonts.DefaultFont.Name;&#13;&#10;    }&#13;&#10;&#13;&#10;    Color MixColor(Color baseColor, Color targetColor, double weight)&#13;&#10;    {&#13;&#10;        int r = (int)(baseColor.R * (1 - weight) + targetColor.R * weight);&#13;&#10;        int g = (int)(baseColor.G * (1 - weight) + targetColor.G * weight);&#13;&#10;        int b = (int)(baseColor.B * (1 - weight) + targetColor.B * weight);&#13;&#10;        return Color.FromArgb(r, g, b);&#13;&#10;    }&#13;&#10;&#13;&#10;    private string _defaultPath;&#13;&#10;    public string DefaultPath&#13;&#10;    {&#13;&#10;        get&#13;&#10;        {&#13;&#10;            if (_defaultPath == null)&#13;&#10;            {&#13;&#10;                _defaultPath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, &quot;FFXIVLogs&quot;);&#13;&#10;            }&#13;&#10;            return _defaultPath;&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    void btnOpen_Click(object sender, EventArgs e)&#13;&#10;    {&#13;&#10;        openFileDialog.Filter = &quot;Log File (*.log)|*.log&quot;;&#13;&#10;&#13;&#10;        if (Directory.Exists(DefaultPath))&#13;&#10;        {&#13;&#10;            openFileDialog.InitialDirectory = DefaultPath;&#13;&#10;        }&#13;&#10;        if (openFileDialog.ShowDialog() == DialogResult.OK)&#13;&#10;        {&#13;&#10;            try&#13;&#10;            {&#13;&#10;                _originalLogName = openFileDialog.FileName;&#13;&#10;                LogReader = new LogReader(_originalLogName, chkSeparateDoorBoss.Checked);&#13;&#10;                LogReader.SeparateLogChunks();&#13;&#10;                UpdateEncounters(LogReader.LegalEncounters);&#13;&#10;            }&#13;&#10;            catch (Exception ex)&#13;&#10;            {&#13;&#10;                MessageBox.Show(ex.ToString(), &quot;错误&quot;, MessageBoxButtons.OK, MessageBoxIcon.Error);&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    void chkSeparateDoorBoss_CheckedChanged(object sender, EventArgs e)&#13;&#10;    {&#13;&#10;        if (Encounters.Count &gt; 0)&#13;&#10;        {&#13;&#10;            try&#13;&#10;            {&#13;&#10;                LogReader = new LogReader(_originalLogName, chkSeparateDoorBoss.Checked);&#13;&#10;                LogReader.SeparateLogChunks();&#13;&#10;                UpdateEncounters(LogReader.LegalEncounters);&#13;&#10;            }&#13;&#10;            catch (Exception ex)&#13;&#10;            {&#13;&#10;                MessageBox.Show(ex.ToString(), &quot;错误&quot;, MessageBoxButtons.OK, MessageBoxIcon.Error);&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    void btnSave_Click(object sender, EventArgs e)&#13;&#10;    {&#13;&#10;        try&#13;&#10;        {&#13;&#10;            if ((Encounters?.Count ?? 0) == 0) return;&#13;&#10;&#13;&#10;            List&lt;LogChunk&gt; filteredEncounters = new List&lt;LogChunk&gt;();&#13;&#10;&#13;&#10;            for (int i = 0; i &lt; Encounters.Count; i++)&#13;&#10;            {&#13;&#10;                var checkBoxCell = dgvEncounters.Rows[i].Cells[0] as DataGridViewCheckBoxCell;&#13;&#10;                if (checkBoxCell != null &amp;&amp; Convert.ToBoolean(checkBoxCell.Value) == true)&#13;&#10;                    filteredEncounters.Add(Encounters[i]);&#13;&#10;            }&#13;&#10;&#13;&#10;            if (filteredEncounters.Count == 0)&#13;&#10;            {&#13;&#10;                MessageBox.Show(&quot;未选中任何战斗。&quot;, &quot;&quot;, MessageBoxButtons.OK, MessageBoxIcon.Warning);&#13;&#10;                return;&#13;&#10;            }&#13;&#10;&#13;&#10;            saveFileDialog.Filter = &quot;日志文件 (*.log)|*.log&quot;;&#13;&#10;&#13;&#10;            if (Directory.Exists(DefaultPath))&#13;&#10;            {&#13;&#10;                saveFileDialog.InitialDirectory = DefaultPath;&#13;&#10;            }&#13;&#10;&#13;&#10;            if (saveFileDialog.ShowDialog() == DialogResult.OK)&#13;&#10;            {&#13;&#10;                string newLogName = saveFileDialog.FileName;&#13;&#10;&#13;&#10;                SaveLogFile(newLogName);&#13;&#10;            }&#13;&#10;        }&#13;&#10;        catch (Exception ex)&#13;&#10;        {&#13;&#10;            MessageBox.Show(ex.ToString(), &quot;错误&quot;, MessageBoxButtons.OK, MessageBoxIcon.Error);&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    static Regex reZoneInitEssentialLines = new Regex(@&quot;^01\||^40\||^02\||^03\|.{34}10&quot;, RegexOptions.Compiled);&#13;&#10;    const string EmptyLinePlaceholder = &quot;00|0|&quot;;&#13;&#10;    void SaveLogFile(string newLogName)&#13;&#10;    {&#13;&#10;        try&#13;&#10;        {&#13;&#10;            // 确保所有段从头开始覆盖日志文件&#13;&#10;            ValidateChunkContinuity();&#13;&#10;            using (StreamReader streamReader = new StreamReader(_originalLogName))&#13;&#10;            using (StreamWriter streamWriter = new StreamWriter(newLogName))&#13;&#10;            {&#13;&#10;                // 写入 ACT 插件版本行&#13;&#10;                streamWriter.WriteLine(LogReader.ActVersionLine);&#13;&#10;&#13;&#10;                var line01Indices = LogReader.LogChunksDict.Keys.OrderBy(idx =&gt; idx);&#13;&#10;                foreach (int line01Idx in line01Indices)&#13;&#10;                {&#13;&#10;                    var chunks = new List&lt;LogChunk&gt;(LogReader.LogChunksDict[line01Idx]);&#13;&#10;                    &#13;&#10;                    var lastSelectedIdx = chunks.FindLastIndex(c =&gt; c.IsSelected);&#13;&#10;                    for (int i = 0; i &lt; chunks.Count; i++)&#13;&#10;                    {&#13;&#10;                        // 根据这场战斗是否需要导出等条件，确认每一个 chunk 的行如何导出&#13;&#10;                        Action&lt;string, StreamWriter&gt; writeAction;&#13;&#10;                        var chunk = chunks[i];&#13;&#10;&#13;&#10;                        // 最后一个选中的战斗之后的所有日志均可忽略（未找到时为 -1，即全部可忽略）&#13;&#10;                        if (i &gt; lastSelectedIdx)&#13;&#10;                            writeAction = (line, writer) =&gt; { };&#13;&#10;                        // 首场战斗不需要时，仅保留首场的 01 40 02 03:10XXXXXX 行&#13;&#10;                        else if (i == 0 &amp;&amp; !chunk.IsSelected)&#13;&#10;                            writeAction = (line, writer) =&gt;&#13;&#10;                            {&#13;&#10;                                if (reZoneInitEssentialLines.IsMatch(line))&#13;&#10;                                    writer.WriteLine(line);&#13;&#10;                                else&#13;&#10;                                    writer.WriteLine(EmptyLinePlaceholder);&#13;&#10;                            };&#13;&#10;                        // 其他场次战斗或非战斗段落不需要时，全部占位行&#13;&#10;                        else if (!chunk.IsSelected)&#13;&#10;                            writeAction = (line, writer) =&gt; writer.WriteLine(EmptyLinePlaceholder);&#13;&#10;                        // 其他情况（选中的战斗）&#13;&#10;                        else&#13;&#10;                            writeAction = (line, writer) =&gt;&#13;&#10;                            {&#13;&#10;                                bool keep = true;&#13;&#10;                                bool hideChatLog = chkHideChatLog.Checked;&#13;&#10;                                bool hideHeadMarkers = chkHideHeadMarkers.Checked;&#13;&#10;                                bool hideOverlay = chkHideOverlay.Checked;&#13;&#10;                                switch (line.Substring(0, 3))&#13;&#10;                                {&#13;&#10;                                    case &quot;00|&quot;: // ChatLog&#13;&#10;                                        if (hideChatLog)&#13;&#10;                                        {&#13;&#10;                                            var type = line.Substring(37, 4);&#13;&#10;                                            if (type != &quot;0044&quot; &amp;&amp; type != &quot;0039&quot;) // Boss 台词 / 某些重要系统消息&#13;&#10;                                                keep = false;&#13;&#10;                                        }&#13;&#10;                                        break;&#13;&#10;                                    case &quot;28|&quot;: // 场地标点&#13;&#10;                                        // 还没加这个&#13;&#10;                                        break;&#13;&#10;                                    case &quot;29|&quot;: // 实体标点&#13;&#10;                                        if (hideHeadMarkers) &#13;&#10;                                            keep = false;&#13;&#10;                                        break;&#13;&#10;                                    case &quot;251&quot;: // 报错日志，如 Oodle 压缩错误&#13;&#10;                                        keep = false;&#13;&#10;                                        break;&#13;&#10;                                    case &quot;256&quot;: case &quot;257&quot;: case &quot;258&quot;: case &quot;259&quot;: case &quot;261&quot;: case &quot;262&quot;: case &quot;263&quot;: case &quot;264&quot;:&#13;&#10;                                    case &quot;265&quot;: case &quot;266&quot;: case &quot;267&quot;: case &quot;270&quot;: case &quot;271&quot;: case &quot;272&quot;: case &quot;273&quot;: case &quot;274&quot;:&#13;&#10;                                    case &quot;275&quot;: case &quot;276&quot;: case &quot;277&quot;: case &quot;278&quot;: // 除了 战斗状态、战斗倒计时 以外的 Overlay 日志行&#13;&#10;                                        if (hideOverlay) &#13;&#10;                                            keep = false;&#13;&#10;                                        break;&#13;&#10;                                }&#13;&#10;                                if (keep) // 先写个最简单的，全部导出&#13;&#10;                                    writer.WriteLine(line);&#13;&#10;                                else&#13;&#10;                                    writer.WriteLine(EmptyLinePlaceholder);&#13;&#10;                            };&#13;&#10;&#13;&#10;                        // 读取 chunk 的行，并根据 writeAction 写入到新日志文件&#13;&#10;                        foreach (var line in chunk.ReadChunk(streamReader))&#13;&#10;                        {&#13;&#10;                            writeAction(line, streamWriter);&#13;&#10;                        }&#13;&#10;                    }&#13;&#10;                }&#13;&#10;            }&#13;&#10;&#13;&#10;            Clipboard.SetText(newLogName);&#13;&#10;            MessageBox.Show(&#13;&#10;                &quot;日志文件保存成功！\n\n&quot; +&#13;&#10;                &quot;已将文件目录复制到剪贴板，\n&quot; +&#13;&#10;                &quot;可在 FFLogs 上传器中选择文件界面中直接粘贴到 “文件名”。&quot;,&#13;&#10;                &quot;&quot;, MessageBoxButtons.OK, MessageBoxIcon.Information);&#13;&#10;        }&#13;&#10;        catch (Exception ex)&#13;&#10;        {&#13;&#10;            MessageBox.Show(&#13;&#10;                &quot;保存日志文件时出错: \n\n&quot; + ex.ToString(),&#13;&#10;                &quot;&quot;, MessageBoxButtons.OK, MessageBoxIcon.Error);&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    void ValidateChunkContinuity()&#13;&#10;    {&#13;&#10;        var prevEnd = -1;&#13;&#10;        foreach (var chunk in LogReader.LogChunks)&#13;&#10;        {&#13;&#10;            if (prevEnd + 1 != chunk.StartLineIdx)&#13;&#10;            {&#13;&#10;                throw new Exception(&#13;&#10;                    $&quot;检测到不连续的日志段：\n&quot; +&#13;&#10;                    $&quot;  前一段结束行号：{prevEnd + 1}\n&quot; +&#13;&#10;                    $&quot;  当前段开始行号：{chunk.StartLineIdx + 1}&quot;&#13;&#10;                );&#13;&#10;            }&#13;&#10;            prevEnd = chunk.EndLineIdx;&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    protected override void OnKeyDown(KeyEventArgs e)&#13;&#10;    {&#13;&#10;        base.OnKeyDown(e);&#13;&#10;        e.Handled = true;&#13;&#10;    }&#13;&#10;&#13;&#10;    void Form_Resize(object sender, EventArgs e)&#13;&#10;    {&#13;&#10;        SetDgvColWidth(false);&#13;&#10;    }&#13;&#10;&#13;&#10;    void SetDgvColWidth(bool resetBaseWidth)&#13;&#10;    {&#13;&#10;        dgvEncounters.Width = Width - 20;&#13;&#10;        string[] dgvMeasureStrings = new string[] {&#13;&#10;            &quot;-全选-&quot;,&#13;&#10;            &quot;-99-&quot;,&#13;&#10;            &quot;03/29 00:00:00&quot;,&#13;&#10;            &quot;00:00:59&quot;,&#13;&#10;            &quot;04 m 33.0 s&quot;,&#13;&#10;            &quot;阿卡迪亚零式登天斗技场 (轻量级1)&quot;,&#13;&#10;            &quot;1/99&quot;,&#13;&#10;            &quot;1/99&quot;,&#13;&#10;            &quot;000000 - 000000&quot;&#13;&#10;        };&#13;&#10;&#13;&#10;        if (dgvColumnBaseWidths == null || resetBaseWidth)&#13;&#10;        {&#13;&#10;            using (Graphics graphics = CreateGraphics())&#13;&#10;            {&#13;&#10;                dgvColumnBaseWidths = dgvMeasureStrings.Select(&#13;&#10;                    str =&gt; (int)Math.Ceiling(graphics.MeasureString(str, Font).Width)&#13;&#10;                    ).ToList();&#13;&#10;                foreach (DataGridViewRow row in dgvEncounters.Rows)&#13;&#10;                {&#13;&#10;                    string zoneName = row.Cells[5].Value?.ToString() ?? &quot;&quot;;&#13;&#10;                    int zoneNameWidth = (int)Math.Ceiling(graphics.MeasureString(zoneName, Font).Width);&#13;&#10;                    dgvColumnBaseWidths[5] = Math.Max(dgvColumnBaseWidths[5], zoneNameWidth);&#13;&#10;                }&#13;&#10;            }&#13;&#10;        }&#13;&#10;&#13;&#10;        bool isVerticalScrollBarVisible = dgvEncounters.DisplayedRowCount(false) &lt; dgvEncounters.RowCount;&#13;&#10;        int totalWidth = dgvEncounters.Width - (isVerticalScrollBarVisible ? SystemInformation.VerticalScrollBarWidth : 0);&#13;&#10;        int totalResidueWidth = totalWidth - dgvColumnBaseWidths.Sum();&#13;&#10;        int residueWidthOthers = (int)(Math.Round((double)totalResidueWidth) / (dgvEncounters.ColumnCount - 2));&#13;&#10;        int residueWidth5 = totalResidueWidth - (dgvEncounters.ColumnCount - 3) * residueWidthOthers;&#13;&#10;&#13;&#10;        dgvEncounters.Columns[0].Width = dgvColumnBaseWidths[0];&#13;&#10;        dgvEncounters.Columns[1].Width = dgvColumnBaseWidths[1];&#13;&#10;        for (int i = 2; i &lt; dgvEncounters.ColumnCount; i++)&#13;&#10;            dgvEncounters.Columns[i].Width = dgvColumnBaseWidths[i] + (i == 5 ? residueWidth5 : residueWidthOthers);&#13;&#10;    }&#13;&#10;&#13;&#10;    [STAThread]&#13;&#10;    public static void Main()&#13;&#10;    {&#13;&#10;        Application.EnableVisualStyles();&#13;&#10;        Application.SetCompatibleTextRenderingDefault(false);&#13;&#10;&#13;&#10;        Thread newThread = new Thread(() =&gt;&#13;&#10;        {&#13;&#10;            LogSeparatorForm form = new LogSeparatorForm();&#13;&#10;            Application.Run(form);&#13;&#10;        });&#13;&#10;&#13;&#10;        newThread.SetApartmentState(ApartmentState.STA);&#13;&#10;        newThread.Start();&#13;&#10;    }&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;LogSeparatorForm.Main();"/>
            </Actions>
          </Trigger>
        </Triggers>
      </Folder>
      <Folder Id="94007f0e-f8e9-4fce-806d-993fc2ecac7c" Enabled="true" Name="高级标点工具箱 AdvWm v4.9.4" RawEnvironmentVariables="version = 4.9.4">
        <Folders>
          <Folder Id="394ac746-5681-4536-9afc-d37e6dc88cbf" Enabled="true" Name="core">
            <Folders>
              <Folder Id="88b3482b-3b7a-458f-b0a8-c9ec62ebb636" Enabled="true" Name="WaymarkEncoder">
                <Folders>
                  <Folder Id="f097b7a3-2def-4047-b77d-f4dc84d93800" Enabled="true" Name="/e ?user">
                    <Triggers>
                      <Trigger Enabled="true" Id="c18169a2-d819-48c0-8427-22226e558ad2" Name="1. request" RegularExpression="^.{15}\S+ 00:0038::(?&lt;user&gt;[!?！？]user)$" PrevActionsRefire="Deny" PeriodRefire="Deny" RefirePeriodExpression="5000" Sequential="True">
                        <Actions>
                          <Action OrderNumber="1" ActionType="NamedCallback" DescBgColor="fdd" NamedCallbackName="command" NamedCallbackParam="/e [Debug] 发送 (${user})">
                            <Condition Enabled="true" Grouping="Or">
                              <ConditionSingle Enabled="true" ExpressionL="${ev:debug}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                            </Condition>
                          </Action>
                          <Action OrderNumber="2" ActionType="Trigger" Description="? 是匿名" DescriptionOverride="True" TriggerOp="EnableTrigger" TriggerId="b4610b8a-0776-4722-a53c-64521b3b0a90"/>
                          <Action OrderNumber="3" ActionType="Trigger" Description="! 是实名" DescriptionOverride="True" TriggerOp="EnableTrigger" TriggerId="0ec6d816-5579-43dd-ab2f-ae8ab17703fa"/>
                          <Action OrderNumber="4" ActionType="NamedCallback" NamedCallbackName="AdvWm" NamedCallbackParam="Action: Ask&#13;&#10;Anonymous: ${f:startwith(?):${f:tohalfwidth:${user}}}"/>
                        </Actions>
                      </Trigger>
                      <Trigger Enabled="true" Id="0ec6d816-5579-43dd-ab2f-ae8ab17703fa" Name="3. receive" RegularExpression="^.{15}\S+ 1C:Add:(?&lt;wm&gt;[0-7]):.{8}:[^:]*:(?&lt;x&gt;[^:]+1):(?&lt;y&gt;[^:]+1):(?&lt;z&gt;[^:]+)">
                        <Actions>
                          <Action OrderNumber="1" ActionType="NamedCallback" DescBgColor="fdd" NamedCallbackName="command" NamedCallbackParam="/e [Debug] 接收 小队&#13;&#10;[${?l:A,B,C,D,1,2,3,4[${n: ${wm} + 1}]}] @ (${x}, ${y}, ${z})">
                            <Condition Enabled="true" Grouping="Or">
                              <ConditionSingle Enabled="true" ExpressionL="${ev:debug}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                            </Condition>
                          </Action>
                          <Action OrderNumber="2" ActionType="ListVariable" Asynchronous="False" ListVariableOp="Push" ListVariableName="AdvWm_users" ListVariableExpression="${wm}, ${n: round((${z} - floor(${z}) - 0.01) * 100)}"/>
                        </Actions>
                        <Condition Enabled="true" Grouping="And">
                          <ConditionSingle Enabled="true" ExpressionL="${z} - floor(${z})" ExpressionTypeL="Numeric" ExpressionR="0.16" ExpressionTypeR="Numeric" ConditionType="NumericLessEqual"/>
                          <ConditionSingle Enabled="true" ExpressionL="${z} - floor(${z})" ExpressionTypeL="Numeric" ExpressionR="0" ExpressionTypeR="Numeric" ConditionType="NumericGreater"/>
                        </Condition>
                      </Trigger>
                      <Trigger Enabled="true" Id="b4610b8a-0776-4722-a53c-64521b3b0a90" Name="2. answer + print" RegularExpression="^.{15}\S+ 1C:Add:(?&lt;wm&gt;[0-7]):.{8}:[^:]*:(?&lt;x&gt;[^:]+1):(?&lt;y&gt;[^:]+1):(?&lt;z&gt;[^:]+)">
                        <Actions>
                          <Action OrderNumber="1" ActionType="NamedCallback" Asynchronous="False" DescBgColor="fdd" NamedCallbackName="command" NamedCallbackParam="/e [Debug] 应答 小队&#13;&#10;[${?l:A,B,C,D,1,2,3,4[${n: ${wm} + 1}]}] @ (${x}, ${y}, ${z})">
                            <Condition Enabled="true" Grouping="Or">
                              <ConditionSingle Enabled="true" ExpressionL="${ev:debug}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                            </Condition>
                          </Action>
                          <Action OrderNumber="2" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="AdvWm" NamedCallbackParam="Action: Answer&#13;&#10;IsAlliance: 0"/>
                          <Action OrderNumber="3" ActionType="NamedCallback" ExecutionDelayExpression="1000" Asynchronous="False" NamedCallbackName="AdvWm" NamedCallbackParam="Action: GetUsers"/>
                          <Action OrderNumber="4" ActionType="NamedCallback" Asynchronous="False" DescBgColor="fdd" NamedCallbackName="command" NamedCallbackParam="/e [Debug] Users 小队&#13;&#10;${l:AdvWm_users.join(&quot;⏎&quot;)}">
                            <Condition Enabled="true" Grouping="Or">
                              <ConditionSingle Enabled="true" ExpressionL="${ev:debug}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                            </Condition>
                          </Action>
                          <Action OrderNumber="5" ActionType="ListVariable" Asynchronous="False" ListVariableName="AdvWm_users"/>
                        </Actions>
                        <Condition Enabled="true" Grouping="And">
                          <ConditionSingle Enabled="true" ExpressionL="${z} - floor(${z})" ExpressionTypeL="Numeric" ExpressionR="0" ExpressionTypeR="Numeric" ConditionType="NumericGreater"/>
                          <ConditionSingle Enabled="true" ExpressionL="${z} - floor(${z})" ExpressionTypeL="Numeric" ExpressionR="0.16" ExpressionTypeR="Numeric" ConditionType="NumericLessEqual"/>
                          <ConditionSingle Enabled="true" ExpressionL="((${z} - floor(${z})) * 100 - 1) &amp; 8" ExpressionTypeL="Numeric" ExpressionR="8" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                          <ConditionSingle Enabled="false" ExpressionL="注：有 发送者 的 flag" ExpressionTypeL="String" ExpressionR="" ExpressionTypeR="String" ConditionType="NumericEqual"/>
                        </Condition>
                      </Trigger>
                      <Trigger Enabled="true" Id="684667a2-ab2d-47d9-8e95-e53b6f94fdd6" Name="0. 初始化" RegularExpression="^.{15}\S+ 01">
                        <Actions>
                          <Action OrderNumber="1" ActionType="ListVariable" ListVariableName="AdvWm_users"/>
                        </Actions>
                      </Trigger>
                    </Triggers>
                  </Folder>
                  <Folder Id="41c595b2-8147-486f-a0f5-9fc11fbd0667" Enabled="true" Name="/e ?tell">
                    <Triggers>
                      <Trigger Enabled="true" Id="c91a32fb-cecd-483b-9b6a-d79fb492ca6d" Name="2. receive" RegularExpression="^.{15}\S+ 1C:Add:0:.{8}:[^:]*:(?&lt;x&gt;[^:]+):531\.00:531\.(?&lt;offsetZ&gt;..)">
                        <Actions>
                          <Action OrderNumber="1" ActionType="NamedCallback" DescBgColor="fdd" NamedCallbackName="command" NamedCallbackParam="/e [Debug] 接收文本消息&#13;&#10;[A] @ (${x}, 531.00, 531.${offsetZ})">
                            <Condition Enabled="true" Grouping="Or">
                              <ConditionSingle Enabled="true" ExpressionL="${ev:debug}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                            </Condition>
                          </Action>
                          <Action OrderNumber="2" ActionType="NamedCallback" ExecutionDelayExpression="500" NamedCallbackName="AdvWm" NamedCallbackParam="Action: Decode"/>
                        </Actions>
                        <Condition Enabled="true" Grouping="And">
                          <ConditionSingle Enabled="true" ExpressionL="(${offsetZ} - 1) &amp; 8" ExpressionTypeL="Numeric" ExpressionR="8" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Trigger>
                      <Trigger Enabled="true" Id="dc052755-3282-4f66-a55f-4dbe6db18dd1" Name="1. send" RegularExpression="^.{15}\S+ 00:0038::(?i) *(?&lt;tell&gt;[!?！？]tell) +(?&lt;msg&gt;.+?) *$">
                        <Actions>
                          <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="AdvWm" NamedCallbackParam="Action: Encode&#13;&#10;Anonymous: ${f:startwith(?):${f:tohalfwidth:${tell}}}&#13;&#10;Data: ${msg}"/>
                        </Actions>
                      </Trigger>
                      <Trigger Enabled="true" Id="9c4592b0-515f-4628-ad52-7a17424ca2a0" Name="help   /e ?tell" RegularExpression="^.{15}\S+ 00:0038::(?i) *(?&lt;tell&gt;[?？]tell) *$">
                        <Actions>
                          <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="command" NamedCallbackParam="/e &#13;&#10;此聊天频道为加密通讯频道，&#13;&#10;由远程触发器的高级标点工具箱提供支持，&#13;&#10;通过标点坐标编码文本，&#13;&#10;实现仅工具使用者可见的加密通讯。&#13;&#10;&#13;&#10;你可以使用指令发送消息：&#13;&#10;&quot;/e ?tell 消息文本&quot;：匿名发送&#13;&#10;&quot;/e !tell 消息文本&quot;：实名发送&#13;&#10;&#13;&#10;由于发送消息会更改场地标点，&#13;&#10;发送消息后注意还原场地标点。"/>
                        </Actions>
                      </Trigger>
                    </Triggers>
                  </Folder>
                </Folders>
              </Folder>
            </Folders>
            <Triggers>
              <Trigger Enabled="true" Id="a451237e-d8ae-44b7-b96a-00135d7edf26" Name="注册回调" RegularExpression="^.{15}\S+ 01:" Sequential="True">
                <Actions>
                  <Action OrderNumber="1" ActionType="ExecuteScript" Description="【代码】" DescBgColor="acf" DescriptionOverride="True" ExecScriptExpression="using System;&#13;&#10;using System.Collections;&#13;&#10;using System.Collections.Generic;&#13;&#10;using System.Linq;&#13;&#10;using System.Text;&#13;&#10;using Triggernometry.Core;&#13;&#10;using Triggernometry.Expressions.Maths;&#13;&#10;using Triggernometry.Expressions.String.Models;&#13;&#10;using Triggernometry.Expressions.String.Utils;&#13;&#10;using Triggernometry.FFXIV;&#13;&#10;using Triggernometry.PluginBridges.BridgeNamazu;&#13;&#10;using Triggernometry.Utilities;&#13;&#10;using Triggernometry.Utilities.Maths;&#13;&#10;using static System.Math;&#13;&#10;using static Triggernometry.Core.Scripting.ScriptHelper;&#13;&#10;&#13;&#10;public struct Info&#13;&#10;{&#13;&#10;    public const string Name = &quot;AdvWm&quot;;&#13;&#10;    public const string NameCN = &quot;高级标点工具箱&quot;;&#13;&#10;    public const string Version = &quot;${env:version}&quot;;&#13;&#10;    public const string Author = &quot;阿洛 MnFeN&quot;;&#13;&#10;&#13;&#10;    public static string InitInfo =&gt; $&quot;{Name}：{NameCN} v{Version} by {Author} 已成功初始化。&quot;;&#13;&#10;}&#13;&#10;&#13;&#10;RealPlugin.Instance.RegisterNamedCallback(&quot;AdvWm&quot;, new Action&lt;object, string&gt;(AdvWm.NamedCallback), null, registrant: $&quot;{Info.NameCN} v{Info.Version}&quot;);&#13;&#10;RealPlugin.Instance.InvokeNamedCallback(&quot;NamazuLog&quot;, Info.InitInfo);&#13;&#10;Log(RealPlugin.DebugLevelEnum.Custom, Info.InitInfo);&#13;&#10;&#13;&#10;public class AdvWm&#13;&#10;{&#13;&#10;    string _command;&#13;&#10;    MultiLineRawArgs _data;&#13;&#10;    public AdvWm(string command) =&gt; _command = command;&#13;&#10;&#13;&#10;    public static void Log(string message) =&gt; RealPlugin.Instance.InvokeNamedCallback(&quot;command&quot;, $&quot;/e {message}&quot;);&#13;&#10;&#13;&#10;    public static void NamedCallback(object _, string input)&#13;&#10;    {&#13;&#10;        var commands = input.Split(new string[] { &quot;---&quot; }, StringSplitOptions.None);&#13;&#10;        foreach (var command in commands)&#13;&#10;        {&#13;&#10;            new AdvWm(command).Execute();&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    static readonly HashSet&lt;string&gt; postNamazuWaymarkKeywords = new HashSet&lt;string&gt; {&#13;&#10;        &quot;save&quot;, &quot;backup&quot;, &quot;load&quot;, &quot;restore&quot;, &quot;reset&quot;, &quot;clear&quot;, &quot;public&quot;&#13;&#10;    };&#13;&#10;&#13;&#10;    private void Execute()&#13;&#10;    {&#13;&#10;        // 首先判断是否为关键词模式&#13;&#10;        string simpleCmd = _command.ToLower().Trim();&#13;&#10;        if (postNamazuWaymarkKeywords.Contains(simpleCmd))&#13;&#10;        {&#13;&#10;            RealPlugin.Instance.InvokeNamedCallback(&quot;place&quot;, simpleCmd);&#13;&#10;            return;&#13;&#10;        }&#13;&#10;&#13;&#10;        // 初始化 解析键值对&#13;&#10;        _data = new MultiLineRawArgs(_command);&#13;&#10;        // 提取共通参数&#13;&#10;        string action = _data.TryGet(&quot;Action&quot;, out action) ? action : &quot;&quot;;&#13;&#10;        bool log = !_data.TryGet(&quot;Log&quot;, out string rawLog) || bool.Parse(rawLog.ToLower());&#13;&#10;        bool local = !_data.TryGet(out string rawLocal, &quot;Local&quot;, &quot;LocalOnly&quot;) || bool.Parse(rawLocal.ToLower());&#13;&#10;&#13;&#10;        Waymarks waymarks;&#13;&#10;        switch (action?.ToLower())&#13;&#10;        {&#13;&#10;            case &quot;getversion&quot;:&#13;&#10;                SetScalarVariable(false, $&quot;{Info.Name}_version&quot;, Info.Version); return;&#13;&#10;            case &quot;encode&quot;:&#13;&#10;                {&#13;&#10;                    bool isAnonymous = _data.Get(&quot;Anonymous&quot;).ParseData&lt;bool&gt;();&#13;&#10;                    WaymarksEncoder.EncryptedMessageHandler.EncodeMessageAndSendWaymarks(_data.Get(&quot;data&quot;), isAnonymous);&#13;&#10;                    return;&#13;&#10;                }&#13;&#10;            case &quot;decode&quot;:&#13;&#10;                WaymarksEncoder.EncryptedMessageHandler.DecodeMessageAndPrint();&#13;&#10;                return;&#13;&#10;            case &quot;ask&quot;:&#13;&#10;                {&#13;&#10;                    bool isAnonymous = _data.Get(&quot;Anonymous&quot;).ParseData&lt;bool&gt;();&#13;&#10;                    WaymarksEncoder.UserQuery.Ask(isAnonymous);&#13;&#10;                    return;&#13;&#10;                }&#13;&#10;            case &quot;answer&quot;:&#13;&#10;                {&#13;&#10;                    WaymarksEncoder.UserQuery.Answer();&#13;&#10;                    return;&#13;&#10;                }&#13;&#10;            case &quot;getusers&quot;:&#13;&#10;                WaymarksEncoder.UserQuery.GetUsersResult(); return;&#13;&#10;            case &quot;polar&quot;: // 不推荐使用，仅为兼容旧版本，可被 default 模式完全替代&#13;&#10;                waymarks = ParseWaymarksPolar(); break;&#13;&#10;            case &quot;circle&quot;:&#13;&#10;                waymarks = ParseWaymarksCircle(); break;&#13;&#10;            case &quot;arc&quot;:&#13;&#10;                waymarks = ParseWaymarksArc(); break;&#13;&#10;            case &quot;linear&quot;:&#13;&#10;            case &quot;connect&quot;:&#13;&#10;            case &quot;linearconnect&quot;:&#13;&#10;                waymarks = ParseWaymarksLinearConnect(); break;&#13;&#10;            // case &quot;absolute&quot;:  case &quot;relative&quot;:  case &quot;place&quot;: 旧版本的指令全部整合为默认的标点模式&#13;&#10;            default:&#13;&#10;                waymarks = ParseWaymarksDefault(); break;&#13;&#10;        }&#13;&#10;        // Log($&quot;初始：\n{waymarks}&quot;);&#13;&#10;        TryApplyScales(waymarks);&#13;&#10;        // Log($&quot;伸缩：\n{waymarks}&quot;);&#13;&#10;        TryApplyRotation(waymarks);&#13;&#10;        // Log($&quot;旋转：\n{waymarks}&quot;);&#13;&#10;        TryApplyCenter(waymarks);&#13;&#10;        // Log($&quot;平移：\n{waymarks}&quot;);&#13;&#10;        waymarks.LocalOnly = local;&#13;&#10;        waymarks.Log = log;&#13;&#10;        waymarks.Mark();&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 根据提供的所有坐标，生成一组初始标点。 &lt;/summary&gt;&#13;&#10;    private Waymarks ParseWaymarksDefault()&#13;&#10;    {&#13;&#10;        Waymarks waymarks = new Waymarks();&#13;&#10;        foreach (string name in Waymark.WaymarkNames)  // a b c d 1 2 3 4&#13;&#10;        {&#13;&#10;            if (_data.TryGet(name, out string rawCoord))&#13;&#10;            {&#13;&#10;                waymarks.Add(Waymark.Parse(name, rawCoord));&#13;&#10;            }&#13;&#10;        }&#13;&#10;        return waymarks;&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 根据提供的所有极坐标，生成一组初始标点。建议使用 Default 替代。 &lt;/summary&gt;&#13;&#10;    private Waymarks ParseWaymarksPolar()&#13;&#10;    {&#13;&#10;        Waymarks waymarks = new Waymarks();&#13;&#10;        foreach (string name in Waymark.WaymarkNames)  // a b c d 1 2 3 4&#13;&#10;        {&#13;&#10;            if (_data.TryGet(name, out string rawPolarCoord))&#13;&#10;            {   // 已重构为接近正常方法的处理逻辑&#13;&#10;                XIVCoord polarCoord = XIVCoord.ParseRawData(rawPolarCoord.StartsWith(&quot;polar &quot;) ? rawPolarCoord : $&quot;polar {rawPolarCoord}&quot;);&#13;&#10;                waymarks.Add(new Waymark(name, polarCoord.ToCartesian()));&#13;&#10;            }&#13;&#10;        }&#13;&#10;        return waymarks;&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 根据提供的半径和标点名，生成一组排列成圆周的初始标点。 &lt;/summary&gt;&#13;&#10;    private Waymarks ParseWaymarksCircle()&#13;&#10;    {&#13;&#10;        Waymarks waymarks = new Waymarks();&#13;&#10;        double rCardinal = MathParser.Parse(_data.Get(&quot;R&quot;));&#13;&#10;        double rIntercard = _data.TryGet(&quot;R2&quot;, out string rawR2) ? MathParser.Parse(rawR2) : rCardinal;&#13;&#10;        string[] usedWaymarkNames = _data.Get(&quot;Waymarks&quot;).Select(c =&gt; char.ToLower(c).ToString()).ToArray(); // 用哪些点 相对正北逆时针 如 A4D3C2B1&#13;&#10;        double step = 2 * PI / usedWaymarkNames.Length; // 相邻标点的角度差&#13;&#10;        int count = 0;&#13;&#10;        foreach (string name in usedWaymarkNames)  // a b c d 1 2 3 4&#13;&#10;        {&#13;&#10;            if (Waymark.WaymarkNames.Contains(name))&#13;&#10;            {&#13;&#10;                var r = (count &amp; 1) == 0 ? rCardinal : rIntercard;&#13;&#10;                var θ = count * step - PI;&#13;&#10;                waymarks.Add(new Waymark(name, new PolarCoord(r, θ, 0)));&#13;&#10;            }&#13;&#10;            count++;&#13;&#10;        }&#13;&#10;        return waymarks;&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 根据提供的半径、标点名、圆心角，生成一组排列成弧线的初始标点。 &lt;/summary&gt;&#13;&#10;    private Waymarks ParseWaymarksArc()&#13;&#10;    {&#13;&#10;        Waymarks waymarks = new Waymarks();&#13;&#10;        double r = MathParser.Parse(_data.Get(&quot;R&quot;));   // 半径&#13;&#10;        string[] usedWaymarkNames = _data.Get(&quot;Waymarks&quot;).Select(c =&gt; char.ToLower(c).ToString()).ToArray(); // 用哪些点 相对正北逆时针 如 A4D3C2B1&#13;&#10;        int stepCount = usedWaymarkNames.Length - 1;&#13;&#10;&#13;&#10;        // 圆弧的圆心角，不提供的时候默认为使标点紧邻的角度（弧长约 2.6）&#13;&#10;        double dθ = _data.TryGet(out string rawdθ, &quot;dθ&quot;, &quot;dTheta&quot;) ? MathParser.Parse(rawdθ) : (stepCount &gt;= 1) ? 2.6 / r * stepCount : 0;&#13;&#10;        double θStep = (stepCount &gt;= 1) ? dθ / stepCount : 0; // 相邻标点的角度差&#13;&#10;        int count = 0;&#13;&#10;        foreach (string name in usedWaymarkNames)  // a b c d 1 2 3 4&#13;&#10;        {&#13;&#10;            if (Waymark.WaymarkNames.Contains(name)) // 允许使用非标点名的字符占位等分点，不会生成标点&#13;&#10;            {&#13;&#10;                PolarCoord polarCoord = new PolarCoord(r, (count - stepCount / 2.0) * θStep - PI, 0);&#13;&#10;                waymarks.Add(new Waymark(name, polarCoord));&#13;&#10;            }&#13;&#10;            count++;&#13;&#10;        }&#13;&#10;        return waymarks;&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 根据提供的起点、终点、标点名，生成线性插值的初始标点。 &lt;/summary&gt;&#13;&#10;    private Waymarks ParseWaymarksLinearConnect()&#13;&#10;    {&#13;&#10;        Waymarks waymarks = new Waymarks();&#13;&#10;        string[] usedWaymarkNames = _data.Get(&quot;Waymarks&quot;).Select(c =&gt; char.ToLower(c).ToString()).ToArray(); // 用哪些点 起点到终点 如 A4D3C2B1&#13;&#10;        if (usedWaymarkNames.Length &lt; 2)&#13;&#10;        {&#13;&#10;            throw new Exception(&quot;AdvWm: LinearConnect 模式下，提供的标点数量不足 2&quot;);&#13;&#10;        }&#13;&#10;        XIVCoord startCoord = XIVCoord.ParseRawData(_data.Get(&quot;start&quot;));&#13;&#10;        XIVCoord endCoord = XIVCoord.ParseRawData(_data.Get(&quot;end&quot;));&#13;&#10;        XIVCoord vector = endCoord - startCoord;&#13;&#10;        double totalDistance = vector.Length;&#13;&#10;        // Log($&quot;{vector}&quot;);&#13;&#10;        int count = 0;&#13;&#10;        foreach (string name in usedWaymarkNames)  // A B C D 1 2 3 4&#13;&#10;        {&#13;&#10;            if (Waymark.WaymarkNames.Contains(name))&#13;&#10;            {&#13;&#10;                double percentage = (double)count / (usedWaymarkNames.Length - 1);  // 标点默认等分&#13;&#10;                if (_data.TryGet(name, out string rawDistance))   // 也可以不等分，自定义标点位置&#13;&#10;                {&#13;&#10;                    if (rawDistance.EndsWith(&quot; m&quot;))      // 以 A: 5 m 形式提供的距离&#13;&#10;                    {&#13;&#10;                        // @d 代表总长度，如 A: @d - 5 m 意为终点前 5 m&#13;&#10;                        string strTotalDistance = totalDistance.ToString(MathParser.CultureInfo);&#13;&#10;                        rawDistance = rawDistance.Replace(&quot;@d&quot;, strTotalDistance);&#13;&#10;                        double distance = MathParser.Parse(rawDistance.Substring(0, rawDistance.Length - 2));&#13;&#10;                        percentage = distance / totalDistance;&#13;&#10;                    }&#13;&#10;                    else                                // 以 A: 0.125 形式提供的百分比&#13;&#10;                    {&#13;&#10;                        percentage = MathParser.Parse(rawDistance);&#13;&#10;                    }&#13;&#10;                }&#13;&#10;&#13;&#10;                XIVCoord coord = startCoord + percentage * vector;&#13;&#10;                waymarks.Add(new Waymark(name, coord));&#13;&#10;            }&#13;&#10;            count++;&#13;&#10;        }&#13;&#10;        return waymarks;&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 如果当前指令提供了任何伸缩，将伸缩变换应用到给定的一组标点坐标。 &lt;/summary&gt;&#13;&#10;    /// &lt;returns&gt;&lt;/returns&gt;&#13;&#10;    private void TryApplyScales(Waymarks waymarks)&#13;&#10;    {&#13;&#10;        // 首先尝试解析 Scale 和具体的 ScaleX, ScaleY, ScaleZ 参数&#13;&#10;        bool hasScale = _data.TryGet(&quot;Scale&quot;, out string rawScale);&#13;&#10;        bool hasScaleX = _data.TryGet(&quot;ScaleX&quot;, out string rawScaleX);&#13;&#10;        bool hasScaleY = _data.TryGet(&quot;ScaleY&quot;, out string rawScaleY);&#13;&#10;        bool hasScaleZ = _data.TryGet(&quot;ScaleZ&quot;, out string rawScaleZ);&#13;&#10;&#13;&#10;        // 未给定参数则免去解析直接返回&#13;&#10;        if (!hasScale &amp;&amp; !hasScaleX &amp;&amp; !hasScaleY &amp;&amp; !hasScaleZ) return;&#13;&#10;&#13;&#10;        // 如果存在 scale 参数，按照 scaleX ?? scale ?? 1 的优先级解析&#13;&#10;        double defaultScale = hasScale ? MathParser.Parse(rawScale) : 1;&#13;&#10;&#13;&#10;        double scaleX = hasScaleX ? MathParser.Parse(rawScaleX) : defaultScale;&#13;&#10;        double scaleY = hasScaleY ? MathParser.Parse(rawScaleY) : defaultScale;&#13;&#10;        double scaleZ = hasScaleZ ? MathParser.Parse(rawScaleZ) : defaultScale;&#13;&#10;&#13;&#10;        // 如果任一缩放倍率不是 1，则缩放&#13;&#10;        if (Abs(scaleX - 1) &gt; 1e-5 || Abs(scaleY - 1) &gt; 1e-5 || Abs(scaleZ - 1) &gt; 1e-5)&#13;&#10;        {&#13;&#10;            foreach (Waymark wm in waymarks)&#13;&#10;            {&#13;&#10;                wm.Coord = wm.Coord.ScaleBy(scaleX, scaleY, scaleZ);&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 如果当前指令提供了旋转，将伸缩变换应用到给定的一组标点坐标。 &lt;/summary&gt;&#13;&#10;    /// &lt;returns&gt;&lt;/returns&gt;&#13;&#10;    private void TryApplyRotation(Waymarks waymarks)&#13;&#10;    {&#13;&#10;        if (_data.TryGet(out string rawθ, &quot;θ&quot;, &quot;Theta&quot;))&#13;&#10;        {&#13;&#10;            double θ = MathParser.Parse(rawθ);&#13;&#10;            foreach (Waymark wm in waymarks)&#13;&#10;            {&#13;&#10;                wm.Coord = wm.Coord.RotateTo(θ);&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 如果当前指令提供了场地中心，将场地中心应用到给定的一组标点坐标。 &lt;/summary&gt;&#13;&#10;    void TryApplyCenter(Waymarks waymarks)&#13;&#10;    {&#13;&#10;        if (_data.TryGet(out string rawCenter, &quot;O&quot;, &quot;Center&quot;))&#13;&#10;        {&#13;&#10;            XIVCoord centerCoord = XIVCoord.ParseRawData(rawCenter);&#13;&#10;            foreach (Waymark wm in waymarks)&#13;&#10;            {&#13;&#10;                wm.Coord = wm.Coord.MoveTo(centerCoord);&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;#region Waymark(s)&#13;&#10;&#13;&#10;public enum WaymarkType { A, B, C, D, One, Two, Three, Four }&#13;&#10;public class Waymark&#13;&#10;{&#13;&#10;    public WaymarkType Type { get; set; }&#13;&#10;    public XIVCoord Coord { get; set; }&#13;&#10;    public bool Ignore { get; set; }&#13;&#10;    public bool Active { get; set; }&#13;&#10;&#13;&#10;    /// &lt;summary&gt;&#13;&#10;    /// 用于遍历时保证输出顺序&#13;&#10;    /// &lt;/summary&gt;&#13;&#10;    public static readonly string[] WaymarkNames = new string[] { &quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot; };&#13;&#10;    public static readonly WaymarkType[] WaymarkTypes = new WaymarkType[]&#13;&#10;    {&#13;&#10;        WaymarkType.A, WaymarkType.B, WaymarkType.C, WaymarkType.D,&#13;&#10;        WaymarkType.One, WaymarkType.Two, WaymarkType.Three, WaymarkType.Four&#13;&#10;    };&#13;&#10;&#13;&#10;    /// &lt;summary&gt;&#13;&#10;    /// 从用户输入的标点类型转化为实际 Type&#13;&#10;    /// &lt;/summary&gt;&#13;&#10;    public static readonly Dictionary&lt;string, WaymarkType&gt; TypeMap = Enumerable.Range(0, 8)&#13;&#10;        .ToDictionary(i =&gt; WaymarkNames[i], i =&gt; WaymarkTypes[i]);&#13;&#10;&#13;&#10;    public Waymark(WaymarkType type, XIVCoord coord = null, bool ignore = false)&#13;&#10;    {&#13;&#10;        Type = type;&#13;&#10;        Coord = coord ?? new CartesianCoord(0, 0, 0);&#13;&#10;        Active = coord != null;&#13;&#10;        Ignore = ignore;&#13;&#10;    }&#13;&#10;&#13;&#10;    public Waymark(string rawType, XIVCoord coord = null, bool ignore = false)&#13;&#10;    {&#13;&#10;        if (TypeMap.TryGetValue(rawType, out var mappedType))&#13;&#10;        {&#13;&#10;            Type = mappedType;&#13;&#10;        }&#13;&#10;        else&#13;&#10;        {&#13;&#10;            throw new Exception($&quot;AdvWm: {rawType} 不是合法的标点名之一（A B C D 1 2 3 4）。&quot;);&#13;&#10;        }&#13;&#10;        Coord = coord ?? new CartesianCoord(0, 0, 0);&#13;&#10;        Active = coord != null;&#13;&#10;        Ignore = ignore;&#13;&#10;    }&#13;&#10;&#13;&#10;    public static Waymark Parse(string rawType, string rawCoord, bool ignore = false)&#13;&#10;    {&#13;&#10;        Waymark wm = new Waymark(rawType, null, ignore);&#13;&#10;&#13;&#10;        switch (rawCoord.Trim().ToLower())&#13;&#10;        {&#13;&#10;            // 清除标点&#13;&#10;            case &quot;clear&quot;:&#13;&#10;                wm.Active = false;&#13;&#10;                wm.Coord = new CartesianCoord(0, 0, 0);&#13;&#10;                break;&#13;&#10;            // 变相地“清除”标点  不会有淡入淡出动画&#13;&#10;            case &quot;fakeclear&quot;:&#13;&#10;                wm.Active = true;&#13;&#10;                wm.Coord = new CartesianCoord(0, 0, 1000);&#13;&#10;                break;&#13;&#10;            default:&#13;&#10;                wm.Active = true;&#13;&#10;                wm.Coord = XIVCoord.ParseRawData(rawCoord);&#13;&#10;                break;&#13;&#10;        }&#13;&#10;&#13;&#10;        return wm;&#13;&#10;    }&#13;&#10;&#13;&#10;    public string Jsonify()&#13;&#10;    {&#13;&#10;        if (Ignore)&#13;&#10;            return &quot;&quot;;&#13;&#10;        if (Active)&#13;&#10;            return $&quot;\&quot;{Type}\&quot;: {{ {Coord.Jsonify()}, \&quot;Active\&quot;: true }}&quot;;&#13;&#10;        else&#13;&#10;            return $&quot;\&quot;{Type}\&quot;: {{}}&quot;;&#13;&#10;    }&#13;&#10;&#13;&#10;    public override string ToString() =&gt; Jsonify();&#13;&#10;}&#13;&#10;&#13;&#10;public sealed class Waymarks : IEnumerable&lt;Waymark&gt;&#13;&#10;{&#13;&#10;    private readonly Dictionary&lt;WaymarkType, Waymark&gt; _waymarks;&#13;&#10;    public bool Log = true;&#13;&#10;    public bool LocalOnly = true;&#13;&#10;&#13;&#10;    public Waymarks()&#13;&#10;    {&#13;&#10;        _waymarks = new Dictionary&lt;WaymarkType, Waymark&gt;();&#13;&#10;        foreach (var type in Waymark.WaymarkTypes)&#13;&#10;        {&#13;&#10;            _waymarks[type] = new Waymark(type, ignore: true);&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    public Waymark this[WaymarkType type]&#13;&#10;    {&#13;&#10;        get =&gt; _waymarks[type];&#13;&#10;        set =&gt; _waymarks[type] = value;&#13;&#10;    }&#13;&#10;&#13;&#10;    IEnumerator IEnumerable.GetEnumerator() =&gt; GetEnumerator();&#13;&#10;    public IEnumerator&lt;Waymark&gt; GetEnumerator()&#13;&#10;    {&#13;&#10;        foreach (var type in Waymark.WaymarkTypes)&#13;&#10;        {&#13;&#10;            if (_waymarks.TryGetValue(type, out Waymark waymark))&#13;&#10;            {&#13;&#10;                yield return waymark;&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    public void Add(Waymark wm)&#13;&#10;    {&#13;&#10;        if (wm == null || wm.Ignore) return;&#13;&#10;        else _waymarks[wm.Type] = wm;&#13;&#10;    }&#13;&#10;&#13;&#10;    public string Jsonify()&#13;&#10;    {&#13;&#10;        var jsonList = _waymarks.Values.Where(wm =&gt; wm?.Ignore == false)&#13;&#10;            .Select(wm =&gt; &quot;    &quot; + wm.Jsonify()).ToList();&#13;&#10;        if (!Log)&#13;&#10;            jsonList.Add($&quot;    \&quot;Log\&quot;: false&quot;);&#13;&#10;        if (!LocalOnly)&#13;&#10;            jsonList.Add($&quot;    \&quot;LocalOnly\&quot;: false&quot;);&#13;&#10;        string data = string.Join(&quot;,\n&quot;, jsonList);&#13;&#10;        return $&quot;{{\n{string.Join(&quot;,\n&quot;, jsonList)}\n}}&quot;;&#13;&#10;    }&#13;&#10;    public override string ToString() =&gt; Jsonify();&#13;&#10;&#13;&#10;    public void Mark()&#13;&#10;    {&#13;&#10;        RealPlugin.Instance.InvokeNamedCallback(&quot;place&quot;, this.Jsonify());&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;#endregion Waymark(s)&#13;&#10;&#13;&#10;public static class WaymarksEncoder&#13;&#10;{&#13;&#10;    /// &lt;summary&gt; 用于表示用户状态的 flags。 &lt;/summary&gt;&#13;&#10;    [Flags]&#13;&#10;    public enum StatusFlags : byte&#13;&#10;    {&#13;&#10;        None = 0,&#13;&#10;        /// &lt;summary&gt; 是否将自身标记为匿名。 &lt;/summary&gt;&#13;&#10;        IsAnonymous = 1,&#13;&#10;        /// &lt;summary&gt; 是否将编码的 ID 替换为空值。 &lt;/summary&gt;&#13;&#10;        IsIdHidden = 2,&#13;&#10;        /// &lt;summary&gt; 鲶鱼精邮差的 WayMark 功能是否启用。 &lt;/summary&gt;&#13;&#10;        IsWaymarkEnabled = 4,&#13;&#10;        /// &lt;summary&gt; 是否主动请求数据 / 主动发送消息。 &lt;/summary&gt;&#13;&#10;        IsInitiator = 8,&#13;&#10;        /// &lt;summary&gt; 是否是团队模式（编码实际 id 而非小队次序） &lt;/summary&gt;&#13;&#10;        // IsAllianceMode = 16, 似乎没用 删了&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 将 StatusFlags 编码为 z 坐标的小数部分。&lt;/summary&gt;&#13;&#10;    public static float FlagsToOffsetZ(StatusFlags flags)&#13;&#10;    {&#13;&#10;        return (byte)flags * 0.01f + 0.01f;&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 将用于编码 StatusFlags 的 z 坐标转化回 StatusFlags。&lt;/summary&gt;&#13;&#10;    public static StatusFlags ZToFlags(float z)&#13;&#10;    {&#13;&#10;        return (StatusFlags)(byte)Round((z - Floor(z) - 0.01) * 100);&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 从用户配置中提取 IsAnonymous 与 IsIdHidden 信息 &lt;/summary&gt;&#13;&#10;    static StatusFlags UserConfigAnonymousFlags&#13;&#10;    {&#13;&#10;        get&#13;&#10;        {&#13;&#10;            var data = GetScalarVariable(true, &quot;AdvWm_Anonymous&quot;);&#13;&#10;            StatusFlags result;&#13;&#10;            if (data == null)&#13;&#10;            {&#13;&#10;                result = StatusFlags.None;&#13;&#10;            }&#13;&#10;            else if (!byte.TryParse(data, out var rawResult))&#13;&#10;            {&#13;&#10;                result = StatusFlags.IsAnonymous;&#13;&#10;            }&#13;&#10;            else&#13;&#10;            {&#13;&#10;                result = (StatusFlags)rawResult;&#13;&#10;                result &amp;= (StatusFlags.IsAnonymous | StatusFlags.IsIdHidden);&#13;&#10;            }&#13;&#10;            // 保存正确格式，或删除&#13;&#10;            SetScalarVariable(true, &quot;AdvWm_Anonymous&quot;, result != StatusFlags.None ? (byte?)result : null);&#13;&#10;            return result;&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 用场地标点的坐标加密、解密文本信息，仅通过标点实现用户之间的加密通信频道。&lt;/summary&gt;&#13;&#10;    public static class EncryptedMessageHandler&#13;&#10;    {&#13;&#10;        /// &lt;summary&gt; 将一个 ±16384 以内、三位小数精度的 float 游戏坐标编码为 uint24。&lt;/summary&gt;&#13;&#10;        static int CoordToInt(float coord)&#13;&#10;        {&#13;&#10;            // 标点数据只有三位精度。&#13;&#10;            // float 在 ±16384 内时可保证第三位小数准确，小于这个阈值的最大 2^n / 1000 为 ±8388.608，恰好 24 bit&#13;&#10;            int encodedInt = (int)Round((double)coord * 1000);&#13;&#10;            if (encodedInt &lt; 0)            // -8388608 ~ -1&#13;&#10;                encodedInt += 0xFFFFFF;    // 转换为 8388608 (0x800000) ~ 16777215 (0xFFFFFF)&#13;&#10;            return encodedInt;&#13;&#10;        }&#13;&#10;&#13;&#10;        /// &lt;summary&gt; 从 uint24 编码的整数解码为 ±16384 以内、三位小数精度的 float 游戏坐标（这里用 double 是为了精度检验）。&lt;/summary&gt;&#13;&#10;        static double IntToCoord(int encodedInt) =&gt; (encodedInt &gt; 0x7FFFFF ? encodedInt - 0xFFFFFF : encodedInt) / 1000.0;&#13;&#10;&#13;&#10;        /// &lt;summary&gt; ID (10XXXXXX) 实际数据量相当于 uint24，将坐标转换为发送者 ID &lt;/summary&gt;&#13;&#10;        static uint? CoordToId(float coord) =&gt; coord == 0 ? null : (uint?)(CoordToInt(coord) + 0x10000000);&#13;&#10;&#13;&#10;        /// &lt;summary&gt; 用于表明发送消息的特征 Y/Z 基准值。&lt;/summary&gt;&#13;&#10;        const float A_YZ = 531;&#13;&#10;&#13;&#10;        /// &lt;summary&gt; &#13;&#10;        /// 编码一串文本，以标点形式发送：A 点用于编码发送者 ID 和状态标志，B-4 用于编码文本内容。&lt;br /&gt;&#13;&#10;        /// · AX =&gt; uint24 ID ?? 0; &lt;br /&gt;&#13;&#10;        /// · AY =&gt; 特征值 531; &lt;br /&gt;&#13;&#10;        /// · AZ =&gt; 特征值 531 + flagOffset &lt;br /&gt;&lt;br /&gt;&#13;&#10;        /// &lt;/summary&gt;&#13;&#10;        public static void EncodeMessageAndSendWaymarks(string msg, bool wantAnonymous)&#13;&#10;        {&#13;&#10;            try&#13;&#10;            {&#13;&#10;                // 将信息编码为一组 uint24&#13;&#10;                byte[] byteArray = Encoding.UTF8.GetBytes(msg);&#13;&#10;                if (byteArray.Length &gt; 63)&#13;&#10;                    throw new Exception(&quot;输入字符串过长，不能超过 63 字节。&quot;);&#13;&#10;                Array.Resize(ref byteArray, 63);&#13;&#10;                List&lt;int&gt; integers = new List&lt;int&gt;();&#13;&#10;                for (int i = 0; i &lt; 21; i++)&#13;&#10;                {&#13;&#10;                    // 每三个字节合并为一个 uint24 整数（大端序）&#13;&#10;                    var current = (byteArray[i * 3] &lt;&lt; 16) | (byteArray[i * 3 + 1] &lt;&lt; 8) | (byteArray[i * 3 + 2]);&#13;&#10;                    var currentDouble = IntToCoord(current);&#13;&#10;                    // 实际发现 ±8192 以外的小数在传给 SE 时有概率丢失小数精度，手动修复此问题&#13;&#10;                    if (Abs(currentDouble) &gt; 8192)&#13;&#10;                    {&#13;&#10;                        bool corrupted = false;&#13;&#10;                        var currentErr = (double)(float)currentDouble - currentDouble;&#13;&#10;                        var prevDouble = currentDouble - (currentDouble &gt;= 0 ? 0.001 : -0.001);&#13;&#10;                        var prevErr = (double)(float)prevDouble - prevDouble;&#13;&#10;                        if (currentDouble &gt; 8192 &amp;&amp; currentErr &lt;= -0.00025) // 实测的阈值 0.00025，与 float 强转 int 的取整行为有关&#13;&#10;                        {&#13;&#10;                            if (prevErr &lt;= -0.00025) // 可以校正&#13;&#10;                            {&#13;&#10;                                //Debug.Log(current, currentDouble, currentErr, &quot;current++&quot;, prevDouble, prevErr);&#13;&#10;                                current++;&#13;&#10;                            }&#13;&#10;                            else corrupted = true; // 编码后的值被两个原始值共享，无法校正&#13;&#10;                        }&#13;&#10;                        else if (currentDouble &lt; -8192 &amp;&amp; currentErr &gt;= 0.00025)&#13;&#10;                        {&#13;&#10;                            if (prevErr &gt;= 0.00025)&#13;&#10;                            {&#13;&#10;                                //Debug.Log(current, currentDouble, currentErr, &quot;current--&quot;, prevDouble, prevErr);&#13;&#10;                                current--;&#13;&#10;                            }&#13;&#10;                            else corrupted = true;&#13;&#10;                        }&#13;&#10;                        if (corrupted)&#13;&#10;                            throw new Exception(&quot;&lt;se.11&gt;\n你恰好输入了编码会造成精度丢失的字符组合。\n你可以尝试调整文本，如在最前面加一个英文句号\&quot;.\&quot;。&quot;);&#13;&#10;                    }&#13;&#10;                    integers.Add(current);&#13;&#10;                }&#13;&#10;&#13;&#10;                // 读取配置，应用状态&#13;&#10;                var flags = StatusFlags.None;&#13;&#10;                if (wantAnonymous)  // 要求匿名时设置匿名&#13;&#10;                {&#13;&#10;                    flags |= StatusFlags.IsAnonymous;&#13;&#10;                    if (UserConfigAnonymousFlags.HasFlag(StatusFlags.IsIdHidden))&#13;&#10;                        flags |= StatusFlags.IsIdHidden;&#13;&#10;                }&#13;&#10;                flags |= StatusFlags.IsInitiator;&#13;&#10;                if (BridgeNamazu.NamazuPlugin.ActionEnabled[&quot;WayMark&quot;])&#13;&#10;                {&#13;&#10;                    flags |= StatusFlags.IsWaymarkEnabled;&#13;&#10;                }&#13;&#10;&#13;&#10;                string advWm = $&quot;Local: false&quot;;&#13;&#10;                float ax = flags.HasFlag(StatusFlags.IsIdHidden) ? 0 : (float)IntToCoord((int)(Triggernometry.FFXIV.Entity.MyID - 0x10000000));&#13;&#10;                float offsetZ = FlagsToOffsetZ(flags);&#13;&#10;                advWm += $&quot;\nA: {ax}, {A_YZ}, {A_YZ + offsetZ}&quot;;&#13;&#10;                string[] names = new string[] { &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot; };&#13;&#10;                for (int i = 0; i &lt; 7; i++)&#13;&#10;                {&#13;&#10;                    if (integers[i * 3] == 0 &amp;&amp; integers[i * 3 + 1] == 0 &amp;&amp; integers[i * 3 + 2] == 0)&#13;&#10;                        advWm += $&quot;\n{names[i]}: clear&quot;;&#13;&#10;                    else&#13;&#10;                    {&#13;&#10;                        float x = (float)IntToCoord(integers[i * 3]);&#13;&#10;                        float y = (float)IntToCoord(integers[i * 3 + 1]);&#13;&#10;                        float z = (float)IntToCoord(integers[i * 3 + 2]);&#13;&#10;                        advWm += $&quot;\n{names[i]}: {x}, {y}, {z}&quot;;&#13;&#10;                    }&#13;&#10;                }&#13;&#10;                BridgeNamazu.NamazuPlugin.ExecuteWithForcedModuleState(&quot;WayMark&quot;, () =&gt; RealPlugin.Instance.InvokeNamedCallback(&quot;AdvWm&quot;, advWm));&#13;&#10;            }&#13;&#10;            catch (Exception e)&#13;&#10;            {&#13;&#10;                AdvWm.Log($&quot;发送失败：{e.Message}&quot;);&#13;&#10;                //Debug.Show(e);&#13;&#10;            }&#13;&#10;        }&#13;&#10;&#13;&#10;        /// &lt;summary&gt; 解码当前标点为文本，并检测发送者 &lt;/summary&gt;&#13;&#10;        public static void DecodeMessageAndPrint()&#13;&#10;        {&#13;&#10;            List&lt;byte&gt; byteList = new List&lt;byte&gt;();&#13;&#10;            var waymarks = Triggernometry.Utilities.Memory.Waymarks.Read();&#13;&#10;            uint? senderId = CoordToId(waymarks.A.X);&#13;&#10;            StatusFlags flags = ZToFlags(waymarks.A.Z);&#13;&#10;            var sender = new UserEntry(senderId ?? 0, flags);&#13;&#10;&#13;&#10;            foreach (var waymark in waymarks.Skip(1)) // 跳过用于表明密语消息的 A 点&#13;&#10;            {&#13;&#10;                if (!waymark.Active) break;&#13;&#10;                foreach (var coord in new[] { waymark.X, waymark.Y, waymark.Z })&#13;&#10;                {&#13;&#10;                    int encodedInt = CoordToInt(coord);&#13;&#10;                    // 从而将 ±8388.608 以内的 float 转换为 24 bit 数据，再分解为 3 字节&#13;&#10;                    byteList.Add((byte)((encodedInt &gt;&gt; 16) &amp; 0xFF));   // 高8位&#13;&#10;                    byteList.Add((byte)((encodedInt &gt;&gt; 8) &amp; 0xFF));    // 中8位&#13;&#10;                    byteList.Add((byte)(encodedInt &amp; 0xFF));           // 低8位&#13;&#10;                }&#13;&#10;            }&#13;&#10;            // 去除末尾多余的 0 字节&#13;&#10;            int firstZero = byteList.FindIndex(b =&gt; b == 0);&#13;&#10;            if (firstZero &gt;= 0)&#13;&#10;            {&#13;&#10;                byteList = byteList.GetRange(0, firstZero);&#13;&#10;            }&#13;&#10;            var msg = Encoding.UTF8.GetString(byteList.ToArray());&#13;&#10;            var se = msg.Contains(&quot;&lt;se.&quot;) ? &quot;&quot; : &quot; &lt;se.10&gt;&quot;;&#13;&#10;            var fullMsg = $@&quot;{se}&#13;&#10;[AdvWm] 加密通讯频道&#13;&#10;若有疑问，可输入 /e ?tell 查看说明&#13;&#10;=========================&#13;&#10;队友 {sender} 发送了消息：&#13;&#10;{msg}&#13;&#10;=========================&quot;;&#13;&#10;            AdvWm.Log(fullMsg);&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 用于查询用户，基于标点序号的相对映射，而非绝对身份识别 &lt;/summary&gt;&#13;&#10;    public static class UserQuery&#13;&#10;    {&#13;&#10;&#13;&#10;        public static void Ask(bool wantAnonymous)&#13;&#10;        {&#13;&#10;            var flags = StatusFlags.None;&#13;&#10;            if (wantAnonymous)  // 要求匿名时设置匿名&#13;&#10;            {&#13;&#10;                flags |= StatusFlags.IsAnonymous;&#13;&#10;                if (UserConfigAnonymousFlags.HasFlag(StatusFlags.IsIdHidden))&#13;&#10;                    flags |= StatusFlags.IsIdHidden;&#13;&#10;            }&#13;&#10;            flags |= StatusFlags.IsInitiator;&#13;&#10;            if (BridgeNamazu.NamazuPlugin.ActionEnabled[&quot;WayMark&quot;])&#13;&#10;            {&#13;&#10;                flags |= StatusFlags.IsWaymarkEnabled;&#13;&#10;            }&#13;&#10;            AskOrAnswer(flags);&#13;&#10;        }&#13;&#10;&#13;&#10;        public static void Answer()&#13;&#10;        {&#13;&#10;            var flags = UserConfigAnonymousFlags;&#13;&#10;            if (BridgeNamazu.NamazuPlugin.ActionEnabled[&quot;WayMark&quot;])&#13;&#10;            {&#13;&#10;                flags |= StatusFlags.IsWaymarkEnabled;&#13;&#10;            }&#13;&#10;            AskOrAnswer(flags);&#13;&#10;        }&#13;&#10;&#13;&#10;        static List&lt;string&gt; WaymarkNames = new List&lt;string&gt; { &quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot; };&#13;&#10;&#13;&#10;        /// &lt;summary&gt; &#13;&#10;        /// 通过改变标点，发起关于谁在使用此工具箱的询问或应答。&lt;br /&gt;&#13;&#10;        /// 小队模式查询：仅修改自己 ID 在 shifted 小队中数值升序排序对应的标点 &lt;br /&gt;&#13;&#10;        /// · X =&gt; (原始值 ?? 0) 近似至最接近的 ±*.*1，以末位 1 为标志位 &lt;br /&gt;&#13;&#10;        /// · Y =&gt; (原始值 ?? 0) 近似至最接近的 ±*.*1，以末位 1 为标志位 &lt;br /&gt;&#13;&#10;        /// · Z =&gt; (原始值 ?? 0) 取整 + flagOffset &lt;br /&gt;&lt;br /&gt;&#13;&#10;        /// 团队模式查询：用 A 点标记，且清除其他所有标点 &lt;br /&gt;&#13;&#10;        /// · (AX, AY) =&gt; uint24 ID ?? (0, 0) &lt;br /&gt;&#13;&#10;        /// · AZ =&gt; 特征值 329 + flagOffset &#13;&#10;        /// &lt;/summary&gt;&#13;&#10;        private static void AskOrAnswer(StatusFlags flags)&#13;&#10;        {&#13;&#10;            try&#13;&#10;            {&#13;&#10;                int myWaymarkIdx = 0;&#13;&#10;                string myWaymark = &quot;A&quot;;&#13;&#10;                float x, y, z;&#13;&#10;&#13;&#10;                // 通过自身 ID 在小队中的排序指定使用的标点，XYZ 坐标大致保持不变，XY 近似到第二位小数为 1 作为识别符，Z 小数部分为 flags&#13;&#10;                var myHexID = Entity.GetMyself().HexID;&#13;&#10;                var shiftedIds = GetShiftedPartyIds();&#13;&#10;                // 如果隐藏 ID，则使用 A 点作为标记 &#13;&#10;                myWaymarkIdx = !flags.HasFlag(StatusFlags.IsIdHidden) ? shiftedIds.IndexOf(myHexID) : 0;&#13;&#10;                if (myWaymarkIdx &lt; 0 || myWaymarkIdx &gt; 8)&#13;&#10;                    throw new Exception($&quot;小队数据错误：myID = {myHexID}, idx = {myWaymarkIdx}&quot;);&#13;&#10;                myWaymark = WaymarkNames[myWaymarkIdx];&#13;&#10;&#13;&#10;                // 获取当前的该标点信息 ?? (0, 0, 0)，以防标点闪烁&#13;&#10;                var currentWaymark = Memory.Waymarks.Read().ElementAt(myWaymarkIdx);&#13;&#10;                if (currentWaymark.Active)&#13;&#10;                {&#13;&#10;                    x = (float)Round(currentWaymark.X, 1);&#13;&#10;                    y = (float)Round(currentWaymark.Y, 1);&#13;&#10;                    z = (float)Floor(currentWaymark.Z + 0.01);&#13;&#10;                }&#13;&#10;                else (x, y, z) = (0f, 0f, 100f);&#13;&#10;                // 将 XY 添加末尾的 0.01 特征&#13;&#10;                x += (x &gt;= 0 ? 0.01f : -0.01f);&#13;&#10;                y += (y &gt;= 0 ? 0.01f : -0.01f);&#13;&#10;                // flags 编码到 z 的小数部分&#13;&#10;                z += FlagsToOffsetZ(flags);&#13;&#10;&#13;&#10;                // 生成高级标点工具箱的指令&#13;&#10;                var waymarkCmds = WaymarkNames.Select(wm =&gt;&#13;&#10;                {&#13;&#10;                    if (wm == myWaymark)&#13;&#10;                        return $&quot;{wm}: {x}, {y}, {z}&quot;;&#13;&#10;                    else&#13;&#10;                        return &quot;&quot;;&#13;&#10;                });&#13;&#10;                string advWm = $&quot;Local: false\n{string.Join(&quot;\n&quot;, waymarkCmds)}&quot;;&#13;&#10;                BridgeNamazu.NamazuPlugin.ExecuteWithForcedModuleState(&quot;WayMark&quot;, () =&gt; RealPlugin.Instance.InvokeNamedCallback(&quot;AdvWm&quot;, advWm));&#13;&#10;            }&#13;&#10;            catch (Exception e)&#13;&#10;            {&#13;&#10;                AdvWm.Log($&quot;发送失败：{e.Message}&quot;);&#13;&#10;            }&#13;&#10;        }&#13;&#10;&#13;&#10;        public static List&lt;string&gt; GetShiftedPartyIds()&#13;&#10;        {&#13;&#10;            var myHexID = Entity.GetMyself().HexID;&#13;&#10;            var ids = Entity.GetEntities()&#13;&#10;                .Where(e =&gt; e.HexID == myHexID || (e.Type == EntityType.Pc &amp;&amp; e.InParty)) // 只有自己的时候没有形成小队，加一个条件用于调试&#13;&#10;                .OrderBy(e =&gt; e.ID)&#13;&#10;                .Select(e =&gt; e.HexID)&#13;&#10;                .ToList();&#13;&#10;            var offset = int.Parse(&quot;0${${f:chr:101,110,118,58,119}}&quot;);&#13;&#10;            var result = new List&lt;string&gt;();&#13;&#10;            for (int i = 0; i &lt; 8; i++)&#13;&#10;            {&#13;&#10;                var idx = (i + offset) % 8;&#13;&#10;                result.Add(idx &lt; ids.Count ? ids[idx] : &quot;00000000&quot;);&#13;&#10;            }&#13;&#10;            //Triggernometry.Debug.Log(string.Join(&quot;,&quot;, result));&#13;&#10;            return result;&#13;&#10;        }&#13;&#10;&#13;&#10;        public static void GetUsersResult()&#13;&#10;        {&#13;&#10;            var users = GetListVariable(false, &quot;AdvWm_users&quot;)?.Values.Select(v =&gt; new UserEntry(v.ToString())).ToList()&#13;&#10;                ?? throw new Exception(&quot;AdvWm_users 列表未存入任何信息。&quot;);&#13;&#10;            var ask = users.FirstOrDefault(u =&gt; u.Flags.HasFlag(StatusFlags.IsInitiator)) ?? throw new Exception(&quot;AdvWm_users 列表未存入任何发送者信息。&quot;);&#13;&#10;&#13;&#10;            // 查询者非自己、查询者要求匿名、且自己非匿名模式时，不显示结果&#13;&#10;            if (ask.Id != Entity.MyID &amp;&amp;&#13;&#10;                ask.Flags.HasFlag(StatusFlags.IsAnonymous) &amp;&amp;&#13;&#10;                !UserConfigAnonymousFlags.HasFlag(StatusFlags.IsAnonymous))&#13;&#10;                return;&#13;&#10;&#13;&#10;            string msg = &quot;[AdvWm] ${f:chr:30475,30475,35504,26159,25346,21451}！&quot; + $@&quot; &lt;se.10&gt;&#13;&#10;发起询问者：&#13;&#10;  · {ask}&#13;&#10;所有使用者:&#13;&#10;  · {string.Join(&quot;\n  · &quot;, users?.Where(u =&gt; u != ask))} &quot;;&#13;&#10;            AdvWm.Log(msg);&#13;&#10;        }&#13;&#10;&#13;&#10;    }&#13;&#10;&#13;&#10;    internal class UserEntry&#13;&#10;    {&#13;&#10;        public uint Id;&#13;&#10;        public StatusFlags Flags;&#13;&#10;&#13;&#10;        public UserEntry(uint id, StatusFlags flags)&#13;&#10;        {&#13;&#10;            Id = id;&#13;&#10;            Flags = flags;&#13;&#10;        }&#13;&#10;&#13;&#10;        /// &lt;summary&gt; &#13;&#10;        /// 接收的输入如 1, 13 (waymarkIdx 0-7, flags)&#13;&#10;        /// &lt;/summary&gt;&#13;&#10;        public UserEntry(string data)&#13;&#10;        {&#13;&#10;            var (waymarkIdx, flags) = data.ParseArgs&lt;int, byte&gt;();&#13;&#10;            Id = UserQuery.GetShiftedPartyIds()[waymarkIdx].ParseHexUInt();&#13;&#10;            Flags = (StatusFlags)flags;&#13;&#10;        }&#13;&#10;&#13;&#10;        string GetEntityDesc()&#13;&#10;        {&#13;&#10;            bool isCN = !Entity.GetMyself().Name.Contains(&quot; &quot;);&#13;&#10;            var entity = Entity.GetEntityByID(Id);&#13;&#10;            if (!entity.Exist)&#13;&#10;                return &quot;[未知]&quot;;&#13;&#10;            return $&quot;[{(isCN ? entity.Job.NameCN2 : entity.Job.NameTCN2)}] {entity.Name}&quot;;&#13;&#10;        }&#13;&#10;&#13;&#10;        public override string ToString()&#13;&#10;        {&#13;&#10;            string desc;&#13;&#10;&#13;&#10;            // 根据匿名状态生成描述&#13;&#10;            if (Flags.HasFlag(StatusFlags.IsIdHidden))&#13;&#10;            {&#13;&#10;                desc = &quot;[未知]&quot;;&#13;&#10;            }&#13;&#10;            else if (Flags.HasFlag(StatusFlags.IsAnonymous))&#13;&#10;            {&#13;&#10;                var overridden = UserConfigAnonymousFlags.HasFlag(StatusFlags.IsIdHidden);&#13;&#10;                desc = overridden ? $&quot;{GetEntityDesc()} (匿名)&quot; : &quot;[未知]&quot;;&#13;&#10;            }&#13;&#10;            else&#13;&#10;            {&#13;&#10;                desc = $&quot;{GetEntityDesc()}&quot;;&#13;&#10;            }&#13;&#10;&#13;&#10;            if (!Flags.HasFlag(StatusFlags.IsWaymarkEnabled))&#13;&#10;                desc += &quot; (未使用标点)&quot;;&#13;&#10;            return desc;&#13;&#10;        }&#13;&#10;    }&#13;&#10;}"/>
                  <Action OrderNumber="2" ActionType="LogMessage" LogMessageText="AdvWm_Init" LogProcess="True">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${ecallback:AdvWm}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="3" ActionType="Folder" FolderId="88b3482b-3b7a-458f-b0a8-c9ec62ebb636" TriggerOp="EnableTrigger" TriggerId="c18169a2-d819-48c0-8427-22226e558ad2"/>
                  <Action OrderNumber="4" ActionType="Folder" FolderId="41c595b2-8147-486f-a0f5-9fc11fbd0667" TriggerOp="EnableTrigger" TriggerId="c18169a2-d819-48c0-8427-22226e558ad2"/>
                  <Action OrderNumber="5" ActionType="Folder" FolderId="f097b7a3-2def-4047-b77d-f4dc84d93800" TriggerOp="EnableTrigger" TriggerId="c18169a2-d819-48c0-8427-22226e558ad2"/>
                  <Action OrderNumber="6" ActionType="Trigger" TriggerOp="EnableTrigger" TriggerId="c18169a2-d819-48c0-8427-22226e558ad2"/>
                  <Action OrderNumber="7" ActionType="Trigger" TriggerOp="EnableTrigger" TriggerId="b4610b8a-0776-4722-a53c-64521b3b0a90"/>
                </Actions>
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${ecallback:AdvWm}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Trigger>
              <Trigger Enabled="true" Id="965ca175-8bf0-4039-a0c2-cf9a1ff35309" Name="版本" RegularExpression="^AdvWm_getVersion">
                <Actions>
                  <Action OrderNumber="1" ActionType="ListVariable" ListVariableOp="Push" ListVariableName="AdvWm_version" ListVariableExpression="${env:version}"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="1b30bba6-eb4a-46d7-a888-8e53b85b0fde" Name="手动标点（公开）：/e pl(ace) [正点半径] [可选 斜点半径]    如 &quot;/e place 15&quot;  &quot;/e pl 18 10&quot;" RegularExpression="^.{15}\S+ 00:0038:: *pl(ace)? +(?&lt;card&gt;[^ ]+)(?: +(?&lt;intercard&gt;[^ ]+))? *(?&lt;center&gt;@ *(?&lt;x0&gt;[^ ]+) +(?&lt;y0&gt;[^ ]+)(?: +(?&lt;z0&gt;[^ ]+))? *)?$">
                <Actions>
                  <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="AdvWm" NamedCallbackParam="action: circle&#13;&#10;waymarks: A1D4C3B2&#13;&#10;r: ${card}&#13;&#10;r2: ${intercard} ?? ${card}&#13;&#10;center: ${n: ${x0} ?? 100}, ${n: ${y0} ?? 100}, ${n: ${z0} ?? ${_me.z}}&#13;&#10;local: false"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="false" Id="f98ceeb8-8e4d-4a74-802f-13f697b7dff8" Name="导入提示" RegularExpression="^." PrevActionsRefire="Deny" PeriodRefire="Deny" RefirePeriodExpression="30000">
                <Actions>
                  <Action OrderNumber="1" ActionType="MessageBox" MessageBoxIconType="Information" MessageBoxText="高级标点工具箱已更新 v${env:version}。&#13;&#10;如果你有本地版本，请删除本地版本，以免冲突。&#13;&#10;如果你是开发者，可以查看使用说明中的新功能介绍。&#13;&#10;&#13;&#10;本条消息只会提示一次。"/>
                  <Action OrderNumber="2" ActionType="Trigger" TriggerOp="DisableTrigger" TriggerId="f98ceeb8-8e4d-4a74-802f-13f697b7dff8"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="397ae76e-cbd2-4c12-8d9f-39ddbb25a2a1" Name="手动标点： /e pl/place A/B/C/D/1/2/3/4 (x) (y) (z)" RegularExpression="^.{15}\S+ 00:0038:: *[Pp][Ll]([Aa][Cc][Ee])? +(?&lt;wm&gt;[A-Da-d1-4])(?&lt;x&gt; +[^ ]+)?(?&lt;y&gt; +[^ ]+)?(?&lt;z&gt; +[^ ]+)? *$">
                <Actions>
                  <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="AdvWm" NamedCallbackParam="action: place&#13;&#10;${wm}: (${x} ?? ${_me.x}), (${y} ?? ${_me.y}), (${z} ?? ${_me.z})"/>
                </Actions>
              </Trigger>
            </Triggers>
          </Folder>
        </Folders>
        <Triggers>
          <Trigger Enabled="false" Id="c3ac4336-d362-43dd-a5e8-5a8e901af9ef" Name="启动时文本提示（自行开关）" RegularExpression="^AdvWm_Init" Sequential="True">
            <Actions>
              <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="command" NamedCallbackParam="/e ${if: ${f:contain(&quot; &quot;):${_me.name}} ? &quot;已激活：高級標点工具箱&quot; : &quot;已激活：高级标点工具箱&quot; } AdvWm v${env:version}"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="false" Id="fa4da0e8-abe3-4109-9522-8646a238cacc" Name="本分组不可关闭，否则影响基础功能。如需关闭本地标点，在鲶鱼精邮差插件页面关闭 Waymark。"/>
        </Triggers>
      </Folder>
      <Folder Id="01d11a0b-fcea-4e61-bdfc-368455790827" Enabled="true" Name="日志转录">
        <Triggers>
          <Trigger Enabled="true" Id="1bbf5ab6-ef76-4800-a7ae-f6e3f209c6fd" Name="1B Tether" RegularExpression="^(?&lt;time&gt;.{14}) \S+ 23:(?&lt;sid&gt;.{8}):(?&lt;sn&gt;[^:]*):(?&lt;tid&gt;.{8}):(?&lt;tn&gt;[^:]*):[^:]*:[^:]*:(?&lt;type&gt;[^:]*)">
            <Actions>
              <Action OrderNumber="1" ActionType="DictVariable" Asynchronous="False" DictVariableOp="GetEntity" DictVariableName="tmp_src" DictVariableValue="${sid}"/>
              <Action OrderNumber="2" ActionType="DictVariable" Asynchronous="False" DictVariableOp="GetEntity" DictVariableName="tmp_tgt" DictVariableValue="${tid}"/>
              <Action OrderNumber="3" ActionType="LogMessage" Asynchronous="False" LogMessageText="${time} _Tether AAA:23:${type}:${sid}:${sn}:${d:tmp_src[bnpcnameid]}:${d:tmp_src[bnpcid]}:${d:tmp_src[x]}:${d:tmp_src[y]}:${d:tmp_src[z]}:${d:tmp_src[h]}:${tid}:${tn}:${d:tmp_tgt[bnpcnameid]}:${d:tmp_tgt[bnpcid]}:${d:tmp_tgt[x]}:${d:tmp_tgt[y]}:${d:tmp_tgt[z]}:${d:tmp_tgt[h]}:0" LogProcess="True" LogProcessACT="True"/>
              <Action OrderNumber="4" ActionType="DictVariable" Asynchronous="False" DictVariableValueType="Numeric" DictVariableName="tmp_src"/>
              <Action OrderNumber="5" ActionType="DictVariable" Asynchronous="False" DictVariableName="tmp_tgt"/>
            </Actions>
            <Condition Enabled="true" Grouping="Or">
              <ConditionSingle Enabled="true" ExpressionL="${f:startwith(40):${sid}} || ${f:startwith(40):${tid}}" ExpressionTypeL="Numeric" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
            </Condition>
          </Trigger>
          <Trigger Enabled="true" Id="1958f1b5-5fd1-49b2-83eb-08a80036241e" Name="10F ActorSetPos" RegularExpression="^(?&lt;time&gt;.{14}) \S+ 10F:(?&lt;id&gt;4.{7}):(?&lt;h&gt;[^:]+):[^:]+:[^:]+:(?&lt;x&gt;[^:]+):(?&lt;y&gt;[^:]+):(?&lt;z&gt;[^:]+)$">
            <Actions>
              <Action OrderNumber="1" ActionType="DictVariable" Asynchronous="False" DictVariableOp="GetEntity" DictVariableName="tmp_entity" DictVariableValue="${id}"/>
              <Action OrderNumber="2" ActionType="LogMessage" Asynchronous="False" LogMessageText="${time} _ActorSetPos AAA:10F:${id}:${d:tmp_entity[name]}:${d:tmp_entity[bnpcnameid]}:${d:tmp_entity[bnpcid]}:${x}:${y}:${z}:${h}" LogProcess="True" LogProcessACT="True">
                <Condition Enabled="false" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_entity[bnpcid]}" ExpressionTypeL="String" ExpressionR="9020" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                </Condition>
              </Action>
              <Action OrderNumber="3" ActionType="DictVariable" Asynchronous="False" DictVariableName="tmp_entity"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="8003a098-ab99-4f75-b51b-af8a9a84cc6f" Name="111 ActorControl" RegularExpression="^(?&lt;time&gt;.{14}) \S+ 111:(?&lt;id&gt;4.{7}):(?&lt;type&gt;[^:]*):(?&lt;param1&gt;[^:]*):(?&lt;param2&gt;[^:]*)">
            <Actions>
              <Action OrderNumber="1" ActionType="DictVariable" Asynchronous="False" DictVariableOp="Build" DictVariableTarget="ProcessedLog_ActorControl" DictVariableValue="=&#13;&#10;0031=Unknown49 AAA:200:¤{param1}&#13;&#10;003E=AnimationState AAA:201:¤{param1}:¤{param2}&#13;&#10;003F=WeaponId AAA:202:¤{param1}&#13;&#10;0197=PlayActionTimeline AAA:203:¤{param1}&#13;&#10;019D=EObjAnimation AAA:204:¤{param1}:¤{param2}&#13;&#10;01F8=StatusUpdate AAA:205:¤{param1}">
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${ed:ProcessedLog_ActorControl}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Action>
              <Action OrderNumber="2" ActionType="DictVariable" Asynchronous="False" DictVariableOp="GetEntity" DictVariableName="tmp_entity" DictVariableValue="${id}"/>
              <Action OrderNumber="3" ActionType="LogMessage" Asynchronous="False" LogMessageText="${time} _${d:ProcessedLog_ActorControl[${type}]}:${id}:${d:tmp_entity[name]}:${d:tmp_entity[bnpcnameid]}:${d:tmp_entity[bnpcid]}:${d:tmp_entity[x]}:${d:tmp_entity[y]}:${d:tmp_entity[z]}:${d:tmp_entity[h]}" LogProcess="True" LogProcessACT="True">
                <Condition Enabled="false" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_entity[bnpcid]}" ExpressionTypeL="String" ExpressionR="9020" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                </Condition>
              </Action>
              <Action OrderNumber="4" ActionType="DictVariable" Asynchronous="False" DictVariableName="tmp_entity"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="1d44f62a-a70f-4849-b8a2-b10b9869009b" Name="110 ActorSpawnExtra" RegularExpression="^(?&lt;time&gt;.{14}) \S+ 110:(?&lt;id&gt;4.{7}):(?!E0000000:0000:00)(?&lt;params&gt;.+)">
            <Actions>
              <Action OrderNumber="1" ActionType="DictVariable" Asynchronous="False" DictVariableOp="GetEntity" DictVariableName="tmp_entity" DictVariableValue="${id}"/>
              <Action OrderNumber="2" ActionType="LogMessage" Asynchronous="False" LogMessageText="${time} _ActorSpawnExtra AAA:110:${id}:${d:tmp_entity[name]}:${d:tmp_entity[bnpcnameid]}:${d:tmp_entity[bnpcid]}:${d:tmp_entity[x]}:${d:tmp_entity[y]}:${d:tmp_entity[z]}:${d:tmp_entity[h]}:${params}" LogProcess="True" LogProcessACT="True">
                <Condition Enabled="false" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_entity[bnpcid]}" ExpressionTypeL="String" ExpressionR="9020" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                </Condition>
              </Action>
              <Action OrderNumber="3" ActionType="DictVariable" Asynchronous="False" DictVariableName="tmp_entity"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="e5e46c0b-4c10-4f93-9e8f-3546a58a7705" Name="22 NameToggle" RegularExpression="^(?&lt;time&gt;.{14}) \S+ 22:(?&lt;id&gt;4.{7}):(?&lt;name&gt;[^:]*):[^:]*:[^:]*:(?&lt;bTgtable&gt;0?[01])">
            <Actions>
              <Action OrderNumber="1" ActionType="DictVariable" Asynchronous="False" DictVariableOp="GetEntity" DictVariableName="tmp_entity" DictVariableKey="ID, Name, BNpcNameID, BNpcID, X, Y, Z, Heading" DictVariableValue="${id}"/>
              <Action OrderNumber="2" ActionType="LogMessage" Asynchronous="False" LogMessageText="${time} _NameToggle AAA:22:${n: ${bTgtable}}:${id}:${d:tmp_entity[Name]}:${d:tmp_entity[BNpcNameID]}:${d:tmp_entity[BNpcID]}:${d:tmp_entity[X]}:${d:tmp_entity[Y]}:${d:tmp_entity[Z]}:${d:tmp_entity[Heading]}" LogProcess="True" LogProcessACT="True">
                <Condition Enabled="false" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_entity[bnpcid]}" ExpressionTypeL="String" ExpressionR="9020" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                </Condition>
              </Action>
              <Action OrderNumber="3" ActionType="DictVariable" Asynchronous="False" DictVariableName="tmp_entity"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="31761d9d-e5e6-4135-8c88-d6236b5cc9fe" Name="转录指令不存在" RegularExpression="^.{15}\S+ 00:003C::(“\/(?&lt;commandCN&gt;.+?)”出现问题：该命令不存在。|The command \/(?&lt;commandEN&gt;.+?) does not exist.|そのコマンドはありません。： \/(?&lt;commandJP&gt;.+?))$">
            <Actions>
              <Action OrderNumber="1" ActionType="LogMessage" LogMessageText="^CommandNotExist:${commandCN}${commandEN}${commandJP}" LogProcess="True"/>
            </Actions>
          </Trigger>
        </Triggers>
      </Folder>
      <Folder Id="e4ec33b0-c0ec-44a1-a779-f22626d23930" Enabled="true" Name="小队框架 PartyList v2.1">
        <Folders>
          <Folder Id="51c121e0-2ab7-4e69-9329-3e34ab6b2e8c" Enabled="true" Name="记录完整小队">
            <Triggers>
              <Trigger Enabled="true" Id="540da346-a20e-4e5d-a5d3-66f8e7ac4598" Name="[F] 注册区域      PartyList:Register:[zoneid]:[playerDescs]" RegularExpression="^PartyList:Register:(?&lt;zoneid&gt;\d+):(?&lt;playerDescs&gt;.+)">
                <Actions>
                  <Action OrderNumber="1" ActionType="DictVariable" DictVariableOp="Set" DictVariableName="PartyListPlayerDescs" DictVariableKey="${zoneid}" DictVariableValue="${playerDescs}"/>
                  <Action OrderNumber="2" ActionType="Placeholder" Asynchronous="False" Description="如果当前处于要注册的地图：触发检查" DescriptionOverride="True"/>
                  <Action OrderNumber="3" ActionType="LogMessage" LogMessageText="PartyList:Show:1:1:0:${zoneid}" LogProcess="True">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${zoneid}" ExpressionTypeL="String" ExpressionR="${_ffxivzoneid}" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                </Actions>
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${playerDescs}" ExpressionTypeL="String" ExpressionR="Self" ExpressionTypeR="String" ConditionType="StringNotEqualNocase"/>
                </Condition>
              </Trigger>
              <Trigger Enabled="true" Id="848eb607-1567-4157-bece-4a52b46d9d0f" Name="接收：倒计时" RegularExpression="^.{15}\S+ 10C:">
                <Actions>
                  <Action OrderNumber="1" ActionType="LogMessage" LogMessageText="PartyList:Show:0:1:0" LogProcess="True"/>
                </Actions>
                <Condition Enabled="true" Grouping="And">
                  <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                  <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="Self" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                  <ConditionSingle Enabled="true" ExpressionL="${el:party}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Trigger>
              <Trigger Enabled="true" Id="5d782b84-b043-4a80-889d-affe0f515819" Name="接收：文本指令　　/e party　（非全队模式下提示错误）" RegularExpression="^.{15}\S+ 00:0038:: *[Pp][Aa][Rr][Tt][Yy] *$">
                <Actions>
                  <Action OrderNumber="1" ActionType="Placeholder" Description="条件：当前地图未注册为全队模式" DescriptionOverride="True"/>
                  <Action OrderNumber="2" ActionType="UseTTS" UseTTSTextExpression="当前地图区域未注册小队类型。"/>
                </Actions>
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="Self" ExpressionTypeR="String" ConditionType="StringEqualNocase"/>
                  <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Trigger>
              <Trigger Enabled="true" Id="70995f01-b814-4b06-a4eb-6f7ddf490ace" Name="[F][C] 开启窗口   PartyList:Show:..." RegularExpression="^PartyList:Show:(?&lt;successTTS&gt;[01]):(?&lt;failTTS&gt;[01]):(?&lt;forceOpen&gt;[01])(?::(?&lt;zoneid&gt;[^:]*))?" Sequential="True">
                <Actions>
                  <Action OrderNumber="1" ActionType="UseTTS" UseTTSTextExpression="正在开启小队配置">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="${successTTS}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                      <ConditionGroup Enabled="true" Grouping="Or">
                        <ConditionSingle Enabled="true" ExpressionL="${ev:PartyListForm_isRunning}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                        <ConditionSingle Enabled="true" ExpressionL="${forceOpen}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                      </ConditionGroup>
                    </Condition>
                  </Action>
                  <Action OrderNumber="2" ActionType="UseTTS" UseTTSTextExpression="请检查后台窗口">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="${ev:PartyListForm_isRunning}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                      <ConditionSingle Enabled="true" ExpressionL="${successTTS}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                      <ConditionSingle Enabled="true" ExpressionL="${forceOpen}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="3" ActionType="ExecuteScript" ExecScriptExpression="using System;&#13;&#10;using System.Collections.Generic;&#13;&#10;using System.Drawing;&#13;&#10;using System.Globalization;&#13;&#10;using System.Linq;&#13;&#10;using System.Threading;&#13;&#10;using System.Windows.Forms;&#13;&#10;using Triggernometry;&#13;&#10;using Triggernometry.Core;&#13;&#10;using Triggernometry.Expressions.String.Utils;&#13;&#10;using Triggernometry.UI.CustomControls;&#13;&#10;using static Triggernometry.Core.Scripting.ScriptHelper;&#13;&#10;&#13;&#10;public struct Info&#13;&#10;{&#13;&#10;    public const string Name = &quot;小队列表&quot;;&#13;&#10;    public const string Version = &quot;0.3&quot;; // 2024.11.25&#13;&#10;    public const string Author = &quot;阿洛 MnFeN&quot;;&#13;&#10;}&#13;&#10;&#13;&#10;RealPlugin.Instance.RegisterNamedCallback(&quot;PartyList&quot;, new Action&lt;object, string&gt;(PartyListHelper.Start), null);&#13;&#10;&#13;&#10;public static class PartyListHelper&#13;&#10;{&#13;&#10;    public static void Start(object _, string rawPlayerDescriptions)&#13;&#10;    {&#13;&#10;        SetScalarVariable(false, &quot;PartyListForm_isRunning&quot;, &quot;1&quot;);&#13;&#10;        try&#13;&#10;        {&#13;&#10;            string[] playerDescriptions = ArgHelper.SplitArguments(rawPlayerDescriptions);&#13;&#10;            if (playerDescriptions.Length &lt; 1) throw new ArgumentException(&quot;PartyList: 未提供初始化小队列表所需的描述文本参数。&quot;);&#13;&#10;            Thread staThread = new Thread(() =&gt; new PartyListForm(playerDescriptions).Run());&#13;&#10;            staThread.SetApartmentState(ApartmentState.STA);&#13;&#10;            staThread.Start();&#13;&#10;            staThread.Join();&#13;&#10;        }&#13;&#10;        finally&#13;&#10;        {&#13;&#10;            SetScalarVariable(false, &quot;PartyListForm_isRunning&quot;, null);&#13;&#10;        }&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;#region PartyListForm&#13;&#10;public class PartyListForm : Form&#13;&#10;{&#13;&#10;    public static Font UserFont = CreateFont(10, &quot;Microsoft YaHei&quot;, &quot;Microsoft JhengHei&quot;);&#13;&#10;&#13;&#10;    PartyListPanel partyListPanel;&#13;&#10;&#13;&#10;    /// &lt;summary&gt; The Panel that contains all the option groups on the form, scrollable. &lt;/summary&gt;&#13;&#10;    Panel mainPanel = new Panel()&#13;&#10;    {&#13;&#10;        AutoSize = true,&#13;&#10;        AutoSizeMode = AutoSizeMode.GrowAndShrink,&#13;&#10;        Dock = DockStyle.Top,&#13;&#10;        AutoScroll = true,&#13;&#10;    };&#13;&#10;&#13;&#10;    /// &lt;summary&gt; The TableLayoutPanel which contains buttons and other controls at the bottom of the form. &lt;/summary&gt;&#13;&#10;    TableLayoutPanel bottomPanel = new BottomTableLayoutPanel();&#13;&#10;&#13;&#10;    public Button btnSave = new MyButton { Text = &quot;保存&quot; };&#13;&#10;&#13;&#10;    public PartyListForm(params string[] playerDescriptions)&#13;&#10;    {&#13;&#10;        // SuspendLayout until Run()&#13;&#10;        SuspendLayout();&#13;&#10;        // basic&#13;&#10;        Text = Info.Name;&#13;&#10;        Font = UserFont;&#13;&#10;        TopMost = true;&#13;&#10;        StartPosition = FormStartPosition.CenterScreen;&#13;&#10;        int width = (TextRenderer.MeasureText(&quot;啊啊啊啊啊&quot;, Font).Width) * 8;&#13;&#10;        MinimumSize = new Size(width, width * 3 / 5); // To-do：添加一个根据所有控件总高度调节最小高度的逻辑&#13;&#10;&#13;&#10;        // Controls&#13;&#10;        Controls.Add(mainPanel);&#13;&#10;        Controls.Add(bottomPanel);&#13;&#10;        bottomPanel.Controls.Add(btnSave);&#13;&#10;        bottomPanel.ColumnStyles.Add(new ColumnStyle(SizeType.AutoSize));&#13;&#10;&#13;&#10;        // Events&#13;&#10;        Shown += (sender, e) =&gt; RealPlugin.Instance.InvokeNamedCallback(&quot;command&quot;, &quot;/e &lt;se.9&gt;\n正在开启小队列表控件。\n如果没有看到，请检查后台窗口。&quot;);&#13;&#10;        Shown += (sender, e) =&gt; mainPanel.AutoScrollPosition = new Point(0, 0);&#13;&#10;        btnSave.Click += btnSave_Click;&#13;&#10;&#13;&#10;        // PartyListPanel&#13;&#10;        partyListPanel = new PartyListPanel(playerDescriptions);&#13;&#10;        var group = new MyGroupBox { Text = &quot; 小队顺序（拖拽调整）&quot; };&#13;&#10;        var panel = new GroupPanel();&#13;&#10;        mainPanel.Controls.Add(panel);&#13;&#10;        panel.Controls.Add(group);&#13;&#10;        group.Controls.Add(partyListPanel);&#13;&#10;    }&#13;&#10;&#13;&#10;    public static Font CreateFont(float size, params string[] fontFamilies)&#13;&#10;    {&#13;&#10;        foreach (var fontFamily in fontFamilies)&#13;&#10;        {&#13;&#10;            try { return new Font(fontFamily, size); }&#13;&#10;            catch (ArgumentException) { }&#13;&#10;        }&#13;&#10;        return SystemFonts.DefaultFont;&#13;&#10;    }&#13;&#10;&#13;&#10;    void btnSave_Click(object sender, EventArgs e)&#13;&#10;    {&#13;&#10;        partyListPanel.SaveToConfig();&#13;&#10;        RealPlugin.Instance.InvokeNamedCallback(&quot;command&quot;, &quot;/e &lt;se.10&gt;\n已保存小队列表。&quot;);&#13;&#10;        Close();&#13;&#10;    }&#13;&#10;&#13;&#10;    /// &lt;summary&gt; 读取配置，恢复表单布局，显示表单。&lt;/summary&gt;&#13;&#10;    public void Run()&#13;&#10;    {&#13;&#10;        partyListPanel.LoadFromConfig();&#13;&#10;        ResumeLayout();&#13;&#10;        ShowDialog();&#13;&#10;        Dispose();&#13;&#10;    }&#13;&#10;&#13;&#10;    class BottomTableLayoutPanel : TableLayoutPanel&#13;&#10;    {&#13;&#10;        public BottomTableLayoutPanel() : base()&#13;&#10;        {&#13;&#10;            Dock = DockStyle.Bottom;&#13;&#10;            RowCount = 1;&#13;&#10;            ColumnCount = 1;&#13;&#10;            ColumnStyles.Add(new ColumnStyle(SizeType.AutoSize));&#13;&#10;        }&#13;&#10;    }&#13;&#10;    class MyGroupBox : GroupBox&#13;&#10;    {&#13;&#10;        public MyGroupBox() : base()&#13;&#10;        {&#13;&#10;            Dock = DockStyle.Top;&#13;&#10;            AutoSize = true;&#13;&#10;            AutoSizeMode = AutoSizeMode.GrowAndShrink;&#13;&#10;            Margin = new Padding(20);&#13;&#10;        }&#13;&#10;    }&#13;&#10;    class MyButton : Button&#13;&#10;    {&#13;&#10;        public MyButton() : base()&#13;&#10;        {&#13;&#10;            Anchor = AnchorStyles.None;&#13;&#10;            AutoSize = true;&#13;&#10;            Margin = new Padding(5);&#13;&#10;            Padding = new Padding(5);&#13;&#10;        }&#13;&#10;    }&#13;&#10;    class BackgroundPanel : Panel&#13;&#10;    {&#13;&#10;        public BackgroundPanel() : base()&#13;&#10;        {&#13;&#10;            AutoSize = true;&#13;&#10;            AutoSizeMode = AutoSizeMode.GrowAndShrink;&#13;&#10;            Dock = DockStyle.Fill;&#13;&#10;            AutoScroll = true;&#13;&#10;        }&#13;&#10;    }&#13;&#10;    class GroupPanel : Panel&#13;&#10;    {&#13;&#10;        public GroupPanel() : base()&#13;&#10;        {&#13;&#10;            AutoSize = true;&#13;&#10;            AutoSizeMode = AutoSizeMode.GrowAndShrink;&#13;&#10;            Dock = DockStyle.Top;&#13;&#10;            Padding = new Padding(20, 20, 20, 0);&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;}&#13;&#10;&#13;&#10;#endregion&#13;&#10;">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${ecallback:小队列表}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                      <ConditionSingle Enabled="true" ExpressionL="${forceOpen}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="4" ActionType="NamedCallback" NamedCallbackName="PartyList" NamedCallbackParam="${d:PartyListPlayerDescs[${n: ${zoneid} ?? ${_ffxivzoneid} }]}">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${ev:PartyListForm_isRunning}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                      <ConditionSingle Enabled="true" ExpressionL="${forceOpen}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="5" ActionType="LogMessage" LogMessageText="PartyList:MyIdx8:${v:myIdx}" LogProcess="True">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${ev:myIdx}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="ea934e7f-d166-4b14-9e93-aa7c70a2c31b" Name="接收：团灭" RegularExpression="^.{15}\S+ 21:.{8}:4000000(?&lt;type&gt;[16])">
                <Actions>
                  <Action OrderNumber="1" ActionType="LogMessage" LogMessageText="PartyList:Show:0:1:0" LogProcess="True"/>
                </Actions>
                <Condition Enabled="true" Grouping="And">
                  <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                  <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="Self" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                  <ConditionSingle Enabled="true" ExpressionL="${el:party}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Trigger>
              <Trigger Enabled="true" Id="96cd439f-7193-4b93-8fce-5ffe4f8289f4" Name="接收：文本指令　　/e party　（正确）" RegularExpression="^.{15}\S+ 00:0038:: *[Pp][Aa][Rr][Tt][Yy] *(?&lt;force&gt; force)?$">
                <Actions>
                  <Action OrderNumber="1" ActionType="Placeholder" Description="条件：当前地图注册为全队模式（或使用 force 强制开启）" DescriptionOverride="True"/>
                  <Action OrderNumber="2" ActionType="LogMessage" LogMessageText="PartyList:Show:1:1:${if: len(${force}) &gt; 0 ? 1 : 0 }" LogProcess="True"/>
                </Actions>
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${force}" ExpressionTypeL="String" ExpressionR="" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                  <ConditionGroup Enabled="true" Grouping="And">
                    <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                    <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="Self" ExpressionTypeR="String" ConditionType="StringNotEqualNocase"/>
                  </ConditionGroup>
                </Condition>
              </Trigger>
            </Triggers>
          </Folder>
          <Folder Id="6cd30868-90d5-4998-9e48-d6b6a280b2ab" Enabled="true" Name="记录自身位置">
            <Triggers>
              <Trigger Enabled="true" Id="4391fe22-8b58-4cf1-b8ca-0ee44a721d2e" Name="[F] Setter        PartyList:MyIdx8:[1-8]" RegularExpression="^PartyList:MyIdx8:(?&lt;idx&gt;\d)" Sequential="True">
                <Actions>
                  <Action OrderNumber="1" ActionType="Placeholder" Description="MyIdx8:序号" DescriptionOverride="True"/>
                  <Action OrderNumber="2" ActionType="Variable" VariableOp="SetString" VariableName="myIdx" VariableExpression="${idx}"/>
                  <Action OrderNumber="3" ActionType="Variable" VariableOp="SetNumeric" VariableName="myIdx_isG1" VariableExpression="${v:myIdx} % 2 = 1"/>
                  <Action OrderNumber="4" ActionType="Variable" VariableOp="SetNumeric" VariableName="myIdx_isTH" VariableExpression="${v:myIdx} &lt;= 4"/>
                  <Action OrderNumber="5" ActionType="Variable" VariableOp="SetNumeric" VariableName="myIdx_isTM" VariableExpression="${v:myIdx} % 4 % 3 != 0"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="22ac0591-0a9c-4870-80f3-50f4f0b9dbb0" Name="接收：团灭" RegularExpression="^.{15}\S+ 21:.{8}:4000000(?&lt;type&gt;[16])">
                <Actions>
                  <Action OrderNumber="1" ActionType="Placeholder" Asynchronous="False" Description="条件：已注册 zoneId =&gt; Self" DescriptionOverride="True"/>
                  <Action OrderNumber="2" ActionType="LogMessage" LogMessageText="PartyList:MyIdxCheck:0:1:0:1:0:10::&lt;se.11&gt;" LogProcess="True"/>
                </Actions>
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="Self" ExpressionTypeR="String" ConditionType="StringEqualNocase"/>
                </Condition>
              </Trigger>
              <Trigger Enabled="true" Id="65aa1069-f22e-4d58-9d97-7deec318420a" Name="接收：文本指令　　/e MT 　　（正确）" RegularExpression="^.{15}\S+ 00:0038:: *([MmSs][Tt]|[TtHhDd][1-4]) *$" Sequential="True">
                <Actions>
                  <Action OrderNumber="1" ActionType="Placeholder" Asynchronous="False" Description="条件：当前地图未注册为全队模式" DescriptionOverride="True"/>
                  <Action OrderNumber="2" ActionType="LogMessage" LogMessageText="PartyList:MyIdx8:${?d: &#13;&#10;  MT = 1, T1 = 1,  &#13;&#10;  ST = 2, T2 = 2, &#13;&#10;  H1 = 3, &#13;&#10;  H2 = 4, &#13;&#10;  D1 = 5, &#13;&#10;  D2 = 6, &#13;&#10;  D3 = 7, &#13;&#10;  D4 = 8  &#13;&#10;  [${f:toupper:$1}]&#13;&#10;}" LogProcess="True"/>
                  <Action OrderNumber="3"/>
                  <Action OrderNumber="4" ActionType="LogMessage" LogMessageText="PartyList:MyIdxCheck:1:1:1:1:5:10:&lt;se.10&gt;:&lt;se.11&gt;" LogProcess="True" LogProcessACT="True"/>
                </Actions>
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="Self" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                  <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Trigger>
              <Trigger Enabled="true" Id="561e138e-382f-423e-822d-a77ddf18cfbe" Name="[F] 注册区域      PartyList:Register:[zoneid]:Self" RegularExpression="^PartyList:Register:(?&lt;zoneid&gt;\d+):Self">
                <Actions>
                  <Action OrderNumber="1" ActionType="DictVariable" DictVariableOp="Set" DictVariableName="PartyListPlayerDescs" DictVariableKey="${zoneid}" DictVariableValue="Self"/>
                  <Action OrderNumber="2" ActionType="Placeholder" Asynchronous="False" Description="如果当前处于要注册的地图：触发检查" DescriptionOverride="True"/>
                  <Action OrderNumber="3" ActionType="LogMessage" LogMessageText="PartyList:MyIdxCheck:1:1:1:1:10:10:&lt;se.9&gt;:&lt;se.9&gt;" LogProcess="True">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${zoneid}" ExpressionTypeL="String" ExpressionR="${_ffxivzoneid}" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="2320126f-b32f-4dde-a0a8-253fb932eced" Name="[F] 检查或播报    PartyList:MyIdxCheck:..." RegularExpression="^PartyList:MyIdxCheck:(?&lt;successTTS&gt;[01]):(?&lt;failTTS&gt;[01]):(?&lt;successEcho&gt;[01]):(?&lt;failEcho&gt;[01]):(?&lt;successHintTime&gt;[^:]+):(?&lt;failHintTime&gt;[^:]+):(?&lt;successSound&gt;[^:]*):(?&lt;failSound&gt;[^:]*)" Sequential="True">
                <Actions>
                  <Action OrderNumber="1" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="tmp_success" VariableExpression="(0${v:myIdx} &gt; 0) &amp;&amp; (0${v:myIdx} &lt;= 8) &amp;&amp; (0${v:myIdx} % 1 = 0)"/>
                  <Action OrderNumber="2" ActionType="Placeholder" Asynchronous="False" Description="fail" DescriptionOverride="True"/>
                  <Action OrderNumber="3" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_hint" VariableExpression="尚未设置自身职能。&#13;&#10;可输入文本指令设置，大小写不限。&#13;&#10;如：　/e mt　　/e h1　　/e d4">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="${f:contain(&quot; &quot;):${_me.name}}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="4" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_hint" VariableExpression="尚未設置自身職能。&#13;&#10;可輸入文本指令設置，大小写不限。&#13;&#10;如：　/e mt　　/e h1　　/e d4">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="${f:contain(&quot; &quot;):${_me.name}}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="5" ActionType="UseTTS" Asynchronous="False" UseTTSTextExpression="尚未设置职能，请查看聊天栏默语提示。">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="${v:tmp_success}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                      <ConditionSingle Enabled="true" ExpressionL="${failTTS}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="6" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="command" NamedCallbackParam="/e ${failSound}&#13;&#10;${v:tmp_hint}">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="${failEcho}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                      <ConditionSingle Enabled="true" ExpressionL="${v:tmp_success}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="7" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="warn" NamedCallbackParam="${failHintTime}&#13;&#10;${v:tmp_hint}">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="0${failHintTime}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="NumericGreater"/>
                      <ConditionSingle Enabled="true" ExpressionL="${v:tmp_success}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="8" ActionType="Placeholder" Asynchronous="False" Description="success" DescriptionOverride="True"/>
                  <Action OrderNumber="9" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_hint" VariableExpression="已设置自身职能：${?l: MT, ST, H1, H2, D1, D2, D3, D4 [0${v:myIdx}]}&#13;&#10;如有误，可输入文本指令设置，大小写不限。&#13;&#10;如：　/e mt　　/e h1　　/e d4">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="${f:contain(&quot; &quot;):${_me.name}}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="10" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_hint" VariableExpression="已設置自身職能：${?l: MT, ST, H1, H2, D1, D2, D3, D4 [0${v:myIdx}]}&#13;&#10;如有誤，可輸入文本指令設置，大小写不限。&#13;&#10;如：　/e mt　　/e h1　　/e d4">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="${f:contain(&quot; &quot;):${_me.name}}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="11" ActionType="UseTTS" Asynchronous="False" UseTTSTextExpression="已设置职能：${?l: MT, ST, H1, H2, D1, D2, D3, D4 [${v:myIdx}]}">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="${v:tmp_success}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                      <ConditionSingle Enabled="true" ExpressionL="${successTTS}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="12" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="command" NamedCallbackParam="/e ${successSound}&#13;&#10;${v:tmp_hint}">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="${successEcho}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                      <ConditionSingle Enabled="true" ExpressionL="${v:tmp_success}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="13" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="hint" NamedCallbackParam="${successHintTime}&#13;&#10;${v:tmp_hint}">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="0${successHintTime}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="NumericGreater"/>
                      <ConditionSingle Enabled="true" ExpressionL="${v:tmp_success}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="14" ActionType="Variable" Asynchronous="False" VariableName="tmp_hint"/>
                  <Action OrderNumber="15" ActionType="Variable" Asynchronous="False" VariableName="tmp_success"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="b0e4c105-19f3-49f9-8f02-61631b5907e6" Name="接收：倒计时" RegularExpression="^.{15}\S+ 10C:">
                <Actions>
                  <Action OrderNumber="1" ActionType="Placeholder" Asynchronous="False" Description="条件：已注册 zoneId =&gt; Self" DescriptionOverride="True"/>
                  <Action OrderNumber="2" ActionType="LogMessage" LogMessageText="PartyList:MyIdxCheck:0:1:0:1:0:10::&lt;se.11&gt;" LogProcess="True"/>
                </Actions>
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="Self" ExpressionTypeR="String" ConditionType="StringEqualNocase"/>
                </Condition>
              </Trigger>
              <Trigger Enabled="true" Id="73c1c4dd-3b8d-4251-b688-4a63d885d536" Name="接收：文本指令　　/e MT 　  （全队模式下提示错误）" RegularExpression="^.{15}\S+ 00:0038:: *([MmSs][Tt]|[TtHhDd][1-4]) *$" Sequential="True">
                <Actions>
                  <Action OrderNumber="1" ActionType="Placeholder" Description="条件：当前地图注册为全队模式" DescriptionOverride="True"/>
                  <Action OrderNumber="2" ActionType="Variable" VariableOp="SetString" VariableName="tmp_hint" VariableExpression="当前地图需要设置全队顺序，而非自身职能顺序。&#13;&#10;请使用 /e party（应该会自动弹出窗口）。">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="${f:contain(&quot; &quot;):${_me.name}}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="3" ActionType="Variable" VariableOp="SetString" VariableName="tmp_hint" VariableExpression="当前地圖需要設置全隊順序，而非自身職能順序。&#13;&#10;請使用 /e party（應該会自動彈出窗口）。">
                    <Condition Enabled="true" Grouping="And">
                      <ConditionSingle Enabled="true" ExpressionL="${f:contain(&quot; &quot;):${_me.name}}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="4" ActionType="NamedCallback" NamedCallbackName="command" NamedCallbackParam="/e &lt;se.11&gt;&#13;&#10;${v:tmp_hint}"/>
                  <Action OrderNumber="5" ActionType="NamedCallback" NamedCallbackName="warn" NamedCallbackParam="10&#13;&#10;${v:tmp_hint}"/>
                </Actions>
                <Condition Enabled="true" Grouping="And">
                  <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="Self" ExpressionTypeR="String" ConditionType="StringNotEqualNocase"/>
                  <ConditionSingle Enabled="true" ExpressionL="${d:PartyListPlayerDescs[${_ffxivzoneid}]}" ExpressionTypeL="String" ExpressionR="" ExpressionTypeR="String" ConditionType="StringNotEqualNocase"/>
                </Condition>
              </Trigger>
            </Triggers>
          </Folder>
          <Folder Id="8ee466b9-8f99-4a4c-b0dd-f90923ef13be" Enabled="false" Name="测试（真小鸟）" FFXIVZoneFilterEnabled="True" FfxivZoneFilterRegularExpression="^997$">
            <Triggers>
              <Trigger Enabled="true" Id="c066c513-6ba0-4264-ab65-7a44ff82d6e9" Name="小队列表注册区域" RegularExpression="^.{15}\S+ 01:(?&lt;zoneId&gt;[^:]*):">
                <Actions>
                  <Action OrderNumber="1" ActionType="LogMessage" LogMessageText="PartyList:Register:${n: 0x${zoneId} }:MT, ST, H1, H2, D1, D2, D3, D4" LogProcess="True"/>
                </Actions>
              </Trigger>
            </Triggers>
          </Folder>
        </Folders>
        <Triggers>
          <Trigger Enabled="false" Id="f1104955-e12f-4b6f-ac98-82924b75fa7d" Name="使用说明（面向开发）">
            <Actions>
              <Action OrderNumber="1" ActionType="Placeholder" Asynchronous="False" Description="首先通过触发器注册某副本的地图 ID" DescriptionOverride="True"/>
              <Action OrderNumber="2" ActionType="Placeholder" Asynchronous="False" Description="注册后可在进本、团灭、倒计时时自动触发提示" DescriptionOverride="True"/>
              <Action OrderNumber="3" ActionType="Placeholder" Asynchronous="False" Description="根据不同模式，用户可按提示设置自身或全队的职能顺序" DescriptionOverride="True"/>
              <Action OrderNumber="4" ActionType="Placeholder" Asynchronous="False" Description="支持两种模式：" DescriptionOverride="True"/>
              <Action OrderNumber="5" ActionType="Placeholder" Asynchronous="False" Description="1. 完整版" DescriptionOverride="True"/>
              <Action OrderNumber="6" ActionType="Placeholder" Asynchronous="False" Description="    将 PartyList:Register:[要注册的地图 ID]:[逗号分隔的自定义的全员描述] 发送为待解析的 ACT 日志行，即可注册。" DescriptionOverride="True"/>
              <Action OrderNumber="7" ActionType="Placeholder" Asynchronous="False" Description="    如你可以使用 M4s 副本的 01 行（ZoneChanged）触发，并发送：PartyList:Register:1132:MT, ST, H1, H2, D1, D2, D3, D4" DescriptionOverride="True"/>
              <Action OrderNumber="8" ActionType="Placeholder" Asynchronous="False" Description="    用户也可以使用 /e party 手动调用此 UI" DescriptionOverride="True"/>
              <Action OrderNumber="9" ActionType="Placeholder" Asynchronous="False" Description="  可使用的变量：" DescriptionOverride="True"/>
              <Action OrderNumber="10" ActionType="Placeholder" Asynchronous="False" Description="  · 列表 party：包含按顺序的八个 ID" DescriptionOverride="True"/>
              <Action OrderNumber="11" ActionType="Placeholder" Asynchronous="False" Description="  · 列表 pname：包含按顺序的八个名字（不建议在能使用 ID 的情况下使用）" DescriptionOverride="True"/>
              <Action OrderNumber="12" ActionType="Placeholder" Asynchronous="False" Description="  · 标量 myIdx：自身顺序，相当于 ${list:party.indexof(${_me.id})}" DescriptionOverride="True"/>
              <Action OrderNumber="13" ActionType="Placeholder" Asynchronous="False" Description="2. 单人版" DescriptionOverride="True"/>
              <Action OrderNumber="14" ActionType="Placeholder" Asynchronous="False" Description="    将 PartyList:Register:[要注册的地图 ID]:Self 发送为待解析的 ACT 日志行，即可注册。" DescriptionOverride="True"/>
              <Action OrderNumber="15" ActionType="Placeholder" Asynchronous="False" Description="    如你可以使用 M4s 副本的 01 行（ZoneChanged）触发，并发送：PartyList:Register:1132:Self" DescriptionOverride="True"/>
              <Action OrderNumber="16" ActionType="Placeholder" Asynchronous="False" Description="    用户需要使用 /e MT 等文本指令设置自身职能顺序" DescriptionOverride="True"/>
              <Action OrderNumber="17" ActionType="Placeholder" Asynchronous="False" Description="  可使用的变量：" DescriptionOverride="True"/>
              <Action OrderNumber="18" ActionType="Placeholder" Asynchronous="False" Description="   · 标量 myIdx：自身顺序" DescriptionOverride="True"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="81a45913-6b40-40b4-b794-6ebf77d6a3f2" Name="[Debug] 模拟小队：/e setparty [自身idx] [总人数]" RegularExpression="^.{15}\S+ 00:0038:: *(?i:setparty) +(?&lt;idx&gt;[1-8]) +(?&lt;all&gt;[1-8])$">
            <Actions>
              <Action OrderNumber="1" ActionType="ListVariable" Asynchronous="False" ListVariableOp="SetAll" ListVariableName="party" ListVariableExpression="10${n: ${_idx}*111111}" ListVariableIndex="${all}"/>
              <Action OrderNumber="2" ActionType="ListVariable" Asynchronous="False" ListVariableOp="Set" ListVariableName="party" ListVariableExpression="${_me.id}" ListVariableIndex="${idx}"/>
              <Action OrderNumber="3" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="myIdx" VariableExpression="${idx}"/>
              <Action OrderNumber="4" ActionType="LogMessage" Asynchronous="False" LogMessageText="PartyList:MyIdx8:${idx}" LogProcess="True">
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${all}" ExpressionTypeL="String" ExpressionR="8" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Action>
              <Action OrderNumber="5" ActionType="UseTTS" Asynchronous="False" UseTTSTextExpression="已设置调试小队"/>
            </Actions>
            <Condition Enabled="true" Grouping="Or">
              <ConditionSingle Enabled="true" ExpressionL="${idx}" ExpressionTypeL="String" ExpressionR="${all}" ExpressionTypeR="String" ConditionType="NumericLessEqual"/>
            </Condition>
          </Trigger>
        </Triggers>
      </Folder>
      <Folder Id="864ab4a4-ba85-40bb-a5f4-7223ee2c3830" Enabled="true" Name="延时咏唱">
        <Folders>
          <Folder Id="9855d8ef-f18d-433c-9e40-6513d536e4ef" Enabled="true" Name="BeepTimer">
            <Triggers>
              <Trigger Enabled="true" Id="9bc6c9c1-5319-498c-997f-0fa79987abc5" Name="CountDown5" RegularExpression="^(?i)cd5:(?&lt;delay&gt;[\d.]+)(?::(?&lt;duration&gt;[\d.]+))?" Tag="延迟咏唱">
                <Actions>
                  <Action OrderNumber="1" ActionType="LogMessage" LogMessageText="CountDown5 的延迟至少应为 4 s，实际提供了 ${delay} s。">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${delay}" ExpressionTypeL="String" ExpressionR="4" ExpressionTypeR="String" ConditionType="NumericLess"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="2" ExecutionDelayExpression="1000 * ${delay} - 4000" SystemBeepFreqExpression="freq(C6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="3" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(D6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="4" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(E6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="5" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(G6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="6" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(C7)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1500"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="f86434dc-f268-44e5-a8e9-48bdefc2f619" Name="CountDown4" RegularExpression="^(?i)cd4:(?&lt;delay&gt;[\d.]+)(?::(?&lt;duration&gt;[\d.]+))?" Tag="延迟咏唱">
                <Actions>
                  <Action OrderNumber="1" ActionType="LogMessage" LogMessageText="CountDown4 的延迟至少应为 3 s，实际提供了 ${delay} s。">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${delay}" ExpressionTypeL="String" ExpressionR="3" ExpressionTypeR="String" ConditionType="NumericLess"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="2" ExecutionDelayExpression="1000 * ${delay} - 3000" SystemBeepFreqExpression="freq(C6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="3" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(E6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="4" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(G6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="5" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(C7)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1500"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="9056d880-8bfa-435e-9243-059d1a6db9a5" Name="CountDown8" RegularExpression="^(?i)cd8:(?&lt;delay&gt;[\d.]+)(?::(?&lt;duration&gt;[\d.]+))?" Tag="延迟咏唱">
                <Actions>
                  <Action OrderNumber="1" ActionType="LogMessage" LogMessageText="CountDown8 的延迟至少应为 7 s，实际提供了 ${delay} s。">
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${delay}" ExpressionTypeL="String" ExpressionR="7" ExpressionTypeR="String" ConditionType="NumericLess"/>
                    </Condition>
                  </Action>
                  <Action OrderNumber="2" ExecutionDelayExpression="1000 * ${delay} - 7000" SystemBeepFreqExpression="freq(C6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="3" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(D6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="4" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(E6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="5" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(F6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="6" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(G6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="7" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(A6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="8" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(B6)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1000"/>
                  <Action OrderNumber="9" ExecutionDelayExpression="1000" SystemBeepFreqExpression="freq(C7)" SystemBeepLengthExpression="(${duration} ?? 0.2) * 1500"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="51c3b235-63cf-4a77-a02c-c5ab611f1009" Name="DelayBeep" RegularExpression="^(?i)Beep:(?&lt;delay&gt;[\d.]+)(?::(?&lt;freq&gt;[^:]*))?(?::(?&lt;duration&gt;[^:]*))?" Tag="延迟咏唱">
                <Actions>
                  <Action OrderNumber="1" ExecutionDelayExpression="1000 * ${delay}" SystemBeepFreqExpression="(${freq} ?? freq(C6))" SystemBeepLengthExpression="(${duration} ?? 200)"/>
                </Actions>
              </Trigger>
            </Triggers>
          </Folder>
        </Folders>
        <Triggers>
          <Trigger Enabled="true" Id="892fba94-5283-477c-81b7-e4348547dceb" Name="command" RegularExpression="^(?i)cmd:(?&lt;sec&gt;[^:]+):(?&lt;value&gt;.+)$" Tag="延迟咏唱">
            <Actions>
              <Action OrderNumber="1" ActionType="NamedCallback" ExecutionDelayExpression="(${sec}) * 1000" NamedCallbackName="command" NamedCallbackParam="${value}" UseTTSExclusive="False"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="4b6194f5-7adc-4c18-bcc1-e01e93840ac2" Name="TTS" RegularExpression="^(?i)tts:(?&lt;sec&gt;[^:]+):(?&lt;value&gt;.+)$" Tag="延迟咏唱">
            <Actions>
              <Action OrderNumber="1" ActionType="UseTTS" ExecutionDelayExpression="(${sec}) * 1000" UseTTSTextExpression="${value}" UseTTSExclusive="False"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="5fcc6937-86e9-410d-bdc4-70fbeaa7c534" Name="log" RegularExpression="^(?i)log:(?&lt;sec&gt;[^:]+):(?&lt;value&gt;.+)$" Tag="延迟咏唱">
            <Actions>
              <Action OrderNumber="1" ActionType="LogMessage" ExecutionDelayExpression="(${sec}) * 1000" LogMessageText="${value}" LogProcess="True" LogProcessACT="True" UseTTSExclusive="False"/>
            </Actions>
          </Trigger>
          <Trigger Enabled="true" Id="e0437174-5255-414e-9e15-6437ee859e1a" Name="团灭中断" RegularExpression="^.{15}\S+ 21:.{8}:4000000[35]">
            <Actions>
              <Action OrderNumber="1" ActionType="Trigger" UseTTSExclusive="False" TriggerOp="CancelAllTrigger" TriggerTagRegex="^延迟咏唱$"/>
            </Actions>
          </Trigger>
        </Triggers>
      </Folder>
      <Folder Id="b2fc5397-02bd-4bd1-ae10-d7bc4d849fb4" Enabled="true" Name="鲶鱼精邮差扩展 v4.2.3" RawEnvironmentVariables="version = 4.2.2&#13;&#10;trigversion = 2.0.2.4">
        <Folders>
          <Folder Id="f7b6f7f2-8adb-449b-a774-96c58632c822" Enabled="true" Name="core">
            <Folders>
              <Folder Id="387e471f-6eaa-4598-9984-f51711f8461f" Enabled="true" Name="初始化">
                <Triggers>
                  <Trigger Enabled="true" Id="33d9b7ec-cba2-4799-a702-33d8f43b60cd" Name="3. 接收：鲶鱼精邮差新建模组成功 =&gt; 注册 Basic" RegularExpression="^PNE_ModulesInited">
                    <Actions>
                      <Action OrderNumber="1" ActionType="ExecuteScript" Description="BridgeNamazu.RegisterAnnotatedMethods()" DescriptionOverride="True" ExecScriptExpression="using Triggernometry.PluginBridges.BridgeNamazu;&#13;&#10;BridgeNamazu.RegisterAnnotatedMethods();"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="c2e21ce0-8905-48a8-a908-8a2ac0926dac" Name="2. 新建模组 【在这里 sideload】" RegularExpression="^PNE_Init:force:(?&lt;bForce&gt;[01])" PrevActionsRefire="Deny" PeriodRefire="Deny" RefirePeriodExpression="5000" Sequential="True">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Placeholder" Asynchronous="False" Description="条件：强制 或 未注册" DescriptionOverride="True"/>
                      <Action OrderNumber="2" ActionType="MessageBox" MessageBoxIconType="Warning" MessageBoxText="远程库所需的触发器插件版本高于当前版本，&#13;&#10;可能是触发器插件与远程库同时更新所致。&#13;&#10;重启 ACT 自动完成更新即可恢复正常。&#13;&#10;">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${func:versioncompare(${env:trigversion}):${_pluginversion}}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="NumericLess"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="3" ActionType="ExecuteScript" Description="BridgeNamazu.InitializeModules()" DescriptionOverride="True" ExecScriptExpression="using System;&#13;&#10;using Triggernometry;&#13;&#10;using Triggernometry.PluginBridges.BridgeNamazu;&#13;&#10;using Triggernometry.PluginBridges.BridgeNamazu.Modules;&#13;&#10;&#13;&#10;BridgeNamazu.InitializeModules(() =&gt; {&#13;&#10;    // 示例：Sideload（版本更新后可覆写偏移或扫描方法等）&#13;&#10;    // var module = BridgeNamazu.GetModule&lt;EntityModule&gt;();&#13;&#10;    // module.PosOffset = () =&gt; BridgeNamazu.NamazuPlugin.IsCN ? 0x74 : 0x70;&#13;&#10;    // module.ScanMethod = () =&gt; { module.GetStatusIndexPtr = ModuleBase.Scanner.ScanText(&quot;xxx&quot;); };&#13;&#10;    var mEnt = BridgeNamazu.GetModule&lt;EntityModule&gt;();&#13;&#10;    mEnt.IdOffset = () =&gt; 0x78;&#13;&#10;    mEnt.PosOffset = () =&gt; 0xB0;&#13;&#10;    mEnt.ScaleOffset = () =&gt; 0xC4;&#13;&#10;    mEnt.ModelRelPosOffset = () =&gt; 0xE0;&#13;&#10;    mEnt.ModelOffset = () =&gt; 0x100;&#13;&#10;    mEnt.StatusLoopVfxOffset = () =&gt; 0x1C8;&#13;&#10;    mEnt.OpacityOffset = () =&gt; 0x22D8;&#13;&#10;    mEnt.ModelStatusOffset = () =&gt; 0x118;&#13;&#10;    var mCam = BridgeNamazu.GetModule&lt;CameraModule&gt;();&#13;&#10;    mCam.OffsetsCN = mCam.OffsetsGlobal;&#13;&#10;});"/>
                    </Actions>
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${ecallback:hint}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                      <ConditionSingle Enabled="true" ExpressionL="${bForce}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                    </Condition>
                  </Trigger>
                  <Trigger Enabled="true" Id="ebaa7cc2-a657-4242-96bd-8bd57afe0a40" Name="1.1 接收：鲶鱼精邮差注入成功 =&gt; 2" RegularExpression="^.{15}\S+ 00:FFFF:PostNamazu:Attached" PrevActionsRefire="Deny" PeriodRefire="Deny" RefirePeriodExpression="5000" Sequential="True">
                    <Actions>
                      <Action OrderNumber="1" ActionType="LogMessage" LogMessageText="PNE_Init:force:1" LogProcess="True"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="852ba46e-829e-48db-a211-1e7ceed4630b" Name="1.2 接收：地图切换 =&gt; 2" RegularExpression="^.{15}\S+ 01:" PrevActionsRefire="Deny" PeriodRefire="Deny" RefirePeriodExpression="5000" Sequential="True">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="myAddress_new" VariableExpression="${_me.Address}"/>
                      <Action OrderNumber="2" ActionType="Placeholder" Asynchronous="False" Description="ACT 晚于游戏启动时，鲶鱼精刚加载就会立刻初始化，但远程触发器可能尚未加载，因此 01 行也检测一下" DescriptionOverride="True"/>
                      <Action OrderNumber="3" ActionType="LogMessage" Asynchronous="False" LogMessageText="PNE_Init:force:0" LogProcess="True">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${ev:myAddress}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="4" ActionType="Placeholder" Asynchronous="False" Description="如果自身地址意外变动，强制重新扫描" DescriptionOverride="True"/>
                      <Action OrderNumber="5" ActionType="LogMessage" Asynchronous="False" LogMessageText="PNE_Init:force:1" LogProcess="True">
                        <Condition Enabled="true" Grouping="And">
                          <ConditionSingle Enabled="true" ExpressionL="${ev:myAddress}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                          <ConditionSingle Enabled="true" ExpressionL="${v:myAddress}" ExpressionTypeL="String" ExpressionR="${v:myAddress_new}" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="6" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="myAddress" VariableExpression="${v:myAddress_new}"/>
                      <Action OrderNumber="7" ActionType="Variable" Asynchronous="False" VariableName="myAddress_new"/>
                    </Actions>
                  </Trigger>
                </Triggers>
              </Folder>
              <Folder Id="c1610a31-9ab1-4e47-b147-9b42a184c015" Enabled="true" Name="接收文本指令">
                <Triggers>
                  <Trigger Enabled="true" Id="f738fd6c-97e4-4b64-9701-535d4de8829b" Name="Scaling" RegularExpression="^.{15}\S+ 00:0038::scale +(?&lt;scales&gt;.+)$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_address" VariableExpression="${_entity[${_me.targetid}].address}"/>
                      <Action OrderNumber="2" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_address" VariableExpression="${_me.address}">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="0${v:tmp_address}" ExpressionTypeL="Numeric" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="3" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="ObjectScaling" NamedCallbackParam="${v:tmp_address}, ${f:replace(&quot; &quot;, &quot;,&quot;):${scales}}"/>
                      <Action OrderNumber="4" ActionType="Variable" Asynchronous="False" VariableName="tmp_address"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="a9f68dc9-1ccd-4e6e-a436-1ffec80bdb81" Name="SetHighlightColor" RegularExpression="^.{15}\S+ 00:0038::highlight (?&lt;color&gt;\d+)$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_address" VariableExpression="${_entity[${_me.targetid}].address}"/>
                      <Action OrderNumber="2" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_address" VariableExpression="${_me.address}">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="0${v:tmp_address}" ExpressionTypeL="Numeric" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="3" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="SetHighlightColor" NamedCallbackParam="${v:tmp_address}, ${color}"/>
                      <Action OrderNumber="4" ActionType="Variable" Asynchronous="False" VariableName="tmp_address"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="32854f42-ad41-40ec-94f3-5867b6883d4c" Name="SetStatusLoopVfx" RegularExpression="^.{15}\S+ 00:0038::vfx (?&lt;vfxid&gt;.+)$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_address" VariableExpression="${_entity[${_me.targetid}].address}"/>
                      <Action OrderNumber="2" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_address" VariableExpression="${_me.address}">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="0${v:tmp_address}" ExpressionTypeL="Numeric" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="3" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="SetStatusLoopVfx" NamedCallbackParam="${v:tmp_address}, ${vfxid}"/>
                      <Action OrderNumber="4" ActionType="Variable" Asynchronous="False" VariableName="tmp_address"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="bce5975a-a3f4-4475-a472-85d04370bf53" Name="Redraw" RegularExpression="^.{15}\S+ 00:0038::redraw$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_address" VariableExpression="${_entity[${_me.targetid}].address}"/>
                      <Action OrderNumber="2" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_address" VariableExpression="${_me.address}">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="0${v:tmp_address}" ExpressionTypeL="Numeric" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="3" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="Redraw" NamedCallbackParam="${v:tmp_address}"/>
                      <Action OrderNumber="4" ActionType="Variable" Asynchronous="False" VariableName="tmp_address"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="64ccd809-74af-45f4-b0fa-6727fc93a97c" Name="LockOn" RegularExpression="^.{15}\S+ 00:0038::lockon (?&lt;vfxname&gt;.+)$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_address" VariableExpression="${_entity[${_me.targetid}].address}"/>
                      <Action OrderNumber="2" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="tmp_address" VariableExpression="${_me.address}">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="0${v:tmp_address}" ExpressionTypeL="Numeric" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="3" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="LockOn" NamedCallbackParam="${v:tmp_address}, ${vfxname}"/>
                      <Action OrderNumber="4" ActionType="Variable" Asynchronous="False" VariableName="tmp_address"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="b6e68377-c2f7-46ec-b70a-fbb0f33005ac" Name="Hint / Warn" RegularExpression="^.{15}\S+ 00:0038::(?i) *(?&lt;type&gt;hint|warn) +(?&lt;t&gt;[\d.]+) (?&lt;data&gt;.+)">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="${f:tolower:${type}}" NamedCallbackParam="${n:${t}}&#13;&#10;${data}"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="ff86fb33-bfd5-428c-8aaf-66562a58985d" Name="Quit" RegularExpression="^.{15}\S+ 00:0038::(?i) *quit *$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="QuitInstance" NamedCallbackParam="0"/>
                      <Action OrderNumber="2" ActionType="NamedCallback" Asynchronous="False" NamedCallbackName="QuitInstance" NamedCallbackParam="1"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="88b84645-0259-45dc-97c9-2feab45a4554" Name="Channeling" RegularExpression="^.{15}\S+ 00:0038::channeling +(?&lt;vfxname&gt;.+?) *$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="Channeling" NamedCallbackParam="${_me.address}, ${_entity[${_me.targetid}].address}, ${f:replace(&quot; &quot;, &quot;,&quot;):${vfxname}}">
                        <Condition Enabled="true" Grouping="And">
                          <ConditionSingle Enabled="true" ExpressionL="0${_entity[${_me.targetid}].address}" ExpressionTypeL="Numeric" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                        </Condition>
                      </Action>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="75995d89-65d5-478e-8abe-5b4f8423a372" Name="FoV" RegularExpression="^.{15}\S+ 00:0038::(?i) *fov +(?&lt;fov&gt;.+)*$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="SetCameraParams" NamedCallbackParam="FoV = ${n: ${fov}}"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="066936ef-9a5d-4da6-b2a6-9ac706be13ac" Name="Sight" RegularExpression="^.{15}\S+ 00:0038::(?i) *sight +(?&lt;h&gt;[^ ]*) +(?&lt;v&gt;[^ ]*) *$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="SetCameraParams" NamedCallbackParam="AngleH = ${n: ${h}}&#13;&#10;AngleV = ${n: ${v}}&#13;&#10;MinAngleV = -π/2 + 0.002&#13;&#10;MaxAngleV = π/2 - 0.002"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="67973175-3d50-4056-87b1-17715d32bf61" Name="MapEffect /e map 00020001:00" RegularExpression="^.{15}\S+ 00:0038::(?i)map(?:effect)? (.{8}:.{2})">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="MapEffect" NamedCallbackParam="$1"/>
                      <Action OrderNumber="2"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="b7b927e2-0347-415c-9a39-f7b76c33b41d" Name="MapEffect /e map 0100 1F" RegularExpression="^.{15}\S+ 00:0038::(?i)map(?:effect)? +([01248]{1,4}) +([0-9A-F]{1,2})">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="MapEffect" NamedCallbackParam="${n: 0x$2}, 1, ${n: 0x$1}"/>
                      <Action OrderNumber="2"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="3097dfff-ee5c-4f0a-ac26-59f9a7c2d90c" Name="CastVfx" RegularExpression="^.{15}\S+ 00:0038::castvfx +(?&lt;vfxname&gt;.+?) *$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="CastVfx" NamedCallbackParam="${_me.address}, ${_entity[${_me.targetid}].address}, ${f:replace(&quot; &quot;, &quot;,&quot;):${vfxname}}">
                        <Condition Enabled="true" Grouping="And">
                          <ConditionSingle Enabled="true" ExpressionL="0${_entity[${_me.targetid}].address}" ExpressionTypeL="Numeric" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringNotEqualCase"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="2" ActionType="NamedCallback" NamedCallbackName="CastVfx" NamedCallbackParam="${_me.address}, ${_me.address}, ${f:replace(&quot; &quot;, &quot;,&quot;):${vfxname}}">
                        <Condition Enabled="true" Grouping="And">
                          <ConditionSingle Enabled="true" ExpressionL="0${_entity[${_me.targetid}].address}" ExpressionTypeL="Numeric" ExpressionR="0" ExpressionTypeR="String" ConditionType="NumericEqual"/>
                        </Condition>
                      </Action>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="77424db6-3cc0-4ae9-969c-10f0db50c2c5" Name="Omen" RegularExpression="^.{15}\S+ 00:0038::(?i) *omen +(?&lt;vfxname&gt;.+?) *$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="Omen" NamedCallbackParam="${?l:${f:replace(&quot; &quot;, &quot;,&quot;):${vfxname}}[1]}, ${n: ${?l:${f:replace(&quot; &quot;, &quot;,&quot;):${vfxname}}[2]} ?? 3}, ${_me.pos, h}, ${n: ${?l:${f:replace(&quot; &quot;, &quot;,&quot;):${vfxname}}[3]} ?? 5}, ${n: ${?l:${f:replace(&quot; &quot;, &quot;,&quot;):${vfxname}}[4]} ?? 5}, ${n: ${?l:${f:replace(&quot; &quot;, &quot;,&quot;):${vfxname}}[5]} ?? 5}, ${n: ${?l:${f:replace(&quot; &quot;, &quot;,&quot;):${vfxname}}[6]} ?? 1}, ${n: ${?l:${f:replace(&quot; &quot;, &quot;,&quot;):${vfxname}}[7]} ?? 1}, ${n: ${?l:${f:replace(&quot; &quot;, &quot;,&quot;):${vfxname}}[8]} ?? 1}, ${n: ${?l:${f:replace(&quot; &quot;, &quot;,&quot;):${vfxname}}[9]} ?? 1}">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${vfxname} ?? -1" ExpressionTypeL="Numeric" ExpressionR="0" ExpressionTypeR="String" ConditionType="NumericLess"/>
                        </Condition>
                      </Action>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="3c4ee0fa-8571-4de3-9242-235d3095bf43" Name="/e SB 10" RegularExpression="^.{15}\S+ 00:0038::(?i) *sb(?: +(?&lt;scale&gt;[\d.]+))? *$" PrevActions="Interrupt">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="x" VariableExpression="${_me.x}"/>
                      <Action OrderNumber="2" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="y" VariableExpression="${_me.y}"/>
                      <Action OrderNumber="3" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="z" VariableExpression="${_me.z}"/>
                      <Action OrderNumber="4" ActionType="Variable" Asynchronous="False" VariableOp="SetString" VariableName="h" VariableExpression="${_me.h}"/>
                      <Action OrderNumber="5" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="k" VariableExpression="(${scale} ?? 1) * 0.6"/>
                      <Action OrderNumber="6" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="t" VariableExpression="10"/>
                      <Action OrderNumber="7" ActionType="NamedCallback" NamedCallbackName="Omen" NamedCallbackParam="gl_fan270_1005af, ${v:t}, ${n: ${v:x} - (-5) * ${v:k} * cos(${v:h}) - (-10) * ${v:k} * sin(${v:h})}, ${n:${v:y} + (-5) * ${v:k} * sin(${v:h}) - (-10) * ${v:k} * cos(${v:h})}, ${v:z}, ${v:h} + π/4, ${v:k} * 4"/>
                      <Action OrderNumber="8" ActionType="NamedCallback" NamedCallbackName="Omen" NamedCallbackParam="gl_fan270_1005af, ${v:t}, ${n: ${v:x} - (-5) * ${v:k} * cos(${v:h}) - (-4) * ${v:k} * sin(${v:h})}, ${n:${v:y} + (-5) * ${v:k} * sin(${v:h}) - (-4) * ${v:k} * cos(${v:h})}, ${v:z}, ${v:h} + 5 * π/4, ${v:k} * 4"/>
                      <Action OrderNumber="9" ActionType="NamedCallback" NamedCallbackName="Omen" NamedCallbackParam="er_general02f, ${v:t}, ${n: ${v:x} - (1) * ${v:k} * cos(${v:h}) - (-7) * ${v:k} * sin(${v:h})}, ${n:${v:y} + (1) * ${v:k} * sin(${v:h}) - (-7) * ${v:k} * cos(${v:h})}, ${v:z}, ${v:h} - π/2, ${v:k} * 7, ${v:k} * 2"/>
                      <Action OrderNumber="10" ActionType="NamedCallback" NamedCallbackName="Omen" NamedCallbackParam="er_general02f, ${v:t}, ${n: ${v:x} - (3) * ${v:k} * cos(${v:h}) - (-7) * ${v:k} * sin(${v:h})}, ${n:${v:y} + (3) * ${v:k} * sin(${v:h}) - (-7) * ${v:k} * cos(${v:h})}, ${v:z}, ${v:h} - π/2, ${v:k} * 1, ${v:k} * 2"/>
                      <Action OrderNumber="11" ActionType="NamedCallback" NamedCallbackName="Omen" NamedCallbackParam="er_general02f, ${v:t}, ${n: ${v:x} - (3) * ${v:k} * cos(${v:h}) - (-1) * ${v:k} * sin(${v:h})}, ${n:${v:y} + (3) * ${v:k} * sin(${v:h}) - (-1) * ${v:k} * cos(${v:h})}, ${v:z}, ${v:h} - π/2, ${v:k} * 1, ${v:k} * 2"/>
                      <Action OrderNumber="12" ActionType="NamedCallback" NamedCallbackName="Omen" NamedCallbackParam="er_general02f, ${v:t}, ${n: ${v:x} - (3) * ${v:k} * cos(${v:h}) - (-13) * ${v:k} * sin(${v:h})}, ${n:${v:y} + (3) * ${v:k} * sin(${v:h}) - (-13) * ${v:k} * cos(${v:h})}, ${v:z}, ${v:h} - π/2, ${v:k} * 1, ${v:k} * 2"/>
                      <Action OrderNumber="13" ActionType="NamedCallback" NamedCallbackName="Omen" NamedCallbackParam="er_gl_fan100_o1v, ${v:t}, ${n: ${v:x} - (5) * ${v:k} * cos(${v:h}) - (-4) * ${v:k} * sin(${v:h})}, ${n:${v:y} + (5) * ${v:k} * sin(${v:h}) - (-4) * ${v:k} * cos(${v:h})}, ${v:z}, ${v:h} - 50°, ${v:k} * 4"/>
                      <Action OrderNumber="14" ActionType="NamedCallback" NamedCallbackName="Omen" NamedCallbackParam="er_gl_fan100_o1v, ${v:t}, ${n: ${v:x} - (5) * ${v:k} * cos(${v:h}) - (-4) * ${v:k} * sin(${v:h})}, ${n:${v:y} + (5) * ${v:k} * sin(${v:h}) - (-4) * ${v:k} * cos(${v:h})}, ${v:z}, ${v:h} - 130°, ${v:k} * 4"/>
                      <Action OrderNumber="15" ActionType="NamedCallback" NamedCallbackName="Omen" NamedCallbackParam="er_gl_fan100_o1v, ${v:t}, ${n: ${v:x} - (5) * ${v:k} * cos(${v:h}) - (-10) * ${v:k} * sin(${v:h})}, ${n:${v:y} + (5) * ${v:k} * sin(${v:h}) - (-10) * ${v:k} * cos(${v:h})}, ${v:z}, ${v:h} - 50°, ${v:k} * 4"/>
                      <Action OrderNumber="16" ActionType="NamedCallback" NamedCallbackName="Omen" NamedCallbackParam="er_gl_fan100_o1v, ${v:t}, ${n: ${v:x} - (5) * ${v:k} * cos(${v:h}) - (-10) * ${v:k} * sin(${v:h})}, ${n:${v:y} + (5) * ${v:k} * sin(${v:h}) - (-10) * ${v:k} * cos(${v:h})}, ${v:z}, ${v:h} - 130°, ${v:k} * 4"/>
                      <Action OrderNumber="17" ActionType="Variable" ExecutionDelayExpression="1000" VariableOp="UnsetRegex" VariableName="^[xyzhkt]$"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="a998f61b-7b4b-4718-9fde-1748218e421a" Name="Polygon" RegularExpression="^.{15}\S+ 00:0038::(?i)polygon +(\d+)">
                    <Actions>
                      <Action OrderNumber="1" ActionType="Variable" Asynchronous="False" VariableOp="SetNumeric" VariableName="dθ" VariableExpression="random(0, 60) / 180 * π"/>
                      <Action OrderNumber="2" ActionType="ListVariable" Asynchronous="False" ListVariableOp="SetAll" ListVariableName="test" ListVariableExpression="${n: 15 * sin(${_idx} * 2 * π / $1 + ${v:dθ}) + random(-15, 15) / $1}, ${n: 15 * cos(${_idx} * 2 * π / $1 + ${v:dθ})+ random(-15, 15) / $1}" ListVariableIndex="$1"/>
                      <Action OrderNumber="3" ActionType="NamedCallback" NamedCallbackName="PictoACT" NamedCallbackParam="Action: Triangulate&#13;&#10;Tag: test&#13;&#10;O: ${_me.Pos}&#13;&#10;Points: 0,0; ${l:test.join(&quot;;&quot;)}; ${l:test[1]}+0.01&#13;&#10;t: sqrt($1)&#13;&#10;Color: 0, 1, 10, 1"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="ee359be4-26fa-4a0f-86be-70aea392a8d9" Name="清除所有特效" RegularExpression="^.{15}\S+ 00:0038::(?i)removevfx(?: +(?&lt;regex&gt;.+?))? *$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="PictoACT" NamedCallbackParam="Action: Remove">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${regex}" ExpressionTypeL="String" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="2" ActionType="NamedCallback" NamedCallbackName="PictoACT" NamedCallbackParam="Action: Remove&#13;&#10;Regex: ${regex}">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${regex}" ExpressionTypeL="String" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Action>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="22aa16fe-7a1c-417b-9c84-efb5ccb0e447" Name="Weather" RegularExpression="^.{15}\S+ 00:0038::(?i)weather +(?&lt;id&gt;.+)">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="ChangeWeather" NamedCallbackParam="${n: ${id}}"/>
                      <Action OrderNumber="2"/>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="6b990054-24e0-4896-9f84-9782fe1edc1d" Name="测试：重绘全部实体" RegularExpression="^.{15}\S+ 00:0038::(?i)fix$">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="InvokeOnMultipleEntities" NamedCallbackParam="!0&#13;&#10;Redraw, _address"/>
                    </Actions>
                  </Trigger>
                </Triggers>
              </Folder>
              <Folder Id="bebebb62-700f-4c67-b900-eae7beedd9b9" Enabled="true" Name="自动刷新">
                <Triggers>
                  <Trigger Enabled="true" Id="4eba3dda-9438-40f0-88fb-3d147316d53a" Name="Camera" RegularExpression="^.{15}\S+ 01:|^PNE_ModulesRegistered:Basic">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="SetCameraParams" NamedCallbackParam="Apply">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${pd:PNE_cfg[camera_enabled]}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Action>
                    </Actions>
                  </Trigger>
                  <Trigger Enabled="true" Id="53d7de58-62e5-4fb3-b9ad-b20b72345470" Name="InstanceAfkTimer" RegularExpression="^.{15}\S+ 01:|(?&lt;update&gt;PNE_cfgUpdate)">
                    <Actions>
                      <Action OrderNumber="1" ActionType="NamedCallback" NamedCallbackName="DisableInstanceAfkTimer" NamedCallbackParam="${pd:PNE_cfg[InstanceAfkTimer]}"/>
                    </Actions>
                    <Condition Enabled="true" Grouping="Or">
                      <ConditionSingle Enabled="true" ExpressionL="${pd:PNE_cfg[InstanceAfkTimer]}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                      <ConditionSingle Enabled="true" ExpressionL="${update}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualNocase"/>
                    </Condition>
                  </Trigger>
                </Triggers>
              </Folder>
              <Folder Id="f805c7eb-57b5-46f5-b3bd-a2c147e8d283" Enabled="true" Name="倒数自检">
                <Triggers>
                  <Trigger Enabled="true" Id="2f1a77a6-f9cf-458f-bc4b-aaf0f7894dee" Name="倒数自检" RegularExpression="^.{15}\S+ 10C:[^:]*:[^:]*:(?&lt;cd&gt;[^:]*):00?:" PrevActionsRefire="Deny" PeriodRefire="Deny" RefirePeriodExpression="31000" Sequential="True">
                    <Actions>
                      <Action OrderNumber="1" ActionType="TableVariable" TableVariableOp="GetAllEntities" TableVariableName="SelfTest_all" TableVariableX="InParty" TableVariableY="Type = 1"/>
                      <Action OrderNumber="2" ActionType="Variable" VariableOp="SetNumeric" VariableName="SelfTest_entityCount" VariableExpression="${t:SelfTest_all.height} - 1"/>
                      <Action OrderNumber="3" ActionType="Variable" VariableOp="SetString" VariableName="SelfTest_partyCount" VariableExpression="${t:SelfTest_all.count(1)}"/>
                      <Action OrderNumber="4" ActionType="TableVariable" TableVariableName="SelfTest_all"/>
                      <Action OrderNumber="5" ActionType="Placeholder" Description="场上只有 8 个队友" DescriptionOverride="True"/>
                      <Action OrderNumber="6" ActionType="Variable" VariableOp="SetString" VariableName="SelfTest_bTest" VariableExpression="1">
                        <Condition Enabled="true" Grouping="And">
                          <ConditionSingle Enabled="true" ExpressionL="${v:SelfTest_partyCount}" ExpressionTypeL="Numeric" ExpressionR="8" ExpressionTypeR="Numeric" ConditionType="StringEqualCase"/>
                          <ConditionSingle Enabled="true" ExpressionL="${v:SelfTest_entityCount}" ExpressionTypeL="Numeric" ExpressionR="8" ExpressionTypeR="Numeric" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="7" ActionType="Placeholder" Description="只有自己" DescriptionOverride="True"/>
                      <Action OrderNumber="8" ActionType="Variable" VariableOp="SetString" VariableName="SelfTest_bTest" VariableExpression="1">
                        <Condition Enabled="true" Grouping="And">
                          <ConditionSingle Enabled="true" ExpressionL="${v:SelfTest_entityCount}" ExpressionTypeL="Numeric" ExpressionR="1" ExpressionTypeR="Numeric" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="9" ActionType="Placeholder" Description="是需要检测的四人高难" DescriptionOverride="True"/>
                      <Action OrderNumber="10" ActionType="Variable" VariableOp="SetString" VariableName="SelfTest_bTest" VariableExpression="1">
                        <Condition Enabled="true" Grouping="And">
                          <ConditionSingle Enabled="true" ExpressionL="${v:SelfTest_partyCount}" ExpressionTypeL="Numeric" ExpressionR="4" ExpressionTypeR="Numeric" ConditionType="StringEqualCase"/>
                          <ConditionSingle Enabled="true" ExpressionL="${v:SelfTest_entityCount}" ExpressionTypeL="Numeric" ExpressionR="4" ExpressionTypeR="Numeric" ConditionType="StringEqualCase"/>
                          <ConditionSingle Enabled="true" ExpressionL="${_ffxivzoneid}" ExpressionTypeL="String" ExpressionR="^(115[56]|107[56]|1179|1180|1311|1290|1333)$" ExpressionTypeR="String" ConditionType="RegexMatch"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="11" ActionType="Placeholder" Description="新月岛" DescriptionOverride="True"/>
                      <Action OrderNumber="12" ActionType="Variable" VariableOp="SetString" VariableName="SelfTest_bTest" VariableExpression="1">
                        <Condition Enabled="true" Grouping="And">
                          <ConditionSingle Enabled="true" ExpressionL="${_ffxivzoneid}" ExpressionTypeL="String" ExpressionR="1252" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                          <ConditionSingle Enabled="true" ExpressionL="${_me.z}" ExpressionTypeL="String" ExpressionR="-100" ExpressionTypeR="String" ConditionType="NumericLess"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="13" ActionType="Placeholder" Description="条件满足" DescriptionOverride="True"/>
                      <Action OrderNumber="14" ActionType="NamedCallback" NamedCallbackName="PictoACT" NamedCallbackParam="Omen: Circle&#13;&#10;t: 1&#13;&#10;Scale: 0.01&#13;&#10;Pos: ${_me.Pos}">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${v:SelfTest_bTest}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="15" ActionType="NamedCallback" NamedCallbackName="Channeling" NamedCallbackParam="${_me.Address}, ${_me.Address}, chn_dark001f, 1">
                        <Condition Enabled="true" Grouping="Or">
                          <ConditionSingle Enabled="true" ExpressionL="${v:SelfTest_bTest}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                        </Condition>
                      </Action>
                      <Action OrderNumber="16" ActionType="Variable" VariableName="SelfTest_entityCount"/>
                      <Action OrderNumber="17" ActionType="Variable" VariableName="SelfTest_partyCount"/>
                      <Action OrderNumber="18" ActionType="Variable" VariableName="SelfTest_bTest"/>
                    </Actions>
                  </Trigger>
                </Triggers>
              </Folder>
            </Folders>
            <Triggers>
              <Trigger Enabled="false" Id="22ecc31f-63ad-4081-9037-44ebde84f87e" Name="更新提示 4.0.4" RegularExpression="^." PrevActionsRefire="Deny" PeriodRefire="Deny" RefirePeriodExpression="30000">
                <Actions>
                  <Action OrderNumber="1" ActionType="MessageBox" MessageBoxIconType="Information" MessageBoxText="[提示] &#13;&#10;&#13;&#10;如果 ACT 开启时退出并重登了游戏，&#13;&#10;在准备战斗时可能会游戏闪退。&#13;&#10;&#13;&#10;这是开场自检触发的，目的是确保战斗中调用特效不会掉线，&#13;&#10;在重启游戏后重启 ACT 即可正常工作。&#13;&#10;&#13;&#10;如果你确实是由于以上原因而闪退，&#13;&#10;说明并非插件冲突，暂时按以上方法处理即可。"/>
                  <Action OrderNumber="2" ActionType="Trigger" TriggerOp="DisableTrigger" TriggerId="22ecc31f-63ad-4081-9037-44ebde84f87e"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="052025f7-0606-4307-b282-8e0e9d5111de" Name="配置界面" RegularExpression="^.{15}\S+ 00:0038::(?i) *cfg +pne *$|^pne_cfg$" Sequential="True">
                <Actions>
                  <Action OrderNumber="1" ActionType="ExecuteScript" ExecScriptExpression="using Triggernometry.PluginBridges.BridgeNamazu;&#13;&#10;BridgeNamazu.ShowConfig();"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="dc839efd-6852-4368-9be0-5ce3bc09e5d3" Name="团灭清空 vfx" RegularExpression="^.{15}\S+ 21:.{8}:4000000[356]" Sequential="True">
                <Actions>
                  <Action OrderNumber="1" ActionType="NamedCallback" DescBgColor="ffd" NamedCallbackName="PictoACT" NamedCallbackParam="Action: Remove&#13;&#10;Type: Static"/>
                </Actions>
              </Trigger>
            </Triggers>
          </Folder>
        </Folders>
        <Triggers>
          <Trigger Enabled="false" Id="5958faf5-bf25-476e-8cc1-709d05522207" Name="此分组不可更改，如需开关功能，见 远程触发器 - 自检工具箱 的 鲶鱼精邮差扩展" Source="None"/>
        </Triggers>
      </Folder>
      <Folder Id="174e02b3-9298-42bb-bf98-2aafc2dcabd0" Enabled="true" Name="通用技能播报">
        <Folders>
          <Folder Id="14ed1fd9-b65c-4ae5-b9a7-e9f0925fa628" Enabled="true" Name="自动中断">
            <Triggers>
              <Trigger Enabled="true" Id="514f3337-9ad9-4d30-b174-2179067c98f7" Name="敌方被插言" RegularExpression="^.{15}\S+ 15:1.{7}:[^:]*:1D72:[^:]*:(?&lt;tid&gt;4.{7}):[^:]*:4C:">
                <Actions>
                  <Action OrderNumber="1" ActionType="NamedCallback" DescBgColor="ffd" LogProcess="True" NamedCallbackName="PictoACT" NamedCallbackParam="Action: Remove&#13;&#10;Regex: ${tid}"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="f69ee307-8aa0-4be7-8443-633f7162f018" Name="敌方被眩晕" RegularExpression="^.{15}\S+ 1A:02:[^:]+:(?&lt;t&gt;[^:]+):1.{7}:[^:]*:(?&lt;tid&gt;4.{7}):">
                <Actions>
                  <Action OrderNumber="1" ActionType="NamedCallback" DescBgColor="ffd" LogProcess="True" NamedCallbackName="PictoACT" NamedCallbackParam="Action: Remove&#13;&#10;Regex: ${tid}"/>
                </Actions>
              </Trigger>
              <Trigger Enabled="true" Id="21749613-427d-404a-883c-86a295939772" Name="敌方读条中断" RegularExpression="^.{15}\S+ 17:(?&lt;sid&gt;4.{7}):[^:]*:(?&lt;aid&gt;[^:]+):">
                <Actions>
                  <Action OrderNumber="1" ActionType="NamedCallback" DescBgColor="ffd" LogProcess="True" NamedCallbackName="PictoACT" NamedCallbackParam="Action: Remove&#13;&#10;Regex: ${sid}"/>
                </Actions>
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${d:简易播报.ekey(${aid})}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Trigger>
              <Trigger Enabled="true" Id="e63c0ff2-49da-473b-8ffb-17f6a976a518" Name="敌方死亡" RegularExpression="^.{15}\S+ 25:(?&lt;id&gt;.{8}):(?&lt;name&gt;[^:]+):[^:]*:0:">
                <Actions>
                  <Action OrderNumber="1" ActionType="NamedCallback" DescBgColor="ffd" LogProcess="True" NamedCallbackName="PictoACT" NamedCallbackParam="Action: Remove&#13;&#10;Regex: ${id}"/>
                </Actions>
              </Trigger>
            </Triggers>
          </Folder>
        </Folders>
        <Triggers>
          <Trigger Enabled="false" Id="88903116-4ad6-43a6-ab34-f129cafbcba2" Name="注册模板（简）" RegularExpression="^.{15}\S+ 01:">
            <Actions>
              <Action OrderNumber="1" ActionType="DictVariable" DictVariableOp="Set" DictVariableName="简易播报" DictVariableKey="示例：A1CB" DictVariableValue="_=小怪顺劈 | tts=顺劈 | ttsDelay=0 | omen=Fan90 | delay=0 | t=6.7 | scale=6,6,5 | color=1,1,1,1 | cross=0 | tag=M12s"/>
            </Actions>
            <Condition Enabled="true" Grouping="Or">
              <ConditionSingle Enabled="true" ExpressionL="${_ffxivzoneid}" ExpressionTypeL="String" ExpressionR="" ExpressionTypeR="String" ConditionType="StringEqualNocase"/>
            </Condition>
          </Trigger>
          <Trigger Enabled="true" Id="d5f1ae8e-6c71-4dd2-9aac-54df37acc5a6" Name="接收敌方读条" RegularExpression="^.{15}\S+ 107:(?&lt;sid&gt;4.{7}):(?&lt;aid&gt;[^:]*):(?&lt;x&gt;[^:]+):(?&lt;y&gt;[^:]+):(?&lt;z&gt;[^:]+):(?&lt;h&gt;[^:]+)">
            <Actions>
              <Action OrderNumber="1" ActionType="DictVariable" Asynchronous="False" DictVariableOp="Build" DictVariableTarget="tmp_data" DictVariableValue="=|${d:简易播报[${aid}]}"/>
              <Action OrderNumber="2" ActionType="DictVariable" Asynchronous="False" DictVariableOp="SetAll" DictVariableName="tmp_data" DictVariableKey="${f:trim:${_key}}" DictVariableValue="${f:trim:${_val}}"/>
              <Action OrderNumber="3" ActionType="Placeholder" Asynchronous="False" Description="默认的播报 tts 的范围：完全未提供任何参数 =&gt; 999" DescriptionOverride="True"/>
              <Action OrderNumber="4" ActionType="DictVariable" Asynchronous="False" DictVariableOp="Set" DictVariableName="tmp_data" DictVariableKey="ttsRange" DictVariableValue="999">
                <Condition Enabled="true" Grouping="And">
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_data.ekey(tts)}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_data.ekey(scale)}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_data.ekey(ttsRange)}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Action>
              <Action OrderNumber="5" ActionType="Placeholder" Asynchronous="False" Description="默认的播报 tts 的范围：提供了 scale =&gt; max(scaleX, scaleY) + 10" DescriptionOverride="True"/>
              <Action OrderNumber="6" ActionType="DictVariable" Asynchronous="False" DictVariableOp="Set" DictVariableValueType="Numeric" DictVariableName="tmp_data" DictVariableKey="ttsRange" DictVariableValue="max(${?l: ${d:tmp_data[scale]}.join(&quot;,&quot;, &quot;1, 2&quot;) }) + 10">
                <Condition Enabled="true" Grouping="And">
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_data.ekey(tts)}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_data.ekey(scale)}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_data.ekey(ttsRange)}" ExpressionTypeL="String" ExpressionR="0" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Action>
              <Action OrderNumber="7" ActionType="Placeholder" Asynchronous="False" Description="输出" DescriptionOverride="True"/>
              <Action OrderNumber="8" ActionType="LogMessage" Asynchronous="False" LogMessageText="tts:0${d:tmp_data[ttsDelay]}:${d:tmp_data[tts]}" LogProcess="True">
                <Condition Enabled="true" Grouping="And">
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_data.ekey(tts)}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                  <ConditionSingle Enabled="true" ExpressionL="d(${_me.xy}, ${x}, ${y})" ExpressionTypeL="Numeric" ExpressionR="${d:tmp_data[ttsRange]}" ExpressionTypeR="Numeric" ConditionType="NumericLess"/>
                </Condition>
              </Action>
              <Action OrderNumber="9" ActionType="NamedCallback" Asynchronous="False" DescBgColor="ffd" LogProcess="True" NamedCallbackName="PictoACT" NamedCallbackParam="Omen: ${d:tmp_data[omen]}&#13;&#10;delay: 0.001 + 0${d:tmp_data[delay]}&#13;&#10;t: ${if: ${d:tmp_data.ekey(t)} ? ${d:tmp_data[t]} : [简易播报] 绘图未提供 t 参数 }&#13;&#10;Tag: ${if: ${d:tmp_data.ekey(tag)} ? ${d:tmp_data[tag]} : 简易播报_${sid}_${aid} }&#13;&#10;Pos: ${x}, ${y}, ${z}&#13;&#10;Angle: ${h}&#13;&#10;Scale: ${if: ${d:tmp_data.ekey(scale)} ? ${d:tmp_data[scale]} : [简易播报] 绘图未提供 scale 参数 }&#13;&#10;Color: ${if: ${d:tmp_data.ekey(color)} ? ${d:tmp_data[color]} : 1, 1, 1, 1 }">
                <Condition Enabled="true" Grouping="Or">
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_data.ekey(omen)}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Action>
              <Action OrderNumber="10" ActionType="NamedCallback" Asynchronous="False" DescBgColor="ffd" LogProcess="True" NamedCallbackName="PictoACT" NamedCallbackParam="Omen: ${d:tmp_data[omen]}&#13;&#10;delay: 0.001 + 0${d:tmp_data[delay]}&#13;&#10;t: ${if: ${d:tmp_data.ekey(t)} ? ${d:tmp_data[t]} : [简易播报] 绘图未提供 t 参数 }&#13;&#10;Tag: ${if: ${d:tmp_data.ekey(tag)} ? ${d:tmp_data[tag]} : 简易播报_${sid}_${aid} }&#13;&#10;Pos: ${x}, ${y}, ${z}&#13;&#10;Angle: ${h} + π/2&#13;&#10;Scale: ${if: ${d:tmp_data.ekey(scale)} ? ${d:tmp_data[scale]} : [简易播报] 绘图未提供 scale 参数 }&#13;&#10;Color: ${if: ${d:tmp_data.ekey(color)} ? ${d:tmp_data[color]} : 1, 1, 1, 1 }">
                <Condition Enabled="true" Grouping="And">
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_data.ekey(omen)}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                  <ConditionSingle Enabled="true" ExpressionL="${d:tmp_data[cross]}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
                </Condition>
              </Action>
              <Action OrderNumber="11" ActionType="DictVariable" Asynchronous="False" DictVariableName="tmp_data"/>
            </Actions>
            <Condition Enabled="true" Grouping="Or">
              <ConditionSingle Enabled="true" ExpressionL="${d:简易播报.ekey(${aid})}" ExpressionTypeL="String" ExpressionR="1" ExpressionTypeR="String" ConditionType="StringEqualCase"/>
            </Condition>
          </Trigger>
          <Trigger Enabled="false" Id="fab4b518-59ed-4419-ac90-8b545bb3d9c3" Name="注册模板 + 说明" RegularExpression="^.{15}\S+ 01:">
            <Actions>
              <Action OrderNumber="1" ActionType="Placeholder" Description="下方每行填写一个需要监测的敌方读条技能" DescriptionOverride="True"/>
              <Action OrderNumber="2" ActionType="Placeholder" Description="键：十六进制技能 id，如 A1CB" DescriptionOverride="True"/>
              <Action OrderNumber="3" ActionType="Placeholder" Description="值：如  _=小怪顺劈 | tts=顺劈 | ttsDelay=0 | omen=Fan90 | delay=0 | t=6.7 | scale=6,6,5 | color=1,1,1,1 | cross=0 | tag=M12s" DescriptionOverride="True"/>
              <Action OrderNumber="4" ActionType="Placeholder" Description="  tts: 播报的文本；未提供时默认不播报" DescriptionOverride="True"/>
              <Action OrderNumber="5" ActionType="Placeholder" Description="  ttsDelay: 播报文本的延迟/s；未提供时默认为 0" DescriptionOverride="True"/>
              <Action OrderNumber="6" ActionType="Placeholder" Description="  ttsRange: 在什么距离内会播报 tts；如未提供则使用 omen scale 的最大值 + 15" DescriptionOverride="True"/>
              <Action OrderNumber="7" ActionType="Placeholder" Description="  omen: Omen 类型，可以使用 omen 名称（general02f）或 PictoACT 模块定义的简称（Rect）；未提供时默认不画图" DescriptionOverride="True"/>
              <Action OrderNumber="8" ActionType="Placeholder" Description="  delay: Omen 显示的延迟；未提供时默认为 0" DescriptionOverride="True"/>
              <Action OrderNumber="9" ActionType="Placeholder" Description="  t: Omen 显示的时长；需要画图时必须提供" DescriptionOverride="True"/>
              <Action OrderNumber="10" ActionType="Placeholder" Description="  scale: Omen 的三维尺寸 (圆形/环形/扇形通常为 半径, 半径, 高度，单侧矩形为 垂直于指向的半宽度, 平行于指向的长度, 高度)；需要画图时必须提供" DescriptionOverride="True"/>
              <Action OrderNumber="11" ActionType="Placeholder" Description="  color: 颜色 r, g, b, a；未提供时默认为 1, 1, 1, 1" DescriptionOverride="True"/>
              <Action OrderNumber="12" ActionType="Placeholder" Description="  cross: 是否为十字，十字会旋转 90 度再生成一个 Omen；未提供时默认为 0" DescriptionOverride="True"/>
              <Action OrderNumber="13" ActionType="Placeholder" Description="  tag: PictoACT 模块中使用的 Omen 标签，不知道是什么的话不建议设置；默认如 简易播报_40001234_A1CB (读条来源的 ID + 技能 ID)" DescriptionOverride="True"/>
              <Action OrderNumber="14" ActionType="Placeholder" Description="  _=xxx 可用于注释（如 小怪顺劈）" DescriptionOverride="True"/>
              <Action OrderNumber="15" ActionType="Placeholder" Description="空格、大小写不敏感" DescriptionOverride="True"/>
              <Action OrderNumber="16" ActionType="Placeholder" Description="此触发器会在每次切换区域时确认下列数据已经加载。（进阶：你可以在触发器条件中设置 zone 以减少不必要的触发）" DescriptionOverride="True"/>
              <Action OrderNumber="17" ActionType="DictVariable" DictVariableOp="Set" DictVariableName="简易播报" DictVariableKey="示例：A1CC" DictVariableValue="omen=Fan90 | t=6.7 | scale=6,6,1"/>
              <Action OrderNumber="18" ActionType="DictVariable" DictVariableOp="Set" DictVariableName="简易播报" DictVariableKey="3DAA" DictVariableValue="tts=插言 | omen=rect | t=10 | scale=5,5,5"/>
            </Actions>
            <Condition Enabled="false" Grouping="Or">
              <ConditionSingle Enabled="true" ExpressionL="${_ffxivzoneid}" ExpressionTypeL="String" ExpressionR="在这里填写区域 ID（十进制）并启用条件" ExpressionTypeR="String" ConditionType="StringEqualNocase"/>
            </Condition>
          </Trigger>
        </Triggers>
      </Folder>
      <Folder Id="1767274b-6173-44ec-a0ae-5219b3549c8a" Enabled="true" Name="双目标监控">
        <Triggers>
          <Trigger Enabled="true" Id="fc1ffdcd-e388-4489-8182-db33c231854e" Name="接收指令" RegularExpression="^双目标:" Sequential="True">
            <Actions>
              <Action OrderNumber="1" ActionType="DictVariable" DictVariableOp="Set" DictVariableName="双目标" DictVariableKey="id1" DictVariableValue="40000000"/>
              <Action OrderNumber="2" ActionType="DictVariable" DictVariableOp="Set" DictVariableName="双目标" DictVariableKey="id2" DictVariableValue="40000000"/>
              <Action OrderNumber="3" ActionType="DictVariable" DictVariableOp="Set" DictVariableName="双目标" DictVariableKey="name1" DictVariableValue="光"/>
              <Action OrderNumber="4" ActionType="DictVariable" DictVariableOp="Set" DictVariableName="双目标" DictVariableKey="name2" DictVariableValue="暗"/>
              <Action OrderNumber="5" ActionType="DictVariable" DescBgColor="f0f0f0" DictVariableOp="Set" DictVariableName="双目标" DictVariableKey="color0" DictVariableValue="f0f0f0"/>
              <Action OrderNumber="6" ActionType="DictVariable" DescBgColor="ffffcc" DictVariableOp="Set" DictVariableName="双目标" DictVariableKey="color1" DictVariableValue="ffffcc"/>
              <Action OrderNumber="7" ActionType="DictVariable" DescBgColor="ccccff" DictVariableOp="Set" DictVariableName="双目标" DictVariableKey="color2" DictVariableValue="ccccff"/>
              <Action OrderNumber="8" ActionType="DictVariable" DictVariableOp="Set" DictVariableName="双目标" DictVariableKey="threshold" DictVariableValue="15"/>
            </Actions>
          </Trigger>
        </Triggers>
      </Folder>
    </Folders>
    <Triggers>
      <Trigger Enabled="false" Id="fae168be-1770-4f38-b880-f2bdfca8b971" Name="使用说明" Source="None">
        <Actions>
          <Action OrderNumber="1" ActionType="Placeholder" Asynchronous="False" Description="　用户不需要、也不应改变或执行任何触发器，仅需要保持分组开启即可。" DescBgColor="f0f8ff" DescTextColor="234" DescriptionOverride="True"/>
          <Action OrderNumber="2" ActionType="Placeholder" Asynchronous="False" Description="　如果你是普通用户，无需阅读下面的内容。" DescBgColor="f0f8ff" DescTextColor="234" DescriptionOverride="True"/>
          <Action OrderNumber="3" ActionType="Placeholder" Asynchronous="False" Description="　本工具箱包含以下内容：" DescBgColor="f0f8ff" DescTextColor="234" DescriptionOverride="True"/>
          <Action OrderNumber="4" ActionType="Placeholder" Asynchronous="False" Description="高级标点工具箱（新版）" DescBgColor="acf" DescTextColor="248" DescriptionOverride="True"/>
          <Action OrderNumber="5" ActionType="Placeholder" Asynchronous="False" Description="  在切换区域（包括 ACT 与游戏之一运行时开启另一个）时向触发器程序注册回调" DescBgColor="f0f8ff" DescTextColor="234" DescriptionOverride="True"/>
          <Action OrderNumber="6" ActionType="Placeholder" Asynchronous="False" Description="  用户可以直接使用具名回调操作 “AdvWm” 触发。" DescBgColor="f0f8ff" DescTextColor="234" DescriptionOverride="True"/>
          <Action OrderNumber="7" ActionType="LaunchProcess" Description="· 右键 - 测试动作 打开说明文档链接（GitHub）" DescBgColor="f0f8ff" DescTextColor="2a8" DescriptionOverride="True" LaunchProcessPathExpression="https://github.com/MnFeN/ACT_Tech_Guide"/>
          <Action OrderNumber="8" ActionType="NamedCallback" Description="· 也可双击这行查看一小段简短说明" DescBgColor="f0f8ff" DescTextColor="2a8" DescriptionOverride="True" NamedCallbackName="AdvWm" NamedCallbackParam="// 左侧箭头可以展开为多行模式&#13;&#10;// 双斜线开始的行会当做为注释行，和空行一起被忽略&#13;&#10;// 所有参数的顺序不重要，每行提供一个参数&#13;&#10;&#13;&#10;// 采用日志中的坐标系，即正东 x+，正南 y+，正上 z+&#13;&#10;// 角度从正北开始逆时针递增，如 北 西 南 东 分别为： ±π, -π/2, 0, π/2&#13;&#10;&#13;&#10;// 必须参数：action，代表标点模式&#13;&#10;// place 模式下允许你输入一组相对坐标&#13;&#10;action: place&#13;&#10;&#13;&#10;// 可选参数：scaleX scaleY scaleZ：坐标在各个方向上的缩放尺度，负数即为反向&#13;&#10;// 未提供时的默认值：均为 1&#13;&#10;scaleX: 2&#13;&#10;scaleY: -2&#13;&#10;// 如果尺度相同，可以使用 scale: 2 简化&#13;&#10;&#13;&#10;// 可选参数 θ：旋转角度，可以理解为将这个相对坐标系的正北旋转至哪个绝对方向&#13;&#10;// 未提供时的默认值：-π （将正北旋转至正北，即未旋转）&#13;&#10;θ: π/2&#13;&#10;// 也可以写作角度，如 θ: 90°&#13;&#10;&#13;&#10;// 可选参数 center：中心坐标&#13;&#10;// 下方演示的是使用触发器的实体查询功能获取并填入自身坐标&#13;&#10;// 未提供时的默认值：0, 0, 0&#13;&#10;center: ${_me.x}, ${_me.y}, ${_me.z}&#13;&#10;&#13;&#10;// 提供的坐标首先经过缩放变换，其次经过平面旋转，最后平移至中心坐标&#13;&#10;&#13;&#10;// 下方给出所有相对坐标：&#13;&#10;A: 0, -4, 0&#13;&#10;// z = 0 可以省略：&#13;&#10;B: 4, -4&#13;&#10;// 也可以使用极坐标模式：polar [r], [θ]：&#13;&#10;C: polar 4, 90°&#13;&#10;// 也可以结合两种模式，以平面直角坐标系下的坐标为中心进一步添加一个极坐标系的偏移：&#13;&#10;D: 0, 4 polar 2, 30°&#13;&#10;// 清除一个标点：&#13;&#10;1: clear&#13;&#10;// “清除”一个标点，实为移动到看不见的位置，使之下次出现时没有淡入动画：&#13;&#10;2: fakeclear&#13;&#10;// 没有提供的标点会被忽略，保持标点的原状态&#13;&#10;// 3:... 4:...&#13;&#10;&#13;&#10;// 三条 hyphen 连字符为分隔线，代表另起一条指令，所有指令依次执行&#13;&#10;---&#13;&#10;&#13;&#10;// circle 模式下通过给定的圆心和半径将所有点标记在圆周的等分位置&#13;&#10;action: circle&#13;&#10;&#13;&#10;// 必须参数：waymarks，从正北开始所有的标点&#13;&#10;// 可以使用 _ 表示这个位置依旧需要等分，但是并不放置一个标点，如下面代表八等分圆但正南不标点&#13;&#10;waymarks: ABCD_234&#13;&#10;&#13;&#10;// 必须参数：r，半径&#13;&#10;r: 5&#13;&#10;&#13;&#10;// 必须参数：center 圆心坐标&#13;&#10;center: ${_me.x}, ${_me.y}, ${_me.z}&#13;&#10;&#13;&#10;// 可选参数：θ，与 place 中类似&#13;&#10;θ: -π&#13;&#10;&#13;&#10;// linear（连接两个点）和 arc（朝某个方向标记圆弧）指令还没写介绍，有兴趣可以看代码&#13;&#10;"/>
          <Action OrderNumber="9" ActionType="Placeholder" Asynchronous="False" Description="  此外，你可以使用指令：/e pl/place A/B/C/D/1/2/3/4 [x] [y] [z] 放置标点。" DescBgColor="f0f8ff" DescTextColor="234" DescriptionOverride="True"/>
          <Action OrderNumber="10" ActionType="Placeholder" Asynchronous="False" Description="  坐标参数均为可选，不提供时用自身坐标，如 /e pl A 将 A 点放在自己脚下。" DescBgColor="f0f8ff" DescTextColor="234" DescriptionOverride="True"/>
          <Action OrderNumber="11" ActionType="Placeholder" Asynchronous="False" Description="高级标点工具箱（旧版）" DescBgColor="acf" DescTextColor="248" DescriptionOverride="True"/>
          <Action OrderNumber="12" ActionType="Placeholder" Asynchronous="False" Description="　旧版本，使用固定格式的日志触发标点，已弃用，但触发器依然保留以兼容旧版科技。" DescBgColor="f0f8ff" DescTextColor="234" DescriptionOverride="True"/>
          <Action OrderNumber="13" ActionType="Placeholder" Asynchronous="False" Description="鲶鱼精邮差扩展" DescBgColor="acf" DescTextColor="248" DescriptionOverride="True"/>
          <Action OrderNumber="14" ActionType="Placeholder" Asynchronous="False" Description="　详见远程触发器 - 自检工具箱。" DescBgColor="f0f8ff" DescTextColor="234" DescriptionOverride="True"/>
          <Action OrderNumber="15" ActionType="Placeholder" Asynchronous="False" Description="延迟咏唱" DescBgColor="acf" DescTextColor="248" DescriptionOverride="True"/>
          <Action OrderNumber="16" ActionType="Placeholder" Asynchronous="False" Description="　异步延迟执行 tts、蜂鸣声、指令 等动作。" DescBgColor="f0f8ff" DescTextColor="234" DescriptionOverride="True"/>
          <Action OrderNumber="17" ActionType="Placeholder" Asynchronous="False" Description="关于" DescBgColor="acf" DescTextColor="248" DescriptionOverride="True"/>
          <Action OrderNumber="18" ActionType="Placeholder" Asynchronous="False" Description="　作者：MnFeN 阿洛" DescBgColor="f0f8ff" DescTextColor="234" DescriptionOverride="True"/>
          <Action OrderNumber="19" ActionType="Placeholder" Asynchronous="False" Description="　致谢：AtmoOmen　　Fragile　　Latihas　　Natsukage　　Small-Miao" DescBgColor="f0f8ff" DescTextColor="234" DescriptionOverride="True"/>
        </Actions>
      </Trigger>
    </Triggers>
  </ExportedFolder>
</TriggernometryExport>
